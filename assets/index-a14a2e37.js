import{r as h,z,j as e,l as G,a3 as q,a4 as V,d as B,f as C,a5 as $,P as O,h as _,L as U}from"./index-f3718d6f.js";import{a as K,u as H}from"./useBookings-547206c5.js";import{u as Q}from"./useProducts-89bb59d8.js";import{F as c}from"./Form-aa5dcb37.js";import{A}from"./Alert-97e29c50.js";import{S as F}from"./Spinner-dba056ca.js";import{B as y}from"./Button-e5255a38.js";import{M as P}from"./Modal-72de89ab.js";import{g as Y}from"./statusUtils-20de438d.js";import{a as J}from"./hook-fa472897.js";import{u as Z,B as W}from"./Nav-2083c340.js";import{N as X}from"./NavbarContext-09acecbf.js";import{m as ee}from"./NavContext-a03af8f6.js";import{B as E}from"./Badge-ae92dd50.js";import{B as se}from"./ButtonGroup-69cd02d7.js";import"./useQuery-c64cdbe9.js";import"./useMutation-50b84c76.js";import"./ElementChildren-9e4b5230.js";import"./AbstractModalHeader-bc0eb37f.js";import"./useWindow-41dd01a7.js";import"./hasClass-f08a7e6f.js";import"./useMergedRefs-33faaebf.js";import"./DataKey-e12315fd.js";const M=h.forwardRef(({className:r,bsPrefix:l,as:p="div",...u},n)=>(l=z(l,"nav-item"),e.jsx(p,{ref:n,className:G(r,l),...u})));M.displayName="NavItem";const te=M,D=h.forwardRef(({bsPrefix:r,className:l,as:p=q,active:u,eventKey:n,disabled:d=!1,...g},x)=>{r=z(r,"nav-link");const[f,t]=Z({key:ee(n,g.href),active:u,disabled:d,...g});return e.jsx(p,{...g,...f,ref:x,disabled:d,className:G(l,r,d&&"disabled",t.isActive&&"active")})});D.displayName="NavLink";const re=D,R=h.forwardRef((r,l)=>{const{as:p="div",bsPrefix:u,variant:n,fill:d=!1,justify:g=!1,navbar:x,navbarScroll:f,className:t,activeKey:s,...o}=J(r,{activeKey:"onSelect"}),m=z(u,"nav");let v,j,N=!1;const w=h.useContext(X),k=h.useContext(V);return w?(v=w.bsPrefix,N=x??!0):k&&({cardHeaderBsPrefix:j}=k),e.jsx(W,{as:p,ref:l,activeKey:s,className:G(t,{[m]:!N,[`${v}-nav`]:N,[`${v}-nav-scroll`]:N&&f,[`${j}-${n}`]:!!j,[`${m}-${n}`]:!!n,[`${m}-fill`]:d,[`${m}-justified`]:g}),...o})});R.displayName="Nav";const b=Object.assign(R,{Item:te,Link:re});let I=!1,S=!1;const L=[],ae=({onPlaceSelected:r,value:l="",placeholder:p="Search for an address",required:u=!1})=>{const n=h.useRef(null),d=h.useRef(null);return h.useEffect(()=>{n.current&&l&&(n.current.value=l)},[l]),h.useEffect(()=>{const g="AIzaSyDJvwpR_epAanY-ayIYf8AZmjUu2IgFpdc",x=()=>{if(!n.current){setTimeout(x,100);return}if(!window.google||!window.google.maps||!window.google.maps.places){setTimeout(x,200);return}try{d.current&&google.maps.event.clearInstanceListeners(d.current);const t={types:["geocode","establishment"],componentRestrictions:{country:"vn"},fields:["formatted_address","geometry","name"]};d.current=new google.maps.places.Autocomplete(n.current,t),setTimeout(()=>{document.querySelector(".pac-container")},1e3),d.current.addListener("place_changed",()=>{var m;const s=(m=d.current)==null?void 0:m.getPlace();if(!s||!s.geometry||!s.geometry.location)return;const o={address:s.formatted_address||"",latitude:s.geometry.location.lat(),longitude:s.geometry.location.lng()};n.current&&(n.current.value=o.address),r(o)})}catch{}};return(()=>{if(I||window.google&&window.google.maps&&window.google.maps.places){I=!0,x();return}if(S){L.push(x);return}const t=document.querySelector('script[src*="maps.googleapis.com"]');if(t){S=!0,t.addEventListener("load",()=>{I=!0,S=!1,x(),L.forEach(m=>m()),L.length=0});return}const s=`https://maps.googleapis.com/maps/api/js?key=${g}&libraries=places`;S=!0;const o=document.createElement("script");o.src=s,o.async=!0,o.defer=!0,o.onload=()=>{I=!0,S=!1,x(),L.forEach(m=>m()),L.length=0},o.onerror=()=>{S=!1},document.head.appendChild(o)})(),()=>{if(d.current&&window.google&&window.google.maps)try{google.maps.event.clearInstanceListeners(d.current)}catch{}}},[r]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
				.pac-container {
					z-index: 9999 !important;
					position: fixed !important;
				}
			`}),e.jsx("div",{style:{position:"relative"},children:e.jsx(c.Control,{ref:n,type:"text",defaultValue:l,placeholder:p,required:u,autoComplete:"off",id:"google-places-autocomplete-input"})})]})},ne=({initialData:r,products:l,productsLoading:p=!1,onSubmit:u,onCancel:n,isSubmitting:d=!1,error:g,submitButtonText:x="Submit",cancelButtonText:f="Cancel",showCancelButton:t=!0})=>{const[s,o]=h.useState({bookingTime:"",customerId:"",customerName:"",customerPhone:"",latitude:0,longitude:0,address:"",items:[],...r}),[m,v]=h.useState(""),[j,N]=h.useState(1);h.useEffect(()=>{r&&(o(a=>({...a,...r})),r.items&&r.items.length>0&&(v(r.items[0].productId),N(r.items[0].quantity)))},[r]);const w=a=>{o(T=>({...T,address:a.address,latitude:a.latitude,longitude:a.longitude}))},k=a=>{if(a.preventDefault(),!m)return;const T={...s,bookingTime:s.bookingTime?new Date(s.bookingTime).toISOString():new Date().toISOString(),items:[{productId:m,quantity:j}]};u(T)},i=l.find(a=>a.id===m);return e.jsxs(c,{onSubmit:k,children:[g&&e.jsx(A,{variant:"danger",dismissible:!0,children:g}),e.jsxs(B,{children:[e.jsx(C,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Customer Name *"}),e.jsx(c.Control,{type:"text",placeholder:"Enter customer name",value:s.customerName||"",onChange:a=>o({...s,customerName:a.target.value}),required:!0})]})}),e.jsx(C,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Customer Phone *"}),e.jsx(c.Control,{type:"tel",placeholder:"0352978519",value:s.customerPhone||"",onChange:a=>o({...s,customerPhone:a.target.value}),required:!0})]})})]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Customer ID *"}),e.jsx(c.Control,{type:"text",placeholder:"Enter customer ID (UUID)",value:s.customerId||"",onChange:a=>o({...s,customerId:a.target.value}),required:!0})]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Address *"}),e.jsx(ae,{value:s.address||"",onPlaceSelected:w,placeholder:"Search for an address using Google Maps",required:!0})]}),s.latitude!==0&&s.longitude!==0&&e.jsx(A,{variant:"info",className:"mb-3",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Coordinates:"})," ",s.latitude.toFixed(6),", ",s.longitude.toFixed(6)]})}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Booking Time *"}),e.jsx(c.Control,{type:"datetime-local",value:s.bookingTime?new Date(s.bookingTime).toISOString().slice(0,16):"",onChange:a=>o({...s,bookingTime:a.target.value}),required:!0})]}),e.jsxs(B,{children:[e.jsx(C,{md:8,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Select Product *"}),p?e.jsxs("div",{className:"text-center py-2",children:[e.jsx(F,{animation:"border",size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading products..."})]}):e.jsxs(c.Select,{value:m,onChange:a=>v(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Select a product --"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.name," - ",a.price.toLocaleString("vi-VN")," VND"]},a.id))]})]})}),e.jsx(C,{md:4,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Quantity *"}),e.jsx(c.Control,{type:"number",min:"1",value:j,onChange:a=>N(parseInt(a.target.value)||1),required:!0})]})})]}),i&&e.jsxs(A,{variant:"info",className:"mb-3",children:[e.jsx("strong",{children:"Selected:"})," ",i.name," x ",j,e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:i.description}),e.jsx("hr",{className:"my-2"}),e.jsxs("strong",{children:["Total: ",(i.price*j).toLocaleString("vi-VN")," VND"]})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-end mt-3",children:[t&&n&&e.jsx(y,{type:"button",variant:"secondary",onClick:n,disabled:d,children:f}),e.jsx(y,{type:"submit",variant:"primary",disabled:d||!m||!s.address,children:d?e.jsxs(e.Fragment,{children:[e.jsx(F,{animation:"border",size:"sm",className:"me-2"}),"Submitting..."]}):x})]})]})},oe=({show:r,onHide:l,onSuccess:p})=>{var f;const u=K(),{showNotification:n}=$(),{data:d=[],isLoading:g}=Q(),x=async t=>{try{await u.mutateAsync(t),n("Booking created successfully","success"),l(),p==null||p()}catch(s){n(s instanceof Error?s.message:"Failed to create booking","error")}};return e.jsxs(P,{show:r,onHide:l,size:"lg",children:[e.jsx(P.Header,{closeButton:!0,children:e.jsx(P.Title,{children:"Create New Booking"})}),e.jsx(P.Body,{children:e.jsx(ne,{products:d,productsLoading:g,onSubmit:x,onCancel:l,isSubmitting:u.isPending,error:u.isError?`Failed to create booking: ${((f=u.error)==null?void 0:f.message)||"Unknown error"}`:null,submitButtonText:"Create Booking",showCancelButton:!0})})]})};const ie=()=>{var k;const[r,l]=h.useState(1),[p]=h.useState(10),[u,n]=h.useState("new"),[d,g]=h.useState(""),[x,f]=h.useState(!1),{data:t,isLoading:s,error:o,refetch:m}=H({page:r,pageSize:p,status:[0,1,2,3,4,5,6,7,8]}),{showNotification:v}=$();h.useEffect(()=>{o&&v(o instanceof Error?o.message:"Failed to load bookings","error")},[o,v]);const j={new:(t==null?void 0:t.totalCount)||0,verification:0,approval:0,processed:0},N=()=>{m(),v("Bookings list refreshed","success")},w=(t==null?void 0:t.items)||[];return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Booking Management",subName:"Apps"}),e.jsx(B,{children:e.jsx(C,{xs:12,children:e.jsx(_,{children:e.jsxs(_.Body,{children:[e.jsxs(b,{variant:"tabs",className:"nav-bordered mb-4",children:[e.jsx(b.Item,{children:e.jsxs(b.Link,{active:u==="new",onClick:()=>n("new"),className:"d-flex align-items-center gap-2",children:["New",j.new>0&&e.jsx(E,{bg:"danger",className:"ms-1",children:j.new})]})}),e.jsx(b.Item,{children:e.jsxs(b.Link,{active:u==="verification",onClick:()=>n("verification"),className:"d-flex align-items-center gap-2",children:["Verification Due",j.verification>0]})}),e.jsx(b.Item,{children:e.jsxs(b.Link,{active:u==="approval",onClick:()=>n("approval"),className:"d-flex align-items-center gap-2",children:["Approval Due",j.approval>0]})}),e.jsx(b.Item,{children:e.jsxs(b.Link,{active:u==="processed",onClick:()=>n("processed"),className:"d-flex align-items-center gap-2",children:["Processed",j.processed>0]})})]}),e.jsx(B,{className:"mb-4",children:e.jsx(C,{md:12,children:e.jsxs("div",{className:"position-relative",children:[e.jsx("i",{className:"mdi mdi-magnify position-absolute top-50 start-0 translate-middle-y ms-3 text-muted",style:{fontSize:"18px"}}),e.jsx(c.Control,{type:"text",placeholder:"Search bookings by customer name...",value:d,onChange:i=>g(i.target.value),className:"ps-5"})]})})}),e.jsx(B,{className:"mb-4",children:e.jsx(C,{xs:12,children:e.jsxs(se,{className:"mb-2 gap-1",children:[e.jsxs(y,{variant:"primary",size:"sm",onClick:()=>f(!0),children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Create Booking"]}),e.jsxs(y,{variant:"secondary",size:"sm",onClick:async()=>{try{await m(),v("Bookings list refreshed","success")}catch(i){v(i instanceof Error?i.message:"Failed to refresh bookings","error")}},children:[e.jsx("i",{className:"mdi mdi-refresh me-1"}),"Reload"]})]})})}),o&&e.jsxs(A,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",o instanceof Error?o.message:"Failed to load bookings"]}),s?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(F,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading bookings..."})]}):t!=null&&t.items&&t.items.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-centered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer Name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Booking Time"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{className:"booking-actions-column",children:"Actions"})]})}),e.jsx("tbody",{children:w.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:i.customerName||"N/A"})}),e.jsx("td",{children:i.customerPhone||"-"}),e.jsx("td",{className:"text-muted",children:e.jsx("small",{children:i.address||"-"})}),e.jsx("td",{children:new Date(i.bookingTime).toLocaleString("vi-VN")}),e.jsx("td",{children:i.items&&i.items.length>0?e.jsxs(E,{bg:"info",children:[i.items.length," items"]}):i.totalPrice?e.jsxs(E,{bg:"secondary",children:[i.totalPrice.toLocaleString("vi-VN")," VND"]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:Y(i.status)}),e.jsx("td",{children:i.bookingTime?new Date(i.bookingTime).toLocaleDateString("vi-VN"):"-"}),e.jsx("td",{className:"booking-actions-column",children:e.jsx(U,{to:`/apps/booking/${i.id}`,children:e.jsxs(y,{variant:"outline-primary",size:"sm",onClick:a=>a.stopPropagation(),children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"View"]})})})]},i.id))})]})}),e.jsx(B,{className:"mt-4",children:e.jsx(C,{xs:12,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",((k=t.items)==null?void 0:k.length)||0," of ",t.totalCount," bookings"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(y,{variant:"secondary",size:"sm",disabled:r===1,onClick:()=>l(r-1),children:"Previous"}),e.jsxs(y,{variant:"secondary",size:"sm",disabled:!0,children:["Page ",r," of ",t.totalPages]}),e.jsx(y,{variant:"secondary",size:"sm",disabled:r>=t.totalPages,onClick:()=>l(r+1),children:"Next"})]})]})})})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No bookings found"}),e.jsx(y,{variant:"primary",onClick:()=>f(!0),children:"Create First Booking"})]})]})})})}),e.jsx(oe,{show:x,onHide:()=>f(!1),onSuccess:N})]})},Ae=()=>e.jsx(ie,{});export{Ae as default};
