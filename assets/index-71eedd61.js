import{w as b,r as x,j as e,P as v,d as m,f as d,h as j,v as r,aW as l}from"./index-9951c232.js";import{u as y}from"./useQuery-b845a33c.js";import{A as N}from"./Alert-0f63f259.js";import{B as f}from"./Button-a6431399.js";import{S as w}from"./Spinner-b7c06ea5.js";import{T as P}from"./Table-db529312.js";const C={}.VITE_API_SERVER||"http://localhost:80",h=b.create({baseURL:`${C}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});h.interceptors.request.use(async s=>{const n=localStorage.getItem("_USTA_OAUTH");if(n)try{const a=JSON.parse(n);s.headers.Authorization=`Bearer ${a.accessToken}`,console.log("[Technician API] Request:",{method:s.method,url:s.url,params:s.params,hasAuth:!!s.headers.Authorization})}catch(a){console.error("[Technician API] Failed to parse OAuth session:",a)}else console.warn("[Technician API] No OAuth session found");return s},s=>(console.error("[Technician API] Request error:",s),Promise.reject(s)));h.interceptors.response.use(s=>(console.log("[Technician API] Response:",{status:s.status,url:s.config.url,data:s.data}),s),s=>{var n,a,i;return console.error("[Technician API] Response error:",{status:(n=s.response)==null?void 0:n.status,url:(a=s.config)==null?void 0:a.url,data:(i=s.response)==null?void 0:i.data,message:s.message}),Promise.reject(s)});async function I(s={}){console.log("[Technician API] Fetching technicians:",s);const n=await h.get("/technicians/",{params:s});if(n.data.success)return n.data.data;throw new Error(n.data.error||"Failed to fetch technicians")}function R(s={}){return y({queryKey:["technicians",s],queryFn:()=>I(s),staleTime:3e4,retry:2,select:n=>n||[]})}const F=()=>{const[s,n]=x.useState(0),[a,i]=x.useState(""),{data:p=[],isLoading:g,error:u,refetch:T}=R({status:s}),o=p.filter(t=>{var c;return t.name.toLowerCase().includes(a.toLowerCase())||t.phone.includes(a)||((c=t.email)==null?void 0:c.toLowerCase().includes(a.toLowerCase()))}),A=t=>{switch(t){case 0:return e.jsx(l,{bg:"success",children:"Active"});case 1:return e.jsx(l,{bg:"warning",children:"Inactive"});case 2:return e.jsx(l,{bg:"danger",children:"Suspended"});default:return e.jsx(l,{bg:"secondary",children:"Unknown"})}},S=t=>{if(!t)return e.jsx("span",{className:"text-muted",children:"No rating"});const c="⭐".repeat(Math.round(t));return e.jsxs("span",{children:[c," (",t.toFixed(1),")"]})};return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Technician Management",subName:"Apps"}),e.jsx(m,{children:e.jsx(d,{xs:12,children:e.jsx(j,{children:e.jsxs(j.Body,{children:[e.jsxs(m,{className:"mb-3",children:[e.jsx(d,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Filter by Status"}),e.jsxs(r.Select,{value:s,onChange:t=>n(Number(t.target.value)),children:[e.jsx("option",{value:0,children:"Active"}),e.jsx("option",{value:1,children:"Inactive"}),e.jsx("option",{value:2,children:"Suspended"})]})]})}),e.jsx(d,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Search"}),e.jsx(r.Control,{type:"text",placeholder:"Search by name, phone, or email...",value:a,onChange:t=>i(t.target.value)})]})})]}),u&&e.jsxs(N,{variant:"danger",dismissible:!0,children:["Failed to load technicians: ",u.message,e.jsx(f,{variant:"link",onClick:()=>T(),children:"Try Again"})]}),g?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(w,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading technicians..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("h5",{className:"mb-0",children:["Total Technicians: ",o.length]})}),e.jsx("div",{className:"table-responsive",children:e.jsxs(P,{hover:!0,className:"mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Specialization"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4",children:e.jsx("div",{className:"text-muted",children:"No technicians found"})})}):o.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:t.name}),t.address&&e.jsx("div",{className:"text-muted small",children:t.address})]}),e.jsx("td",{children:t.phone}),e.jsx("td",{children:t.email||"-"}),e.jsx("td",{children:t.specialization||"-"}),e.jsx("td",{children:S(t.rating)}),e.jsx("td",{children:A(t.status)}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString("vi-VN")})]},t.id))})]})})]})]})})})})]})},z=()=>e.jsx(F,{});export{z as default};
