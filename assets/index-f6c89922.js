import{r as i,z,j as e,l as G,a3 as W,a4 as X,a as ee,P as se,d as k,f as N,h as V,_ as te,R as ae,c as q}from"./index-1c742463.js";import{F as a}from"./Form-05ad4a6a.js";import{u as re,a as ne}from"./useBookings-56b5d18b.js";import{u as ie}from"./useProducts-36f8fd77.js";import{a as oe}from"./hook-fa5e7b20.js";import{u as le,B as ce}from"./Nav-ff1ec338.js";import{N as de}from"./NavbarContext-c61b7338.js";import{m as me}from"./NavContext-f1d7acd4.js";import{B as h}from"./Badge-6e0fdd54.js";import{B as ue}from"./ButtonGroup-c0a5457c.js";import{B as y}from"./Button-a842f113.js";import{A as _}from"./Alert-8204e7ea.js";import{S as F}from"./Spinner-ad3d02ac.js";import{M as B}from"./Modal-f8756c89.js";import"./ElementChildren-8c132aea.js";import"./useQuery-0e03b41d.js";import"./useMutation-59983a6c.js";import"./DataKey-e12315fd.js";import"./useMergedRefs-1d178a6e.js";import"./AbstractModalHeader-834b3d34.js";import"./useWindow-aa1a9643.js";import"./hasClass-aa277adc.js";const U=i.forwardRef(({className:x,bsPrefix:n,as:p="div",...g},r)=>(n=z(n,"nav-item"),e.jsx(p,{ref:r,className:G(x,n),...g})));U.displayName="NavItem";const xe=U,O=i.forwardRef(({bsPrefix:x,className:n,as:p=W,active:g,eventKey:r,disabled:o=!1,...j},u)=>{x=z(x,"nav-link");const[C,m]=le({key:me(r,j.href),active:g,disabled:o,...j});return e.jsx(p,{...j,...C,ref:u,disabled:o,className:G(n,x,o&&"disabled",m.isActive&&"active")})});O.displayName="NavLink";const he=O,H=i.forwardRef((x,n)=>{const{as:p="div",bsPrefix:g,variant:r,fill:o=!1,justify:j=!1,navbar:u,navbarScroll:C,className:m,activeKey:t,...l}=oe(x,{activeKey:"onSelect"}),c=z(g,"nav");let S,v,b=!1;const d=i.useContext(de),D=i.useContext(X);return d?(S=d.bsPrefix,b=u??!0):D&&({cardHeaderBsPrefix:v}=D),e.jsx(ce,{as:p,ref:n,activeKey:t,className:G(m,{[c]:!b,[`${S}-nav`]:b,[`${S}-nav-scroll`]:b&&C,[`${v}-${r}`]:!!v,[`${c}-${r}`]:!!r,[`${c}-fill`]:o,[`${c}-justified`]:j}),...l})});H.displayName="Nav";const f=Object.assign(H,{Item:xe,Link:he});let E=!1,L=!1;const A=[],pe=({onPlaceSelected:x,value:n="",placeholder:p="Search for an address",required:g=!1})=>{const r=i.useRef(null),o=i.useRef(null);return i.useEffect(()=>{r.current&&n&&(r.current.value=n)},[n]),i.useEffect(()=>{const j="AIzaSyDJvwpR_epAanY-ayIYf8AZmjUu2IgFpdc",u=()=>{if(!r.current){setTimeout(u,100);return}if(!window.google||!window.google.maps||!window.google.maps.places){setTimeout(u,200);return}try{o.current&&google.maps.event.clearInstanceListeners(o.current);const m={types:["geocode","establishment"],componentRestrictions:{country:"vn"},fields:["formatted_address","geometry","name"]};o.current=new google.maps.places.Autocomplete(r.current,m),setTimeout(()=>{document.querySelector(".pac-container")},1e3),o.current.addListener("place_changed",()=>{var c;const t=(c=o.current)==null?void 0:c.getPlace();if(!t||!t.geometry||!t.geometry.location)return;const l={address:t.formatted_address||"",latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()};r.current&&(r.current.value=l.address),x(l)})}catch{}};return(()=>{if(E||window.google&&window.google.maps&&window.google.maps.places){E=!0,u();return}if(L){A.push(u);return}const m=document.querySelector('script[src*="maps.googleapis.com"]');if(m){L=!0,m.addEventListener("load",()=>{E=!0,L=!1,u(),A.forEach(c=>c()),A.length=0});return}const t=`https://maps.googleapis.com/maps/api/js?key=${j}&libraries=places`;L=!0;const l=document.createElement("script");l.src=t,l.async=!0,l.defer=!0,l.onload=()=>{E=!0,L=!1,u(),A.forEach(c=>c()),A.length=0},l.onerror=()=>{L=!1},document.head.appendChild(l)})(),()=>{if(o.current&&window.google&&window.google.maps)try{google.maps.event.clearInstanceListeners(o.current)}catch{}}},[x]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
				.pac-container {
					z-index: 9999 !important;
					position: fixed !important;
				}
			`}),e.jsx("div",{style:{position:"relative"},children:e.jsx(a.Control,{ref:r,type:"text",defaultValue:n,placeholder:p,required:g,autoComplete:"off",id:"google-places-autocomplete-input"})})]})};const ge=()=>{var M;const x=ee(),[n,p]=i.useState(1),[g]=i.useState(10),[r,o]=i.useState("new"),[j,u]=i.useState(""),[C,m]=i.useState(!1),[t,l]=i.useState({bookingTime:"",customerId:"",customerName:"",customerPhone:"",latitude:0,longitude:0,address:"",items:[]}),[c,S]=i.useState(""),[v,b]=i.useState(1),{data:d,isLoading:D,error:R,refetch:K}=re({page:n,pageSize:g}),w=ne(),{data:$=[],isLoading:Q}=ie(),I={new:(d==null?void 0:d.total)||0,verification:0,approval:0,processed:0},Y=async s=>{if(s.preventDefault(),!c){alert("Please select a product");return}try{const P={...t,bookingTime:new Date(t.bookingTime).toISOString(),items:[{productId:c,quantity:v}]};await w.mutateAsync(P),m(!1),l({bookingTime:"",customerId:"",customerName:"",customerPhone:"",latitude:0,longitude:0,address:"",items:[]}),S(""),b(1)}catch{}},J=s=>{l(P=>({...P,address:s.address,latitude:s.latitude,longitude:s.longitude}))},T=(s=>$.find(P=>P.id===s))(c),Z=(d==null?void 0:d.items)||[];return e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Booking Management",subName:"Apps"}),e.jsx(k,{children:e.jsx(N,{xs:12,children:e.jsx(V,{children:e.jsxs(V.Body,{children:[e.jsxs(f,{variant:"tabs",className:"nav-bordered mb-4",children:[e.jsx(f.Item,{children:e.jsxs(f.Link,{active:r==="new",onClick:()=>o("new"),className:"d-flex align-items-center gap-2",children:["New",I.new>0&&e.jsx(h,{bg:"danger",className:"ms-1",children:I.new})]})}),e.jsx(f.Item,{children:e.jsxs(f.Link,{active:r==="verification",onClick:()=>o("verification"),className:"d-flex align-items-center gap-2",children:["Verification Due",I.verification>0]})}),e.jsx(f.Item,{children:e.jsxs(f.Link,{active:r==="approval",onClick:()=>o("approval"),className:"d-flex align-items-center gap-2",children:["Approval Due",I.approval>0]})}),e.jsx(f.Item,{children:e.jsxs(f.Link,{active:r==="processed",onClick:()=>o("processed"),className:"d-flex align-items-center gap-2",children:["Processed",I.processed>0]})})]}),e.jsx(k,{className:"mb-4",children:e.jsx(N,{md:12,children:e.jsxs("div",{className:"position-relative",children:[e.jsx("i",{className:"mdi mdi-magnify position-absolute top-50 start-0 translate-middle-y ms-3 text-muted",style:{fontSize:"18px"}}),e.jsx(a.Control,{type:"text",placeholder:"Search bookings by customer name...",value:j,onChange:s=>u(s.target.value),className:"ps-5"})]})})}),e.jsx(k,{className:"mb-4",children:e.jsx(N,{xs:12,children:e.jsxs(ue,{className:"mb-2 gap-1",children:[e.jsxs(y,{variant:"primary",size:"sm",onClick:()=>m(!0),children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Create Booking"]}),e.jsxs(y,{variant:"secondary",size:"sm",onClick:()=>K(),children:[e.jsx("i",{className:"mdi mdi-refresh me-1"}),"Reload"]})]})})}),R&&e.jsxs(_,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",R instanceof Error?R.message:"Failed to load bookings"]}),D?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(F,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading bookings..."})]}):d!=null&&d.items&&d.items.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-centered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer Name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Booking Time"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:Z.map(s=>e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>x(`/apps/booking/${s.id}`),children:[e.jsx("td",{children:e.jsx("strong",{children:s.customerName||"N/A"})}),e.jsx("td",{children:s.customerPhone||"-"}),e.jsx("td",{className:"text-muted",children:e.jsx("small",{children:s.address||"-"})}),e.jsx("td",{children:new Date(s.bookingTime).toLocaleString("vi-VN")}),e.jsx("td",{children:s.items&&s.items.length>0?e.jsxs(h,{bg:"info",children:[s.items.length," items"]}):s.totalPrice?e.jsxs(h,{bg:"secondary",children:[s.totalPrice.toLocaleString("vi-VN")," VND"]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:typeof s.status=="number"?e.jsxs(e.Fragment,{children:[s.status===1&&e.jsx(h,{bg:"info",children:"Created"}),s.status===2&&e.jsx(h,{bg:"primary",children:"Assigned"}),s.status===3&&e.jsx(h,{bg:"warning",children:"In Progress"}),s.status===4&&e.jsx(h,{bg:"success",children:"Done"}),s.status===5&&e.jsx(h,{bg:"danger",children:"Failed"}),s.status===6&&e.jsx(h,{bg:"secondary",children:"Cancelled"}),[1,2,3,4,5,6].indexOf(s.status)===-1&&e.jsxs(h,{bg:"secondary",children:["Status ",s.status]})]}):e.jsx(h,{bg:"info",children:s.status||"Unknown"})}),e.jsx("td",{children:s.createdAt?new Date(s.createdAt).toLocaleDateString("vi-VN"):"-"})]},s.id))})]})}),e.jsx(k,{className:"mt-4",children:e.jsx(N,{xs:12,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",d.items.length," of ",d.total," bookings"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(y,{variant:"secondary",size:"sm",disabled:n===1,onClick:()=>p(n-1),children:"Previous"}),e.jsxs(y,{variant:"secondary",size:"sm",disabled:!0,children:["Page ",n," of ",d.totalPages]}),e.jsx(y,{variant:"secondary",size:"sm",disabled:n>=d.totalPages,onClick:()=>p(n+1),children:"Next"})]})]})})})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No bookings found"}),e.jsx(y,{variant:"primary",onClick:()=>m(!0),children:"Create First Booking"})]})]})})})}),e.jsxs(B,{show:C,onHide:()=>m(!1),size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Create New Booking"})}),e.jsxs(a,{onSubmit:Y,children:[e.jsxs(B.Body,{children:[w.isError&&e.jsxs(_,{variant:"danger",dismissible:!0,children:["Failed to create booking: ",((M=w.error)==null?void 0:M.message)||"Unknown error"]}),e.jsxs(k,{children:[e.jsx(N,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Customer Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Enter customer name",value:t.customerName,onChange:s=>l({...t,customerName:s.target.value}),required:!0})]})}),e.jsx(N,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Customer Phone *"}),e.jsx(a.Control,{type:"tel",placeholder:"0352978519",value:t.customerPhone,onChange:s=>l({...t,customerPhone:s.target.value}),required:!0})]})})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Customer ID *"}),e.jsx(a.Control,{type:"text",placeholder:"Enter customer ID (UUID)",value:t.customerId,onChange:s=>l({...t,customerId:s.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Address *"}),e.jsx(pe,{value:t.address,onPlaceSelected:J,placeholder:"Search for an address using Google Maps",required:!0})]}),t.latitude!==0&&t.longitude!==0&&e.jsx(_,{variant:"info",className:"mb-3",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Coordinates:"})," ",t.latitude.toFixed(6),", ",t.longitude.toFixed(6)]})}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Booking Time *"}),e.jsx(a.Control,{type:"datetime-local",value:t.bookingTime,onChange:s=>l({...t,bookingTime:s.target.value}),required:!0})]}),e.jsxs(k,{children:[e.jsx(N,{md:8,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Select Product *"}),Q?e.jsxs("div",{className:"text-center py-2",children:[e.jsx(F,{animation:"border",size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading products..."})]}):e.jsxs(a.Select,{value:c,onChange:s=>S(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Select a product --"}),$.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.price.toLocaleString("vi-VN")," VND"]},s.id))]})]})}),e.jsx(N,{md:4,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Quantity *"}),e.jsx(a.Control,{type:"number",min:"1",value:v,onChange:s=>b(parseInt(s.target.value)||1),required:!0})]})})]}),T&&e.jsxs(_,{variant:"info",className:"mb-3",children:[e.jsx("strong",{children:"Selected:"})," ",T.name," x ",v,e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:T.description}),e.jsx("hr",{className:"my-2"}),e.jsxs("strong",{children:["Total: ",(T.price*v).toLocaleString("vi-VN")," VND"]})]})]}),e.jsxs(B.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:()=>m(!1),disabled:w.isPending,children:"Cancel"}),e.jsx(y,{variant:"primary",type:"submit",disabled:w.isPending||!c||!t.address,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(F,{animation:"border",size:"sm",className:"me-2"}),"Creating..."]}):"Create Booking"})]})]})]})]})},je=i.lazy(()=>te(()=>import("./BookingDetail-29119d5f.js"),["assets/BookingDetail-29119d5f.js","assets/index-1c742463.js","assets/index-6054c063.css","assets/useBookings-56b5d18b.js","assets/useQuery-0e03b41d.js","assets/useMutation-59983a6c.js","assets/useProducts-36f8fd77.js","assets/Alert-8204e7ea.js","assets/hook-fa5e7b20.js","assets/Spinner-ad3d02ac.js","assets/Button-a842f113.js","assets/Table-82803535.js","assets/Badge-6e0fdd54.js"])),Me=()=>e.jsxs(ae,{children:[e.jsx(q,{index:!0,element:e.jsx(ge,{})}),e.jsx(q,{path:":id",element:e.jsx(i.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(F,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading booking details..."})]}),children:e.jsx(je,{})})})]});export{Me as default};
