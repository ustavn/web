import{w as N,aZ as A,r as x,j as e,P as I,d as y,f as l,h as P,v as a}from"./index-580402c3.js";import{u as S,a as L}from"./useMutation-7296d4b7.js";import{B as i}from"./Button-3ba513eb.js";import{A as w}from"./Alert-dc370370.js";import{S as F}from"./Spinner-1d091e6b.js";import{T as q}from"./Table-d9aecb8a.js";import{M as h}from"./Modal-b0bfa981.js";const E={}.VITE_API_SERVER||"http://localhost:80",p=N.create({baseURL:`${E}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});p.interceptors.request.use(async r=>{const t=localStorage.getItem("_USTA_OAUTH");if(t)try{const n=JSON.parse(t);r.headers.Authorization=`Bearer ${n.accessToken}`,console.log("[Product API] Request:",{method:r.method,url:r.url,params:r.params,data:r.data,hasAuth:!!r.headers.Authorization})}catch(n){console.error("[Product API] Failed to parse OAuth session:",n)}else console.warn("[Product API] No OAuth session found");return r},r=>(console.error("[Product API] Request error:",r),Promise.reject(r)));p.interceptors.response.use(r=>(console.log("[Product API] Response:",{status:r.status,url:r.config.url,data:r.data}),r),r=>{var t,n,u;return console.error("[Product API] Response error:",{status:(t=r.response)==null?void 0:t.status,url:(n=r.config)==null?void 0:n.url,data:(u=r.response)==null?void 0:u.data,message:r.message}),Promise.reject(r)});async function D(r={}){const{page:t=1,pageSize:n=10}=r;return console.log("[Product API] Fetching products:",{page:t,pageSize:n}),(await p.get("/products/",{params:{page:t,pageSize:n}})).data}async function R(r){console.log("[Product API] Creating product:",r);const t=await p.post("/products/",r);return console.log("[Product API] Product created successfully:",t.data),t.data}function T(r={}){return S({queryKey:["products",r],queryFn:()=>D(r),staleTime:3e4,retry:2})}function z(){const r=A();return L({mutationFn:t=>R(t),onSuccess:t=>{console.log("[useCreateProduct] Product created successfully:",t),r.invalidateQueries({queryKey:["products"]})},onError:t=>{console.error("[useCreateProduct] Failed to create product:",t)}})}const B=()=>{const[r,t]=x.useState(1),[n]=x.useState(10),[u,m]=x.useState(!1),[o,d]=x.useState({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""}),{data:c,isLoading:C,error:j,refetch:v}=T({page:r,pageSize:n}),g=z(),b=async s=>{s.preventDefault();try{await g.mutateAsync(o),m(!1),d({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""})}catch(f){console.error("Failed to create product:",f)}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Products",subName:"Apps"}),e.jsx(y,{children:e.jsx(l,{xs:12,children:e.jsx(P,{children:e.jsxs(P.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h4",{className:"header-title",children:"Products List"}),e.jsxs(i,{variant:"primary",onClick:()=>m(!0),children:[e.jsx("i",{className:"mdi mdi-plus-circle me-1"}),"Create Product"]})]}),j&&e.jsxs(w,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",j instanceof Error?j.message:"Failed to load products"]}),C?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(F,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading products..."})]}):c!=null&&c.items&&c.items.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(q,{striped:!0,hover:!0,className:"mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Category ID"}),e.jsx("th",{children:"Level Code"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:c.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsxs("td",{children:["$",s.price.toFixed(2)]}),e.jsxs("td",{children:[s.duration," days"]}),e.jsx("td",{children:e.jsx("small",{className:"text-muted",children:s.categoryId})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-info",children:s.categoryLevelCode})}),e.jsx("td",{children:s.description}),e.jsx("td",{children:new Date(s.createdAt).toLocaleDateString()})]},s.id))})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",c.items.length," of ",c.total," products"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(i,{variant:"secondary",size:"sm",disabled:r===1,onClick:()=>t(r-1),children:"Previous"}),e.jsxs(i,{variant:"secondary",size:"sm",disabled:!0,children:["Page ",r," of ",c.totalPages]}),e.jsx(i,{variant:"secondary",size:"sm",disabled:r>=c.totalPages,onClick:()=>t(r+1),children:"Next"})]})]})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No products found"}),e.jsx(i,{variant:"primary",onClick:()=>v(),children:"Reload"})]})]})})})}),e.jsxs(h,{show:u,onHide:()=>m(!1),size:"lg",children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:"Create New Product"})}),e.jsxs(a,{onSubmit:b,children:[e.jsxs(h.Body,{children:[e.jsxs(y,{children:[e.jsx(l,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Product Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Enter product name",value:o.name,onChange:s=>d({...o,name:s.target.value}),required:!0})]})}),e.jsx(l,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Category ID *"}),e.jsx(a.Control,{type:"text",placeholder:"Enter category ID",value:o.categoryId,onChange:s=>d({...o,categoryId:s.target.value}),required:!0})]})})]}),e.jsxs(y,{children:[e.jsx(l,{md:4,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Price *"}),e.jsx(a.Control,{type:"number",step:"0.01",placeholder:"0.00",value:o.price,onChange:s=>d({...o,price:parseFloat(s.target.value)}),required:!0})]})}),e.jsx(l,{md:4,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Duration (days) *"}),e.jsx(a.Control,{type:"number",placeholder:"30",value:o.duration,onChange:s=>d({...o,duration:parseInt(s.target.value)}),required:!0})]})}),e.jsx(l,{md:4,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Level Code *"}),e.jsx(a.Control,{type:"text",placeholder:"A1",value:o.categoryLevelCode,onChange:s=>d({...o,categoryLevelCode:s.target.value}),required:!0})]})})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Description *"}),e.jsx(a.Control,{as:"textarea",rows:3,placeholder:"Enter product description",value:o.description,onChange:s=>d({...o,description:s.target.value}),required:!0})]})]}),e.jsxs(h.Footer,{children:[e.jsx(i,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(i,{variant:"primary",type:"submit",disabled:g.isPending,children:g.isPending?"Creating...":"Create Product"})]})]})]})]})},U=()=>e.jsx(B,{});export{U as default};
