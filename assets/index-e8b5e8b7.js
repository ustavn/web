import{a5 as L,a6 as P,a as F,r as o,j as e,P as M,d as f,f as p,h as C,_ as B,R as q,c as v}from"./index-9308ce58.js";import{u as S}from"./useQuery-c70f6f03.js";import{u as E}from"./useMutation-c1343e68.js";import{F as a}from"./Form-cd0d4eb5.js";import{B as j}from"./Button-a72771ea.js";import{A as R}from"./Alert-df8dc521.js";import{S as N}from"./Spinner-2dd1d419.js";import{T as z}from"./Table-e72921c2.js";import{B as b}from"./Badge-045f9fac.js";import{M as i}from"./Modal-e637370f.js";const D="https://api.dev.usta.vn",c=L.create({baseURL:`${D}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});c.interceptors.request.use(async s=>{const r=localStorage.getItem("_USTA_OAUTH");if(r)try{const l=JSON.parse(r);s.headers.Authorization=`Bearer ${l.accessToken}`}catch{}return s},s=>Promise.reject(s));c.interceptors.response.use(s=>s,s=>Promise.reject(s));async function k(s={}){const r=await c.get("/zones/",{params:s});if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to fetch zones")}async function I(s){const r=await c.post("/zones/",s);if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to create zone")}async function O(s){return(await c.get(`/zones/${s}`)).data}function Q(s={}){return S({queryKey:["zones",s],queryFn:()=>k(s),staleTime:3e4,retry:2,select:r=>r||[]})}function ae(s){return S({queryKey:["zone",s],queryFn:()=>O(s),enabled:!!s,staleTime:3e4})}function $(){const s=P();return E({mutationFn:r=>I(r),onSuccess:()=>{s.invalidateQueries({queryKey:["zones"]})}})}const G=()=>{const s=F(),[r,l]=o.useState(""),[w,d]=o.useState(!1),[n,u]=o.useState({name:"",code:"",description:""}),{data:h=[],isLoading:Z,error:y}=Q(),m=$(),g=h.filter(t=>t.name.toLowerCase().includes(r.toLowerCase())||t.code.toLowerCase().includes(r.toLowerCase())),A=o.useMemo(()=>{const t=new Map;return h.forEach(x=>{t.set(x.id,x.name)}),t},[h]),_=t=>t?A.get(t)||t:"-",T=async t=>{t.preventDefault();try{await m.mutateAsync(n),d(!1),u({name:"",code:"",description:""})}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:"Zone Management",subName:"Apps"}),e.jsx(f,{children:e.jsx(p,{xs:12,children:e.jsx(C,{children:e.jsxs(C.Body,{children:[e.jsxs(f,{className:"mb-3",children:[e.jsx(p,{md:6,children:e.jsx(a.Control,{type:"text",placeholder:"Search zones...",value:r,onChange:t=>l(t.target.value)})}),e.jsx(p,{md:6,className:"text-end",children:e.jsxs(j,{variant:"primary",onClick:()=>d(!0),children:[e.jsx("i",{className:"uil uil-plus me-1"})," Create Zone"]})})]}),y&&e.jsxs(R,{variant:"danger",dismissible:!0,children:["Failed to load zones: ",y.message]}),Z?e.jsx("div",{className:"text-center py-5",children:e.jsx(N,{animation:"border",variant:"primary"})}):e.jsxs(z,{hover:!0,responsive:!0,children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Parent Zone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-muted",children:"No zones found"})}):g.map(t=>e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>s(`/apps/zones/${t.id}/children`),children:[e.jsx("td",{children:e.jsx("strong",{children:t.code})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.description||"-"}),e.jsx("td",{children:_(t.parentId)}),e.jsx("td",{children:t.isActive!==void 0?t.isActive?e.jsx(b,{bg:"success",children:"Active"}):e.jsx(b,{bg:"secondary",children:"Inactive"}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString("vi-VN")})]},t.id))})]})]})})})}),e.jsxs(i,{show:w,onHide:()=>d(!1),children:[e.jsx(i.Header,{closeButton:!0,children:e.jsx(i.Title,{children:"Create New Zone"})}),e.jsxs(a,{onSubmit:T,children:[e.jsxs(i.Body,{children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Zone Code *"}),e.jsx(a.Control,{type:"text",placeholder:"Q5",value:n.code,onChange:t=>u({...n,code:t.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Zone Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Quan 5",value:n.name,onChange:t=>u({...n,name:t.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Description"}),e.jsx(a.Control,{as:"textarea",rows:3,placeholder:"trung tam tp",value:n.description,onChange:t=>u({...n,description:t.target.value})})]})]}),e.jsxs(i.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(j,{variant:"primary",type:"submit",disabled:m.isPending,children:m.isPending?"Creating...":"Create Zone"})]})]})]})]})},H=o.lazy(()=>B(()=>import("./ChildZonesApp-4edbe594.js"),["assets/ChildZonesApp-4edbe594.js","assets/index-9308ce58.js","assets/index-fab365ac.css","assets/Button-a72771ea.js","assets/Form-cd0d4eb5.js","assets/ElementChildren-22165a44.js","assets/Alert-df8dc521.js","assets/hook-cb2b274d.js","assets/Spinner-2dd1d419.js","assets/Table-e72921c2.js","assets/Badge-045f9fac.js","assets/Modal-e637370f.js","assets/AbstractModalHeader-819737c0.js","assets/useWindow-fbffecd1.js","assets/hasClass-90f06ff9.js","assets/useMergedRefs-07a15c37.js","assets/DataKey-e12315fd.js","assets/useQuery-c70f6f03.js","assets/useMutation-c1343e68.js"])),K=()=>e.jsxs(q,{children:[e.jsx(v,{index:!0,element:e.jsx(G,{})}),e.jsx(v,{path:":parentId/children",element:e.jsx(o.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(N,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading..."})]}),children:e.jsx(H,{})})})]}),ne=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{Q as a,$ as b,ne as i,ae as u};
