import{o as F,U as T,a as L,r as o,j as e,P as M,d as f,f as p,h as C,_ as B,R,c as v}from"./index-7abc2e1c.js";import{u as S}from"./useQuery-fef0428f.js";import{u as q}from"./useMutation-04d1b243.js";import{F as a}from"./Form-3dd09149.js";import{B as j}from"./Button-98115848.js";import{A as z}from"./Alert-970a7765.js";import{S as N}from"./Spinner-f490c646.js";import{T as E}from"./Table-2e1e6572.js";import{B as b}from"./Badge-f7a378fe.js";import{M as c}from"./Modal-d1b37a71.js";const D="https://api.dev.usta.vn",l=F.create({baseURL:`${D}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(async t=>{const r=localStorage.getItem("_USTA_OAUTH");if(r)try{const i=JSON.parse(r);t.headers.Authorization=`Bearer ${i.accessToken}`}catch(i){console.error("[Zone API] Failed to parse OAuth session:",i)}return t},t=>Promise.reject(t));l.interceptors.response.use(t=>t,t=>{var r;return console.error("[Zone API] Response error:",((r=t.response)==null?void 0:r.data)||t.message),Promise.reject(t)});async function I(t={}){const r=await l.get("/zones/",{params:t});if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to fetch zones")}async function O(t){const r=await l.post("/zones/",t);if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to create zone")}async function k(t){return(await l.get(`/zones/${t}`)).data}function Q(t={}){return S({queryKey:["zones",t],queryFn:()=>I(t),staleTime:3e4,retry:2,select:r=>r||[]})}function ae(t){return S({queryKey:["zone",t],queryFn:()=>k(t),enabled:!!t,staleTime:3e4})}function U(){const t=T();return q({mutationFn:r=>O(r),onSuccess:()=>{t.invalidateQueries({queryKey:["zones"]})}})}const $=()=>{const t=L(),[r,i]=o.useState(""),[w,d]=o.useState(!1),[n,u]=o.useState({name:"",code:"",description:""}),{data:m=[],isLoading:Z,error:y}=Q(),x=U(),g=m.filter(s=>s.name.toLowerCase().includes(r.toLowerCase())||s.code.toLowerCase().includes(r.toLowerCase())),A=o.useMemo(()=>{const s=new Map;return m.forEach(h=>{s.set(h.id,h.name)}),s},[m]),_=s=>s?A.get(s)||s:"-",P=async s=>{s.preventDefault();try{await x.mutateAsync(n),d(!1),u({name:"",code:"",description:""})}catch(h){console.error("Failed to create zone:",h)}};return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:"Zone Management",subName:"Apps"}),e.jsx(f,{children:e.jsx(p,{xs:12,children:e.jsx(C,{children:e.jsxs(C.Body,{children:[e.jsxs(f,{className:"mb-3",children:[e.jsx(p,{md:6,children:e.jsx(a.Control,{type:"text",placeholder:"Search zones...",value:r,onChange:s=>i(s.target.value)})}),e.jsx(p,{md:6,className:"text-end",children:e.jsxs(j,{variant:"primary",onClick:()=>d(!0),children:[e.jsx("i",{className:"uil uil-plus me-1"})," Create Zone"]})})]}),y&&e.jsxs(z,{variant:"danger",dismissible:!0,children:["Failed to load zones: ",y.message]}),Z?e.jsx("div",{className:"text-center py-5",children:e.jsx(N,{animation:"border",variant:"primary"})}):e.jsxs(E,{hover:!0,responsive:!0,children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Parent Zone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-muted",children:"No zones found"})}):g.map(s=>e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>t(`/apps/zones/${s.id}/children`),children:[e.jsx("td",{children:e.jsx("strong",{children:s.code})}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.description||"-"}),e.jsx("td",{children:_(s.parentId)}),e.jsx("td",{children:s.isActive!==void 0?s.isActive?e.jsx(b,{bg:"success",children:"Active"}):e.jsx(b,{bg:"secondary",children:"Inactive"}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:new Date(s.createdAt).toLocaleDateString("vi-VN")})]},s.id))})]})]})})})}),e.jsxs(c,{show:w,onHide:()=>d(!1),children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx(c.Title,{children:"Create New Zone"})}),e.jsxs(a,{onSubmit:P,children:[e.jsxs(c.Body,{children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Zone Code *"}),e.jsx(a.Control,{type:"text",placeholder:"Q5",value:n.code,onChange:s=>u({...n,code:s.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Zone Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Quan 5",value:n.name,onChange:s=>u({...n,name:s.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Description"}),e.jsx(a.Control,{as:"textarea",rows:3,placeholder:"trung tam tp",value:n.description,onChange:s=>u({...n,description:s.target.value})})]})]}),e.jsxs(c.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(j,{variant:"primary",type:"submit",disabled:x.isPending,children:x.isPending?"Creating...":"Create Zone"})]})]})]})]})},G=o.lazy(()=>B(()=>import("./ChildZonesApp-6e512a93.js"),["assets/ChildZonesApp-6e512a93.js","assets/index-7abc2e1c.js","assets/index-fab365ac.css","assets/Button-98115848.js","assets/Form-3dd09149.js","assets/FormControl-92329ab5.js","assets/ElementChildren-dbbb72ab.js","assets/Alert-970a7765.js","assets/hook-87ee9a06.js","assets/Spinner-f490c646.js","assets/Table-2e1e6572.js","assets/Badge-f7a378fe.js","assets/Modal-d1b37a71.js","assets/AbstractModalHeader-b51e44f5.js","assets/useWindow-25e16477.js","assets/hasClass-d6dc9e47.js","assets/useMergedRefs-c0c7f279.js","assets/DataKey-e12315fd.js","assets/useQuery-fef0428f.js","assets/useMutation-04d1b243.js"])),H=()=>e.jsxs(R,{children:[e.jsx(v,{index:!0,element:e.jsx($,{})}),e.jsx(v,{path:":parentId/children",element:e.jsx(o.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(N,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading..."})]}),children:e.jsx(G,{})})})]}),ne=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}));export{Q as a,U as b,ne as i,ae as u};
