import{u as a}from"./useQuery-b845a33c.js";import{w as u,aZ as c}from"./index-9951c232.js";import{u as n}from"./useMutation-4a9c65c4.js";const d={}.VITE_API_SERVER||"http://localhost:80",o=u.create({baseURL:`${d}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(async e=>{const t=localStorage.getItem("_USTA_OAUTH");if(t)try{const r=JSON.parse(t);e.headers.Authorization=`Bearer ${r.accessToken}`,console.log("[Product API] Request:",{method:e.method,url:e.url,params:e.params,data:e.data,hasAuth:!!e.headers.Authorization})}catch(r){console.error("[Product API] Failed to parse OAuth session:",r)}else console.warn("[Product API] No OAuth session found");return e},e=>(console.error("[Product API] Request error:",e),Promise.reject(e)));o.interceptors.response.use(e=>(console.log("[Product API] Response:",{status:e.status,url:e.config.url,data:e.data}),e),e=>{var t,r,s;return console.error("[Product API] Response error:",{status:(t=e.response)==null?void 0:t.status,url:(r=e.config)==null?void 0:r.url,data:(s=e.response)==null?void 0:s.data,message:e.message}),Promise.reject(e)});async function l(e={}){console.log("[Product API] Fetching products:",e);const t=await o.get("/products/");if(t.data.success)return t.data.data;throw new Error(t.data.error||"Failed to fetch products")}async function i(e){console.log("[Product API] Creating product:",e);const t=await o.post("/products/",e);if(console.log("[Product API] Product created successfully:",t.data),t.data.success)return t.data.data;throw new Error(t.data.error||"Failed to create product")}function A(e={}){return a({queryKey:["products",e],queryFn:()=>l(e),staleTime:3e4,retry:2,select:t=>t||[]})}function m(){const e=c();return n({mutationFn:t=>i(t),onSuccess:t=>{console.log("[useCreateProduct] Product created successfully:",t),e.invalidateQueries({queryKey:["products"]})},onError:t=>{console.error("[useCreateProduct] Failed to create product:",t)}})}export{m as a,A as u};
