import{j as e,r as S,P as w,d as y,f as x,h as T,ac as A,M as k}from"./index-35a78008.js";import{u as M,C as B}from"./index.esm-f89094ce.js";import{F as h}from"./Form-f0a37a2c.js";import{o as I,s as p,F as P,S as E,T as L}from"./schemas-c81cd94b.js";import{u as q,a as z}from"./useShifts-0fda3748.js";import{u as $}from"./useShiftSchedules-50e63ce2.js";import{A as D}from"./Alert-d8af8426.js";import{B as j}from"./Button-ffabe03d.js";import{S as v}from"./Spinner-98270fe8.js";import{M as u}from"./Modal-bd6d88a7.js";import"./useQuery-3945cef0.js";import"./useMutation-ff0a47e0.js";import"./hook-1583ce4c.js";import"./AbstractModalHeader-48429c80.js";import"./useWindow-6b101b4c.js";import"./hasClass-3fa6332f.js";import"./useMergedRefs-d2239d23.js";import"./DataKey-e12315fd.js";function N({name:s,id:t,className:r,containerClass:i,label:a,placeholder:l,helpText:n,readOnly:c,errors:d,register:m,type:o,...f}){const{control:F}=M();return e.jsx(B,{name:s,control:F,render:({field:g,fieldState:C})=>{var b;return e.jsxs(h.Group,{className:i??"",children:[a&&e.jsx(h.Label,{children:a}),e.jsx(h.Control,{type:o,id:t,...f,...g,value:g.value??"",onChange:H=>{g.onChange(H.target.value)},placeholder:l,readOnly:c,className:r,isInvalid:!!((b=C.error)!=null&&b.message)}),n&&e.jsx(h.Text,{id:`${s}-help`,muted:!0,children:n}),C.error&&e.jsx(h.Control.Feedback,{type:"invalid",children:C.error.message})]})}})}const R=[{Header:"Name",accessor:"name",defaultCanSort:!0,Cell:({value:s})=>e.jsx("strong",{children:s||"-"})},{Header:"Start Time",accessor:"startTime",defaultCanSort:!0,Cell:({value:s})=>{if(!s)return e.jsx("span",{className:"text-muted",children:"-"});const t=s.includes(":")?s.split(":").slice(0,2).join(":"):s;return e.jsx("span",{children:t})}},{Header:"End Time",accessor:"endTime",defaultCanSort:!0,Cell:({value:s})=>{if(!s)return e.jsx("span",{className:"text-muted",children:"-"});const t=s.includes(":")?s.split(":").slice(0,2).join(":"):s;return e.jsx("span",{children:t})}},{Header:"Time Zone",accessor:"timeZone",defaultCanSort:!1,Cell:({value:s})=>e.jsx("span",{className:"text-muted small",children:s||"-"})},{Header:"Created At",accessor:"createdAt",defaultCanSort:!0,Cell:({value:s})=>s?new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.jsx("span",{className:"text-muted",children:"-"})}],V=I({shiftScheduleConfigId:p().min(1,"Shift schedule configuration is required"),name:p().min(1,"Name is required"),startTime:p().min(1,"Start time is required"),endTime:p().min(1,"End time is required")}).refine(s=>{if(s.startTime&&s.endTime){const[t,r]=s.startTime.split(":").map(Number),[i,a]=s.endTime.split(":").map(Number),l=t*60+r;return i*60+a>l}return!0},{message:"End time must be after start time",path:["endTime"]}),Z=[{text:"10",value:10},{text:"25",value:25},{text:"50",value:50},{text:"100",value:100}],G=()=>{const{data:s=[],isLoading:t,error:r,refetch:i}=q(),a=z(),{data:l=[],isLoading:n}=$(),c=S.useMemo(()=>l.map(o=>({value:o.id,label:`${o.name} (${o.timeZone})`})),[l]),d=S.useCallback(async o=>{try{await a.mutateAsync(o)}catch(f){throw f}},[a]),m=S.useMemo(()=>R,[]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{title:"Shift Management",subName:"Apps"}),e.jsx(y,{children:e.jsx(x,{xs:12,children:e.jsx(T,{children:e.jsxs(T.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"card-title mb-0",children:"Shifts"}),e.jsx(J,{show:!1,scheduleOptions:c,schedulesLoading:n,onSubmit:d,createMutation:a})]}),r&&e.jsxs(D,{variant:"danger",dismissible:!0,children:["Failed to load shifts: ",r.message,e.jsx(j,{variant:"link",onClick:()=>i(),className:"p-0 ms-2",children:"Try Again"})]}),t?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(v,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading shifts..."})]}):s&&s.length>0?e.jsx(A,{columns:m,data:s,pageSize:10,sizePerPageList:Z,isSortable:!0,pagination:!0,isSearchable:!0,theadClass:"table-light"}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No shifts found"}),e.jsx(j,{variant:"link",onClick:()=>i(),children:"Try Again"})]})]})})})})]})},J=({show:s,scheduleOptions:t,schedulesLoading:r,onSubmit:i,createMutation:a})=>{const[l,n]=k.useState(s),c=async m=>{try{await i(m),n(!1)}catch{}},d=()=>{n(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"primary",onClick:()=>n(!0),children:[e.jsx("i",{className:"mdi mdi-plus-circle me-1"}),"Create Shift"]}),e.jsxs(u,{show:l,onHide:d,size:"lg",children:[e.jsx(u.Header,{closeButton:!0,children:e.jsx(u.Title,{children:"Create New Shift"})}),e.jsxs(P,{schema:V,onSubmit:c,defaultValues:{shiftScheduleConfigId:"",name:"",startTime:"",endTime:""},children:[e.jsx(u.Body,{children:e.jsxs(y,{children:[e.jsx(x,{md:12,children:e.jsxs(E,{name:"shiftScheduleConfigId",label:e.jsxs(e.Fragment,{children:["Shift Schedule Config ",e.jsx("span",{className:"text-danger",children:"*"})]}),placeholder:"Select a shift schedule config",disabled:r,containerClass:"mb-3",children:[!r&&t.length===0&&e.jsx("option",{value:"",children:"No schedules available"}),t.map(m=>e.jsx("option",{value:m.value,children:m.label},m.value))]})}),e.jsx(x,{md:12,children:e.jsx(L,{name:"name",type:"text",label:e.jsxs(e.Fragment,{children:["Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),placeholder:"e.g., Ca 1, Ca 2",containerClass:"mb-3"})}),e.jsx(x,{md:6,children:e.jsx(N,{name:"startTime",type:"time",label:e.jsxs(e.Fragment,{children:["Start Time ",e.jsx("span",{className:"text-danger",children:"*"})]}),helpText:"Format: HH:mm (e.g., 08:00)",containerClass:"mb-3"})}),e.jsx(x,{md:6,children:e.jsx(N,{name:"endTime",type:"time",label:e.jsxs(e.Fragment,{children:["End Time ",e.jsx("span",{className:"text-danger",children:"*"})]}),helpText:"Format: HH:mm (e.g., 14:00)",containerClass:"mb-3"})})]})}),e.jsxs(u.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:d,disabled:a.isPending,children:"Cancel"}),e.jsx(j,{variant:"primary",type:"submit",disabled:a.isPending,children:a.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{animation:"border",size:"sm",className:"me-1"}),"Creating..."]}):"Create Shift"})]})]})]})]})},ce=()=>e.jsx(G,{});export{ce as default};
