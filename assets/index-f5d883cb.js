import{j as e,a as T,r,P as z,d as w,f as k,h as P,ab as B}from"./index-d44dc752.js";import{u as F,a as H,b as I}from"./useTechnicians-b01d9699.js";import{B as D}from"./ButtonGroup-0b64c6d4.js";import{B as p}from"./Button-8fe46466.js";import{S as A}from"./Spinner-cb54056f.js";import{B as g}from"./Badge-81770580.js";import{F as b}from"./Form-67e6f44c.js";import{A as L}from"./Alert-e383ae4d.js";import"./useQuery-bcafff71.js";import"./useMutation-e99f167c.js";import"./hook-d4a5a220.js";const M=({onApprove:m,onReject:d,onViewDetail:v,processingId:h,isApproving:c,isRejecting:u,needsApproval:f,getStatusBadge:x,getRatingStars:j})=>[{Header:"Name",accessor:"name",defaultCanSort:!0,Cell:({row:s})=>{const t=s.original;return e.jsxs("div",{children:[e.jsx("strong",{children:t.name}),t.address&&e.jsx("div",{className:"text-muted small",children:t.address})]})}},{Header:"Phone",accessor:"phone",defaultCanSort:!0},{Header:"Email",accessor:"email",defaultCanSort:!0,Cell:({value:s})=>s||e.jsx("span",{className:"text-muted",children:"-"})},{Header:"Specialization",accessor:"specialization",defaultCanSort:!1,Cell:({value:s})=>s||e.jsx("span",{className:"text-muted",children:"-"})},{Header:"Rating",accessor:"rating",defaultCanSort:!0,Cell:({row:s})=>{const t=s.original;return j(t.rating)}},{Header:"Status",accessor:"status",defaultCanSort:!0,Cell:({row:s})=>{const t=s.original;return x(t.status)}},{Header:"Created At",accessor:"createdAt",defaultCanSort:!0,Cell:({value:s})=>new Date(s).toLocaleDateString("vi-VN")},{Header:"Actions",accessor:"id",defaultCanSort:!1,Cell:({row:s})=>{const t=s.original,o=h===t.id,l=f(t);return e.jsx("div",{className:"d-flex gap-1",children:e.jsxs(D,{size:"sm",className:"gap-1",children:[e.jsx(p,{variant:"info",onClick:i=>{i.stopPropagation(),v(t)},title:"View Details",children:e.jsx("i",{className:"mdi mdi-eye"})}),l&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"success",onClick:i=>{i.stopPropagation(),m(t)},disabled:o,title:"Approve",children:o&&c?e.jsxs(e.Fragment,{children:[e.jsx(A,{animation:"border",size:"sm",className:"me-1"}),"Approving..."]}):"Approve"}),e.jsx(p,{variant:"danger",onClick:i=>{i.stopPropagation(),d(t)},disabled:o,title:"Reject",children:o&&u?e.jsxs(e.Fragment,{children:[e.jsx(A,{animation:"border",size:"sm",className:"me-1"}),"Rejecting..."]}):"Reject"})]})]})})}}],E=[{text:"10",value:10},{text:"25",value:25},{text:"50",value:50},{text:"100",value:100}],V=()=>{const m=T(),[d,v]=r.useState(void 0),[h,c]=r.useState(null),{data:u=[],isLoading:f,error:x,refetch:j}=F(d!==void 0?{status:d}:{}),s=H(),t=I(),o=r.useCallback(a=>{switch(a){case 1:return e.jsx(g,{bg:"info",children:"Pending"});case 2:return e.jsx(g,{bg:"success",children:"Approved"});case 3:return e.jsx(g,{bg:"danger",children:"Rejected"});default:return e.jsx(g,{bg:"secondary",children:"Unknown"})}},[]),l=r.useCallback(a=>a.status===1,[]),i=r.useCallback(async a=>{if(!l(a))return;const n=a.name||a.phone||a.id||"this technician";if(window.confirm(`Are you sure you want to approve ${n}?`)){c(a.id);try{await s.mutateAsync({technicianId:a.id,profileId:a.profileId,skills:a.skills,zones:a.zones})}catch{}finally{c(null)}}},[l,s]),N=r.useCallback(async a=>{const n=a.name||a.phone||a.id||"this technician",C=window.prompt(`Enter reason for rejecting ${n} (optional):`);if(C!==null&&window.confirm(`Are you sure you want to reject ${n}?`)){c(a.id);try{await t.mutateAsync({technicianId:a.id,reason:C||void 0})}catch{}finally{c(null)}}},[t]),S=r.useCallback(a=>{if(!a)return e.jsx("span",{className:"text-muted",children:"No rating"});const n="â­".repeat(Math.round(a));return e.jsxs("span",{children:[n," (",a.toFixed(1),")"]})},[]),y=r.useCallback(a=>{m(`/apps/technicians/${a.id}`)},[m]),R=r.useMemo(()=>M({onApprove:i,onReject:N,onViewDetail:y,processingId:h,isApproving:s.isPending,isRejecting:t.isPending,needsApproval:l,getStatusBadge:o,getRatingStars:S}),[i,N,y,h,s.isPending,t.isPending,l,o,S]);return e.jsxs(e.Fragment,{children:[e.jsx(z,{title:"Technician Management",subName:"Apps"}),e.jsx(w,{children:e.jsx(k,{xs:12,children:e.jsx(P,{children:e.jsxs(P.Body,{children:[e.jsx(w,{className:"mb-3",children:e.jsx(k,{md:4,children:e.jsxs(b.Group,{children:[e.jsx(b.Label,{children:"Filter by Status"}),e.jsxs(b.Select,{value:d??"",onChange:a=>{const n=a.target.value;v(n===""?void 0:Number(n))},children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:1,children:"Pending"}),e.jsx("option",{value:2,children:"Approved"}),e.jsx("option",{value:3,children:"Rejected"})]})]})})}),x&&e.jsxs(L,{variant:"danger",dismissible:!0,children:["Failed to load technicians: ",x.message,e.jsx(p,{variant:"link",onClick:()=>j(),children:"Try Again"})]}),f?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(A,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading technicians..."})]}):u&&u.length>0?e.jsx(B,{columns:R,data:u,pageSize:10,sizePerPageList:E,isSortable:!0,pagination:!0,isSearchable:!0,theadClass:"table-light"}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No technicians found"}),e.jsx(p,{variant:"link",onClick:()=>j(),children:"Try Again"})]})]})})})})]})},_=()=>e.jsx(V,{});export{_ as default};
