import{r as w,j as e,ac as R,a as V,a5 as M,P as f,d as m,f as o,h as l}from"./index-3f07c11f.js";import{g as U}from"./index-6ea3e850.js";import{b as q,c as H,d as _,e as $,f as G,g as Q,h as Y}from"./useBookings-af98a679.js";import{u as O}from"./useProducts-29de8629.js";import{A as P}from"./Alert-2d9d9927.js";import{S as N}from"./Spinner-2c23172c.js";import{B as x}from"./Button-783be344.js";import{B as W}from"./ButtonGroup-565edf9e.js";import{T as J}from"./Table-f902b5eb.js";import{B as K}from"./Badge-abfe1df2.js";import"./Form-db521678.js";import"./ElementChildren-96ca08f1.js";import"./Modal-b572be97.js";import"./AbstractModalHeader-b559c3ca.js";import"./useWindow-da4d5222.js";import"./hasClass-c453d1e7.js";import"./useMergedRefs-0799c755.js";import"./DataKey-e12315fd.js";import"./hook-5d5166a1.js";import"./Nav-d24aed90.js";import"./NavContext-d9337656.js";import"./NavbarContext-26638ae1.js";import"./useQuery-dc21cdee.js";import"./useMutation-0895c265.js";const Z=({latitude:t,longitude:p,address:c,height:k="400px"})=>{const s=w.useRef(null),j=w.useRef(null),r=w.useRef(null);return w.useEffect(()=>{const u="AIzaSyDJvwpR_epAanY-ayIYf8AZmjUu2IgFpdc";if(!s.current)return;const g=()=>{if(!window.google||!window.google.maps){setTimeout(g,100);return}try{const n={lat:t,lng:p};if(j.current)j.current.setCenter(n),r.current&&r.current.setPosition(n);else{const d=new window.google.maps.Map(s.current,{center:n,zoom:15,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0});j.current=d;const a=new window.google.maps.Marker({position:n,map:d,title:c||"Booking Location"});if(r.current=a,c){const b=new window.google.maps.InfoWindow({content:`<div><strong>Booking Location</strong><br/>${c}</div>`});a.addListener("click",()=>{b.open(d,a)}),b.open(d,a)}}}catch(n){console.error("Error initializing map:",n)}};if(window.google&&window.google.maps)g();else{const n=document.querySelector('script[src*="maps.googleapis.com"]');if(n)n.addEventListener("load",()=>{g()});else{const d=`https://maps.googleapis.com/maps/api/js?key=${u}&libraries=places`,a=document.createElement("script");a.src=d,a.async=!0,a.defer=!0,a.onload=()=>{g()},document.head.appendChild(a)}}return()=>{var n;r.current&&((n=window.google)!=null&&n.maps)&&r.current.setMap(null)}},[t,p,c]),e.jsx("div",{ref:s,style:{width:"100%",height:k,borderRadius:"8px",overflow:"hidden",border:"1px solid #dee2e6"}})},we=()=>{var A,D;const{id:t}=R(),p=V(),{showNotification:c}=M(),k=q(t||""),{data:s,isLoading:j,error:r,isError:u}=k,{data:g=[]}=O();w.useEffect(()=>{u&&r&&c(r instanceof Error?r.message:"Failed to load booking details","error")},[u,r,c]);const n=H(),d=_(),a=$(),b=G(),C=Q(),I=Y();if(!t)return e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Booking Detail",subName:"Apps"}),e.jsx(P,{variant:"danger",children:"Booking ID is required"})]});const y=i=>g.find(h=>h.id===i),v=async(i,h)=>{if(t)try{await i(),c(`${h} successful`,"success")}catch(B){c(B instanceof Error?B.message:`Failed to ${h.toLowerCase()}`,"error")}};return j?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Booking Detail",subName:"Apps"}),e.jsxs("div",{className:"text-center py-5",children:[e.jsx(N,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading booking details..."}),e.jsxs("p",{className:"text-muted small",children:["Reference: ",t]})]})]}):u||r?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Booking Detail",subName:"Apps"}),e.jsxs(P,{variant:"danger",children:[e.jsx("h5",{children:"Failed to load booking"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",r instanceof Error?r.message:String(r)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Booking ID:"})," ",t]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Query Status:"})," ",k.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Is Enabled:"})," ",String(k.isEnabled)]}),e.jsx(x,{variant:"secondary",onClick:()=>p("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]}):!j&&!u&&!s?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Booking Detail",subName:"Apps"}),e.jsxs(P,{variant:"warning",children:[e.jsx("h5",{children:"Booking not found"}),e.jsxs("p",{children:["No booking found with ID: ",t]}),e.jsx(x,{variant:"secondary",onClick:()=>p("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]}):!s&&!j&&!u?null:s?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Booking Detail",subName:"Apps"}),e.jsx(m,{children:e.jsxs(o,{xs:12,children:[e.jsxs("div",{className:"mb-3 d-flex justify-content-between align-items-center",children:[e.jsxs(x,{variant:"secondary",onClick:()=>p("/apps/booking"),children:[e.jsx("i",{className:"mdi mdi-arrow-left me-1"})," Back to Bookings"]}),e.jsxs(W,{children:[e.jsxs(x,{variant:"outline-primary",size:"sm",onClick:()=>v(()=>n.mutateAsync(t),"En route"),disabled:n.isPending,children:[n.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-car me-1"}),"En Route"]}),e.jsxs(x,{variant:"outline-info",size:"sm",onClick:()=>v(()=>d.mutateAsync(t),"Check in"),disabled:d.isPending,children:[d.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-check-circle me-1"}),"Check In"]}),e.jsxs(x,{variant:"outline-warning",size:"sm",onClick:()=>v(()=>a.mutateAsync(t),"Start"),disabled:a.isPending,children:[a.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-play me-1"}),"Start"]}),e.jsxs(x,{variant:"outline-success",size:"sm",onClick:()=>v(()=>b.mutateAsync(t),"Finish"),disabled:b.isPending,children:[b.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-check me-1"}),"Finish"]}),e.jsxs(x,{variant:"outline-danger",size:"sm",onClick:()=>{window.confirm("Are you sure you want to cancel this booking?")&&v(()=>C.mutateAsync(t),"Cancel")},disabled:C.isPending||I.isPending,children:[C.isPending||I.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-cancel me-1"}),"Cancel"]})]})]}),e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Booking Information"}),U(s.status)]})}),e.jsxs(l.Body,{children:[e.jsxs(m,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Booking Code"}),e.jsxs("div",{className:"form-control-plaintext d-flex align-items-center gap-2",children:[e.jsx("code",{children:s.code||s.id}),e.jsx(x,{variant:"link",size:"sm",className:"p-0 text-muted",onClick:async()=>{const i=s.code||s.id;try{await navigator.clipboard.writeText(i),c("Booking code copied to clipboard","success")}catch{c("Failed to copy booking code","error")}},title:"Copy booking code",children:e.jsx("i",{className:"mdi mdi-clipboard-text"})})]})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Booking Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.bookingTime).toLocaleString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})})]}),e.jsx("hr",{}),e.jsxs(m,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer Name"}),e.jsx("div",{className:"form-control-plaintext",children:s.customerName||e.jsx("span",{className:"text-muted",children:"Not provided"})})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer Phone"}),e.jsx("div",{className:"form-control-plaintext",children:s.customerPhone||e.jsx("span",{className:"text-muted",children:"-"})})]})})]}),s.customerId&&e.jsx(m,{children:e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:s.customerId})})]})})}),e.jsx("hr",{}),e.jsx(m,{children:e.jsx(o,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Address"}),e.jsx("div",{className:"form-control-plaintext",children:s.address||e.jsx("span",{className:"text-muted",children:"Not provided"})})]})})}),s.latitude!==void 0&&s.longitude!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Coordinates"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsxs("small",{children:["Latitude: ",s.latitude.toFixed(6),", Longitude: ",s.longitude.toFixed(6)]})})]})})}),e.jsx(m,{children:e.jsx(o,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Location Map"}),e.jsx(Z,{latitude:s.latitude,longitude:s.longitude,address:s.address,height:"400px"})]})})})]})]})]}),s.items&&s.items.length>0&&e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsx("h4",{className:"mb-0",children:"Booking Items"})}),e.jsx(l.Body,{children:e.jsxs(J,{hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(A=s.items)==null?void 0:A.map((i,h)=>{var E,T,F,L;const B=i.productName||((E=y(i.productId))==null?void 0:E.name)||i.productId,S=i.unitPrice||((T=y(i.productId))==null?void 0:T.price)||0,z=i.totalPrice||S*i.quantity;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:B}),((F=y(i.productId))==null?void 0:F.description)&&e.jsx("div",{className:"text-muted small",children:(L=y(i.productId))==null?void 0:L.description})]}),e.jsx("td",{children:S>0?e.jsxs(e.Fragment,{children:[S.toLocaleString("vi-VN")," VND"]}):e.jsx("span",{className:"text-muted",children:"N/A"})}),e.jsx("td",{children:e.jsx(K,{bg:"info",children:i.quantity})}),e.jsx("td",{children:e.jsxs("strong",{children:[z.toLocaleString("vi-VN")," VND"]})})]},h)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-end fw-bold",children:"Total Price:"}),e.jsx("td",{className:"fw-bold",children:s.totalPrice?e.jsxs(e.Fragment,{children:[s.totalPrice.toLocaleString("vi-VN")," VND"]}):e.jsxs(e.Fragment,{children:[(D=s.items)==null?void 0:D.reduce((i,h)=>i+(h.totalPrice||0),0).toLocaleString("vi-VN")," ","VND"]})})]})})]})})]}),(s==null?void 0:s.notes)&&e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsx("h4",{className:"mb-0",children:"Notes"})}),e.jsx(l.Body,{children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:s.notes})})]}),e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsx("h4",{className:"mb-0",children:"Additional Information"})}),e.jsxs(l.Body,{children:[e.jsxs(m,{children:[s.technicianId&&e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Technician ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:s.technicianId})})]})}),s.technicianName&&e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Technician Name"}),e.jsx("div",{className:"form-control-plaintext",children:s.technicianName})]})})]}),s.startTime&&e.jsxs(m,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Start Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.startTime).toLocaleString("vi-VN")})]})}),s.endTime&&e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"End Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.endTime).toLocaleString("vi-VN")})]})})]}),s.totalPrice&&e.jsx(m,{children:e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Total Price"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsxs("h5",{className:"mb-0 text-primary",children:[s.totalPrice.toLocaleString("vi-VN")," VND"]})})]})})})]})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Booking Detail",subName:"Apps"}),e.jsxs(P,{variant:"warning",children:[e.jsx("h5",{children:"Unable to load booking"}),e.jsxs("p",{children:["Booking ID: ",t]}),e.jsxs("p",{children:["Loading: ",String(j)]}),e.jsxs("p",{children:["Error: ",String(u)]}),e.jsxs("p",{children:["Status: ",status]}),e.jsx(x,{variant:"secondary",onClick:()=>p("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]})};export{we as default};
