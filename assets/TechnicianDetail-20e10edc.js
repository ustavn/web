import{a6 as I,a as C,a2 as E,r as N,j as e,P as x,d,f as t,h as l}from"./index-e82313e5.js";import{g as k,c as V}from"./useTechnicians-e02c5f4d.js";import{u as z}from"./useQuery-fea835bf.js";import{u as R}from"./useBookings-f8cac945.js";import{u as q}from"./useShifts-86996376.js";import{g as H}from"./statusUtils-4ba056ad.js";import{A as b}from"./Alert-f4c67321.js";import{S as g}from"./Spinner-4926c0ae.js";import{B as f}from"./Button-e8ec431b.js";import{B as n}from"./Badge-f24d8f9c.js";import{T as w}from"./Table-434f19fd.js";import"./useMutation-2c5d79f4.js";import"./documentClient-b8932307.js";import"./hook-ac17fc52.js";function M(a,m={},j=!0){return z({queryKey:["technician-shifts",a,m],queryFn:()=>k(a,m),enabled:!!a&&j,staleTime:3e4,retry:2,select:i=>i||[]})}const ie=()=>{const{id:a}=I(),m=C(),{showNotification:j}=E(),{data:i,isLoading:v,error:c,isError:u}=V(a||""),S=N.useMemo(()=>{const s=new Date;return s.setDate(s.getDate()-30),{from:s.toISOString(),page:1,pageSize:100}},[]),{data:y=[],isLoading:T}=M(a||"",S,!!a),{data:B=[]}=q({}),A=N.useMemo(()=>a?{page:1,pageSize:50,status:[0,1,2,3,4,5,6,7,8],technicianId:a}:null,[a]),{data:o,isLoading:D}=R(A||void 0),F=s=>{switch(s){case 1:return e.jsx(n,{bg:"info",children:"Pending"});case 2:return e.jsx(n,{bg:"success",children:"Approved"});case 3:return e.jsx(n,{bg:"danger",children:"Rejected"});default:return e.jsx(n,{bg:"secondary",children:"Unknown"})}},L=s=>{if(!s)return e.jsx("span",{className:"text-muted",children:"No rating"});const r="â­".repeat(Math.round(s));return e.jsxs("span",{children:[r," (",s.toFixed(1),")"]})};if(N.useEffect(()=>{u&&c&&j(c instanceof Error?c.message:"Failed to load technician details","error")},[u,c,j]),!a)return e.jsxs(e.Fragment,{children:[e.jsx(x,{title:"Technician Detail",subName:"Apps"}),e.jsx(b,{variant:"danger",children:"Technician ID is required"})]});if(v)return e.jsxs(e.Fragment,{children:[e.jsx(x,{title:"Technician Detail",subName:"Apps"}),e.jsxs("div",{className:"text-center py-5",children:[e.jsx(g,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading technician details..."})]})]});if(u||c)return e.jsxs(e.Fragment,{children:[e.jsx(x,{title:"Technician Detail",subName:"Apps"}),e.jsxs(b,{variant:"danger",children:[e.jsx("h5",{children:"Failed to load technician"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",c instanceof Error?c.message:String(c)]}),e.jsx(f,{variant:"secondary",onClick:()=>m("/apps/technicians"),className:"mt-2",children:"Back to Technicians"})]})]});if(!v&&!u&&!i)return e.jsxs(e.Fragment,{children:[e.jsx(x,{title:"Technician Detail",subName:"Apps"}),e.jsxs(b,{variant:"warning",children:[e.jsx("h5",{children:"Technician not found"}),e.jsxs("p",{children:["No technician found with ID: ",a]}),e.jsx(f,{variant:"secondary",onClick:()=>m("/apps/technicians"),className:"mt-2",children:"Back to Technicians"})]})]});if(!i)return null;const p=(o==null?void 0:o.items)||[];return e.jsxs(e.Fragment,{children:[e.jsx(x,{title:"Technician Detail",subName:"Apps"}),e.jsx(d,{children:e.jsxs(t,{xs:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"header-title",children:"Technician Information"}),e.jsxs(f,{variant:"secondary",onClick:()=>m("/apps/technicians"),children:[e.jsx("i",{className:"mdi mdi-arrow-left me-1"}),"Back to Technicians"]})]}),e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsx("h4",{className:"mb-0",children:"Basic Information"})}),e.jsxs(l.Body,{children:[e.jsxs(d,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Name"}),e.jsx("div",{className:"form-control-plaintext",children:i.name})]})}),e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Phone"}),e.jsx("div",{className:"form-control-plaintext",children:i.phone})]})})]}),e.jsxs(d,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Email"}),e.jsx("div",{className:"form-control-plaintext",children:i.email||e.jsx("span",{className:"text-muted",children:"-"})})]})}),e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Status"}),e.jsx("div",{className:"form-control-plaintext",children:F(i.status)})]})})]}),e.jsxs(d,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Address"}),e.jsx("div",{className:"form-control-plaintext",children:i.address||e.jsx("span",{className:"text-muted",children:"-"})})]})}),e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Rating"}),e.jsx("div",{className:"form-control-plaintext",children:L(i.rating)})]})})]}),e.jsxs(d,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Specialization"}),e.jsx("div",{className:"form-control-plaintext",children:i.specialization||e.jsx("span",{className:"text-muted",children:"-"})})]})}),i.updatedAt&&e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Updated At"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(i.updatedAt).toLocaleString("vi-VN")})]})})]}),i.profileId&&e.jsx(d,{children:e.jsxs(t,{xs:12,children:[e.jsx("hr",{}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Profile ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:i.profileId})})]})]})}),i.skills&&i.skills.length>0&&e.jsx(d,{children:e.jsx(t,{xs:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-bold text-muted",children:["Skills (",i.skills.length,")"]}),e.jsx("div",{className:"mt-1",children:i.skills.map((s,r)=>{const h=typeof s=="string"?s:(s==null?void 0:s.name)||JSON.stringify(s);return e.jsx(n,{bg:"primary",className:"me-1 mb-1",children:h},r)})})]})})}),i.zones&&i.zones.length>0&&e.jsx(d,{children:e.jsx(t,{xs:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-bold text-muted",children:["Zones (",i.zones.length,")"]}),e.jsx("div",{className:"mt-1",children:i.zones.map((s,r)=>{const h=typeof s=="string"?s:(s==null?void 0:s.name)||JSON.stringify(s);return e.jsx(n,{bg:"info",className:"me-1 mb-1",children:h},r)})})]})})})]})]}),e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsx("h4",{className:"mb-0",children:"Shifts"})}),e.jsx(l.Body,{children:T?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(g,{animation:"border",size:"sm",variant:"primary"}),e.jsx("p",{className:"mt-2 mb-0 small text-muted",children:"Loading shifts..."})]}):y.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(w,{striped:!0,bordered:!0,hover:!0,size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Shift Name"}),e.jsx("th",{children:"Effective From"}),e.jsx("th",{children:"Effective To"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:y.map(s=>{const r=B.find(P=>P.id===s.shiftId),h=(r==null?void 0:r.name)||s.shiftId;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(n,{bg:"primary",children:h})}),e.jsx("td",{children:new Date(s.effectiveFrom).toLocaleString("vi-VN")}),e.jsx("td",{children:new Date(s.effectiveTo).toLocaleString("vi-VN")}),e.jsx("td",{children:s.isActive?e.jsx(n,{bg:"success",children:"Active"}):e.jsx(n,{bg:"secondary",children:"Inactive"})})]},s.id)})})]})}):e.jsx("p",{className:"text-muted small mb-0",children:"No shifts assigned"})})]}),e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsxs("h4",{className:"mb-0",children:["Bookings",o&&e.jsxs(n,{bg:"info",className:"ms-2",children:[o.totalCount||p.length," total"]})]})}),e.jsx(l.Body,{children:D?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(g,{animation:"border",size:"sm",variant:"primary"}),e.jsx("p",{className:"mt-2 mb-0 small text-muted",children:"Loading bookings..."})]}):p.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(w,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Booking Time"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total Price"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{className:"text-primary",children:s.code||s.id.substring(0,8)})}),e.jsx("td",{children:e.jsx("strong",{children:s.customerName||"N/A"})}),e.jsx("td",{children:s.customerPhone||"-"}),e.jsx("td",{children:new Date(s.bookingTime).toLocaleString("vi-VN")}),e.jsx("td",{children:H(s.status)}),e.jsx("td",{children:new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s.totalPrice||0)}),e.jsx("td",{children:e.jsx(f,{variant:"info",size:"sm",onClick:()=>m(`/apps/booking/${s.id}`),title:"View booking details",children:e.jsx("i",{className:"mdi mdi-eye"})})})]},s.id))})]})}):e.jsx("p",{className:"text-muted small mb-0",children:"No bookings found for this technician"})})]})]})})]})};export{ie as default};
