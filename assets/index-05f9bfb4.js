import{r as m,z as F,j as e,l as R,a3 as q,a4 as O,d as B,f as k,a5 as G,P as U,h as z,L as K,_ as H,R as Q,c as D}from"./index-ce6fbccf.js";import{a as Y,u as J}from"./useBookings-c36c58e1.js";import{u as Z}from"./useProducts-f4e0e55b.js";import{F as l}from"./Form-615d69ab.js";import{A}from"./Alert-d71e2039.js";import{S as E}from"./Spinner-11146b06.js";import{B as y}from"./Button-6ed85f28.js";import{M as P}from"./Modal-5f6ebaa3.js";import{g as W}from"./statusUtils-b0722e72.js";import{a as X}from"./hook-f4f2e89f.js";import{u as ee,B as se}from"./Nav-28fbf4ae.js";import{N as te}from"./NavbarContext-0ab80289.js";import{m as re}from"./NavContext-da4df5c2.js";import{B as _}from"./Badge-47045485.js";import{B as ae}from"./ButtonGroup-e5c9328a.js";import"./useQuery-f1edf008.js";import"./useMutation-67ca3026.js";import"./ElementChildren-ef7f439b.js";import"./AbstractModalHeader-fbf86b9c.js";import"./useWindow-1bf75f89.js";import"./hasClass-b6bfff75.js";import"./useMergedRefs-17991e17.js";import"./DataKey-e12315fd.js";const $=m.forwardRef(({className:r,bsPrefix:c,as:p="div",...x},n)=>(c=F(c,"nav-item"),e.jsx(p,{ref:n,className:R(r,c),...x})));$.displayName="NavItem";const ne=$,M=m.forwardRef(({bsPrefix:r,className:c,as:p=q,active:x,eventKey:n,disabled:d=!1,...g},h)=>{r=F(r,"nav-link");const[f,t]=ee({key:re(n,g.href),active:x,disabled:d,...g});return e.jsx(p,{...g,...f,ref:h,disabled:d,className:R(c,r,d&&"disabled",t.isActive&&"active")})});M.displayName="NavLink";const oe=M,V=m.forwardRef((r,c)=>{const{as:p="div",bsPrefix:x,variant:n,fill:d=!1,justify:g=!1,navbar:h,navbarScroll:f,className:t,activeKey:s,...o}=X(r,{activeKey:"onSelect"}),u=F(x,"nav");let v,j,N=!1;const S=m.useContext(te),C=m.useContext(O);return S?(v=S.bsPrefix,N=h??!0):C&&({cardHeaderBsPrefix:j}=C),e.jsx(se,{as:p,ref:c,activeKey:s,className:R(t,{[u]:!N,[`${v}-nav`]:N,[`${v}-nav-scroll`]:N&&f,[`${j}-${n}`]:!!j,[`${u}-${n}`]:!!n,[`${u}-fill`]:d,[`${u}-justified`]:g}),...o})});V.displayName="Nav";const b=Object.assign(V,{Item:ne,Link:oe});let I=!1,w=!1;const L=[],ie=({onPlaceSelected:r,value:c="",placeholder:p="Search for an address",required:x=!1})=>{const n=m.useRef(null),d=m.useRef(null);return m.useEffect(()=>{n.current&&c&&(n.current.value=c)},[c]),m.useEffect(()=>{const g="AIzaSyDJvwpR_epAanY-ayIYf8AZmjUu2IgFpdc",h=()=>{if(!n.current){setTimeout(h,100);return}if(!window.google||!window.google.maps||!window.google.maps.places){setTimeout(h,200);return}try{d.current&&google.maps.event.clearInstanceListeners(d.current);const t={types:["geocode","establishment"],componentRestrictions:{country:"vn"},fields:["formatted_address","geometry","name"]};d.current=new google.maps.places.Autocomplete(n.current,t),setTimeout(()=>{document.querySelector(".pac-container")},1e3),d.current.addListener("place_changed",()=>{var u;const s=(u=d.current)==null?void 0:u.getPlace();if(!s||!s.geometry||!s.geometry.location)return;const o={address:s.formatted_address||"",latitude:s.geometry.location.lat(),longitude:s.geometry.location.lng()};n.current&&(n.current.value=o.address),r(o)})}catch{}};return(()=>{if(I||window.google&&window.google.maps&&window.google.maps.places){I=!0,h();return}if(w){L.push(h);return}const t=document.querySelector('script[src*="maps.googleapis.com"]');if(t){w=!0,t.addEventListener("load",()=>{I=!0,w=!1,h(),L.forEach(u=>u()),L.length=0});return}const s=`https://maps.googleapis.com/maps/api/js?key=${g}&libraries=places`;w=!0;const o=document.createElement("script");o.src=s,o.async=!0,o.defer=!0,o.onload=()=>{I=!0,w=!1,h(),L.forEach(u=>u()),L.length=0},o.onerror=()=>{w=!1},document.head.appendChild(o)})(),()=>{if(d.current&&window.google&&window.google.maps)try{google.maps.event.clearInstanceListeners(d.current)}catch{}}},[r]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
				.pac-container {
					z-index: 9999 !important;
					position: fixed !important;
				}
			`}),e.jsx("div",{style:{position:"relative"},children:e.jsx(l.Control,{ref:n,type:"text",defaultValue:c,placeholder:p,required:x,autoComplete:"off",id:"google-places-autocomplete-input"})})]})},le=({initialData:r,products:c,productsLoading:p=!1,onSubmit:x,onCancel:n,isSubmitting:d=!1,error:g,submitButtonText:h="Submit",cancelButtonText:f="Cancel",showCancelButton:t=!0})=>{const[s,o]=m.useState({bookingTime:"",customerId:"",customerName:"",customerPhone:"",latitude:0,longitude:0,address:"",items:[],...r}),[u,v]=m.useState(""),[j,N]=m.useState(1);m.useEffect(()=>{r&&(o(a=>({...a,...r})),r.items&&r.items.length>0&&(v(r.items[0].productId),N(r.items[0].quantity)))},[r]);const S=a=>{o(T=>({...T,address:a.address,latitude:a.latitude,longitude:a.longitude}))},C=a=>{if(a.preventDefault(),!u)return;const T={...s,bookingTime:s.bookingTime?new Date(s.bookingTime).toISOString():new Date().toISOString(),items:[{productId:u,quantity:j}]};x(T)},i=c.find(a=>a.id===u);return e.jsxs(l,{onSubmit:C,children:[g&&e.jsx(A,{variant:"danger",dismissible:!0,children:g}),e.jsxs(B,{children:[e.jsx(k,{md:6,children:e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Customer Name *"}),e.jsx(l.Control,{type:"text",placeholder:"Enter customer name",value:s.customerName||"",onChange:a=>o({...s,customerName:a.target.value}),required:!0})]})}),e.jsx(k,{md:6,children:e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Customer Phone *"}),e.jsx(l.Control,{type:"tel",placeholder:"0352978519",value:s.customerPhone||"",onChange:a=>o({...s,customerPhone:a.target.value}),required:!0})]})})]}),e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Customer ID *"}),e.jsx(l.Control,{type:"text",placeholder:"Enter customer ID (UUID)",value:s.customerId||"",onChange:a=>o({...s,customerId:a.target.value}),required:!0})]}),e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Address *"}),e.jsx(ie,{value:s.address||"",onPlaceSelected:S,placeholder:"Search for an address using Google Maps",required:!0})]}),s.latitude!==0&&s.longitude!==0&&e.jsx(A,{variant:"info",className:"mb-3",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Coordinates:"})," ",s.latitude.toFixed(6),", ",s.longitude.toFixed(6)]})}),e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Booking Time *"}),e.jsx(l.Control,{type:"datetime-local",value:s.bookingTime?new Date(s.bookingTime).toISOString().slice(0,16):"",onChange:a=>o({...s,bookingTime:a.target.value}),required:!0})]}),e.jsxs(B,{children:[e.jsx(k,{md:8,children:e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Select Product *"}),p?e.jsxs("div",{className:"text-center py-2",children:[e.jsx(E,{animation:"border",size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading products..."})]}):e.jsxs(l.Select,{value:u,onChange:a=>v(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Select a product --"}),c.map(a=>e.jsxs("option",{value:a.id,children:[a.name," - ",a.price.toLocaleString("vi-VN")," VND"]},a.id))]})]})}),e.jsx(k,{md:4,children:e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Quantity *"}),e.jsx(l.Control,{type:"number",min:"1",value:j,onChange:a=>N(parseInt(a.target.value)||1),required:!0})]})})]}),i&&e.jsxs(A,{variant:"info",className:"mb-3",children:[e.jsx("strong",{children:"Selected:"})," ",i.name," x ",j,e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:i.description}),e.jsx("hr",{className:"my-2"}),e.jsxs("strong",{children:["Total: ",(i.price*j).toLocaleString("vi-VN")," VND"]})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-end mt-3",children:[t&&n&&e.jsx(y,{type:"button",variant:"secondary",onClick:n,disabled:d,children:f}),e.jsx(y,{type:"submit",variant:"primary",disabled:d||!u||!s.address,children:d?e.jsxs(e.Fragment,{children:[e.jsx(E,{animation:"border",size:"sm",className:"me-2"}),"Submitting..."]}):h})]})]})},ce=({show:r,onHide:c,onSuccess:p})=>{var f;const x=Y(),{showNotification:n}=G(),{data:d=[],isLoading:g}=Z(),h=async t=>{try{await x.mutateAsync(t),n("Booking created successfully","success"),c(),p==null||p()}catch(s){n(s instanceof Error?s.message:"Failed to create booking","error")}};return e.jsxs(P,{show:r,onHide:c,size:"lg",children:[e.jsx(P.Header,{closeButton:!0,children:e.jsx(P.Title,{children:"Create New Booking"})}),e.jsx(P.Body,{children:e.jsx(le,{products:d,productsLoading:g,onSubmit:h,onCancel:c,isSubmitting:x.isPending,error:x.isError?`Failed to create booking: ${((f=x.error)==null?void 0:f.message)||"Unknown error"}`:null,submitButtonText:"Create Booking",showCancelButton:!0})})]})};const de=()=>{var C;const[r,c]=m.useState(1),[p]=m.useState(10),[x,n]=m.useState("new"),[d,g]=m.useState(""),[h,f]=m.useState(!1),{data:t,isLoading:s,error:o,refetch:u}=J({page:r,pageSize:p,status:[0,1,2,3,4,5,6,7,8]}),{showNotification:v}=G();m.useEffect(()=>{o&&v(o instanceof Error?o.message:"Failed to load bookings","error")},[o,v]);const j={new:(t==null?void 0:t.totalCount)||0,verification:0,approval:0,processed:0},N=()=>{u(),v("Bookings list refreshed","success")},S=(t==null?void 0:t.items)||[];return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Booking Management",subName:"Apps"}),e.jsx(B,{children:e.jsx(k,{xs:12,children:e.jsx(z,{children:e.jsxs(z.Body,{children:[e.jsxs(b,{variant:"tabs",className:"nav-bordered mb-4",children:[e.jsx(b.Item,{children:e.jsxs(b.Link,{active:x==="new",onClick:()=>n("new"),className:"d-flex align-items-center gap-2",children:["New",j.new>0&&e.jsx(_,{bg:"danger",className:"ms-1",children:j.new})]})}),e.jsx(b.Item,{children:e.jsxs(b.Link,{active:x==="verification",onClick:()=>n("verification"),className:"d-flex align-items-center gap-2",children:["Verification Due",j.verification>0]})}),e.jsx(b.Item,{children:e.jsxs(b.Link,{active:x==="approval",onClick:()=>n("approval"),className:"d-flex align-items-center gap-2",children:["Approval Due",j.approval>0]})}),e.jsx(b.Item,{children:e.jsxs(b.Link,{active:x==="processed",onClick:()=>n("processed"),className:"d-flex align-items-center gap-2",children:["Processed",j.processed>0]})})]}),e.jsx(B,{className:"mb-4",children:e.jsx(k,{md:12,children:e.jsxs("div",{className:"position-relative",children:[e.jsx("i",{className:"mdi mdi-magnify position-absolute top-50 start-0 translate-middle-y ms-3 text-muted",style:{fontSize:"18px"}}),e.jsx(l.Control,{type:"text",placeholder:"Search bookings by customer name...",value:d,onChange:i=>g(i.target.value),className:"ps-5"})]})})}),e.jsx(B,{className:"mb-4",children:e.jsx(k,{xs:12,children:e.jsxs(ae,{className:"mb-2 gap-1",children:[e.jsxs(y,{variant:"primary",size:"sm",onClick:()=>f(!0),children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Create Booking"]}),e.jsxs(y,{variant:"secondary",size:"sm",onClick:async()=>{try{await u(),v("Bookings list refreshed","success")}catch(i){v(i instanceof Error?i.message:"Failed to refresh bookings","error")}},children:[e.jsx("i",{className:"mdi mdi-refresh me-1"}),"Reload"]})]})})}),o&&e.jsxs(A,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",o instanceof Error?o.message:"Failed to load bookings"]}),s?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(E,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading bookings..."})]}):t!=null&&t.items&&t.items.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-centered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer Name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Booking Time"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{className:"booking-actions-column",children:"Actions"})]})}),e.jsx("tbody",{children:S.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:i.customerName||"N/A"})}),e.jsx("td",{children:i.customerPhone||"-"}),e.jsx("td",{className:"text-muted",children:e.jsx("small",{children:i.address||"-"})}),e.jsx("td",{children:new Date(i.bookingTime).toLocaleString("vi-VN")}),e.jsx("td",{children:i.items&&i.items.length>0?e.jsxs(_,{bg:"info",children:[i.items.length," items"]}):i.totalPrice?e.jsxs(_,{bg:"secondary",children:[i.totalPrice.toLocaleString("vi-VN")," VND"]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:W(i.status)}),e.jsx("td",{children:i.bookingTime?new Date(i.bookingTime).toLocaleDateString("vi-VN"):"-"}),e.jsx("td",{className:"booking-actions-column",children:e.jsx(K,{to:`/apps/booking/${i.id}`,children:e.jsxs(y,{variant:"outline-primary",size:"sm",onClick:a=>a.stopPropagation(),children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"View"]})})})]},i.id))})]})}),e.jsx(B,{className:"mt-4",children:e.jsx(k,{xs:12,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",((C=t.items)==null?void 0:C.length)||0," of ",t.totalCount," bookings"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(y,{variant:"secondary",size:"sm",disabled:r===1,onClick:()=>c(r-1),children:"Previous"}),e.jsxs(y,{variant:"secondary",size:"sm",disabled:!0,children:["Page ",r," of ",t.totalPages]}),e.jsx(y,{variant:"secondary",size:"sm",disabled:r>=t.totalPages,onClick:()=>c(r+1),children:"Next"})]})]})})})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No bookings found"}),e.jsx(y,{variant:"primary",onClick:()=>f(!0),children:"Create First Booking"})]})]})})})}),e.jsx(ce,{show:h,onHide:()=>f(!1),onSuccess:N})]})},me=m.lazy(()=>H(()=>import("./BookingDetail-c68d9544.js"),["assets/BookingDetail-c68d9544.js","assets/index-ce6fbccf.js","assets/index-6054c063.css","assets/statusUtils-b0722e72.js","assets/Badge-47045485.js","assets/useBookings-c36c58e1.js","assets/useQuery-f1edf008.js","assets/useMutation-67ca3026.js","assets/useProducts-f4e0e55b.js","assets/Alert-d71e2039.js","assets/hook-f4f2e89f.js","assets/Spinner-11146b06.js","assets/Button-6ed85f28.js","assets/ButtonGroup-e5c9328a.js","assets/Table-e7029ccb.js"])),Fe=()=>e.jsxs(Q,{children:[e.jsx(D,{index:!0,element:e.jsx(de,{})}),e.jsx(D,{path:":id",element:e.jsx(m.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(E,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading booking details..."})]}),children:e.jsx(me,{})})})]});export{Fe as default};
