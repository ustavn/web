import{r as N,j as e,a6 as Q,a as Y,a5 as O,P as v,d as x,f as l,h as o}from"./index-71e367a9.js";import{g as W}from"./statusUtils-9e6a4845.js";import{b as J,c as K,d as Z,e as X,f as ee,g as se,h as ie,i as ne}from"./useBookings-f958846a.js";import{u as te}from"./useProducts-6b41d0a8.js";import{A as P}from"./Alert-9a7f33d6.js";import{S as p}from"./Spinner-ffd7a3b9.js";import{B as c}from"./Button-098e34f5.js";import{B as ae}from"./ButtonGroup-b25d3b65.js";import{T as re}from"./Table-733a3f87.js";import{B as le}from"./Badge-26296be0.js";import{F as A}from"./Form-d0c7ec6e.js";import"./useQuery-f3ae52c2.js";import"./useMutation-24e350b2.js";import"./hook-0c89c40c.js";import"./ElementChildren-ee3ffcd1.js";const oe=({latitude:n,longitude:g,address:d,height:k="400px"})=>{const s=N.useRef(null),h=N.useRef(null),a=N.useRef(null);return N.useEffect(()=>{const j="AIzaSyDJvwpR_epAanY-ayIYf8AZmjUu2IgFpdc";if(!s.current)return;const f=()=>{if(!window.google||!window.google.maps){setTimeout(f,100);return}try{const t={lat:n,lng:g};if(h.current)h.current.setCenter(t),a.current&&a.current.setPosition(t);else{const m=new window.google.maps.Map(s.current,{center:t,zoom:15,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0});h.current=m;const r=new window.google.maps.Marker({position:t,map:m,title:d||"Booking Location"});if(a.current=r,d){const b=new window.google.maps.InfoWindow({content:`<div><strong>Booking Location</strong><br/>${d}</div>`});r.addListener("click",()=>{b.open(m,r)}),b.open(m,r)}}}catch(t){console.error("Error initializing map:",t)}};if(window.google&&window.google.maps)f();else{const t=document.querySelector('script[src*="maps.googleapis.com"]');if(t)t.addEventListener("load",()=>{f()});else{const m=`https://maps.googleapis.com/maps/api/js?key=${j}&libraries=places`,r=document.createElement("script");r.src=m,r.async=!0,r.defer=!0,r.onload=()=>{f()},document.head.appendChild(r)}}return()=>{var t;a.current&&((t=window.google)!=null&&t.maps)&&a.current.setMap(null)}},[n,g,d]),e.jsx("div",{ref:s,style:{width:"100%",height:k,borderRadius:"8px",overflow:"hidden",border:"1px solid #dee2e6"}})},ye=()=>{var z,V;const{id:n}=Q(),g=Y(),{showNotification:d}=O(),k=J(n||""),{data:s,isLoading:h,error:a,isError:j}=k,{data:f=[]}=te();N.useEffect(()=>{j&&a&&d(a instanceof Error?a.message:"Failed to load booking details","error")},[j,a,d]);const t=K(),m=Z(),r=X(),b=ee(),S=se(),D=ie(),y=ne(),[L,E]=N.useState(!1),[T,I]=N.useState("");if(!n)return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Booking Detail",subName:"Apps"}),e.jsx(P,{variant:"danger",children:"Booking ID is required"})]});const B=i=>f.find(u=>u.id===i),w=async(i,u)=>{if(n)try{await i(),d(`${u} successful`,"success")}catch(C){d(C instanceof Error?C.message:`Failed to ${u.toLowerCase()}`,"error")}},G=()=>{I((s==null?void 0:s.notes)||""),E(!0)},H=async()=>{if(n)try{await y.mutateAsync({id:n,notes:T}),d("Notes updated successfully","success"),E(!1)}catch(i){d(i instanceof Error?i.message:"Failed to update notes","error")}},_=()=>{I((s==null?void 0:s.notes)||""),E(!1)};return h?e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Booking Detail",subName:"Apps"}),e.jsxs("div",{className:"text-center py-5",children:[e.jsx(p,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading booking details..."}),e.jsxs("p",{className:"text-muted small",children:["Reference: ",n]})]})]}):j||a?e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Booking Detail",subName:"Apps"}),e.jsxs(P,{variant:"danger",children:[e.jsx("h5",{children:"Failed to load booking"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",a instanceof Error?a.message:String(a)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Booking ID:"})," ",n]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Query Status:"})," ",k.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Is Enabled:"})," ",String(k.isEnabled)]}),e.jsx(c,{variant:"secondary",onClick:()=>g("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]}):!h&&!j&&!s?e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Booking Detail",subName:"Apps"}),e.jsxs(P,{variant:"warning",children:[e.jsx("h5",{children:"Booking not found"}),e.jsxs("p",{children:["No booking found with ID: ",n]}),e.jsx(c,{variant:"secondary",onClick:()=>g("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]}):!s&&!h&&!j?null:s?e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Booking Detail",subName:"Apps"}),e.jsx(x,{children:e.jsxs(l,{xs:12,children:[e.jsxs("div",{className:"mb-3 d-flex justify-content-between align-items-center",children:[e.jsxs(c,{variant:"secondary",onClick:()=>g("/apps/booking"),children:[e.jsx("i",{className:"mdi mdi-arrow-left me-1"})," Back to Bookings"]}),e.jsxs(ae,{children:[e.jsxs(c,{variant:"outline-primary",size:"sm",onClick:()=>w(()=>t.mutateAsync(n),"En route"),disabled:t.isPending,children:[t.isPending?e.jsx(p,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-car me-1"}),"En Route"]}),e.jsxs(c,{variant:"outline-info",size:"sm",onClick:()=>w(()=>m.mutateAsync(n),"Check in"),disabled:m.isPending,children:[m.isPending?e.jsx(p,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-check-circle me-1"}),"Check In"]}),e.jsxs(c,{variant:"outline-warning",size:"sm",onClick:()=>w(()=>r.mutateAsync(n),"Start"),disabled:r.isPending,children:[r.isPending?e.jsx(p,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-play me-1"}),"Start"]}),e.jsxs(c,{variant:"outline-success",size:"sm",onClick:()=>w(()=>b.mutateAsync(n),"Finish"),disabled:b.isPending,children:[b.isPending?e.jsx(p,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-check me-1"}),"Finish"]}),e.jsxs(c,{variant:"outline-danger",size:"sm",onClick:()=>{window.confirm("Are you sure you want to cancel this booking?")&&w(()=>S.mutateAsync(n),"Cancel")},disabled:S.isPending||D.isPending,children:[S.isPending||D.isPending?e.jsx(p,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-cancel me-1"}),"Cancel"]})]})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(o.Header,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Booking Information"}),W(s.status)]})}),e.jsxs(o.Body,{children:[e.jsxs(x,{children:[e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Booking Code"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:s.code||s.id})})]})}),e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Booking Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.bookingTime).toLocaleString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})})]}),e.jsx("hr",{}),e.jsxs(x,{children:[e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer Name"}),e.jsx("div",{className:"form-control-plaintext",children:s.customerName||e.jsx("span",{className:"text-muted",children:"Not provided"})})]})}),e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer Phone"}),e.jsx("div",{className:"form-control-plaintext",children:s.customerPhone||e.jsx("span",{className:"text-muted",children:"-"})})]})})]}),s.customerId&&e.jsx(x,{children:e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:s.customerId})})]})})}),e.jsx("hr",{}),e.jsx(x,{children:e.jsx(l,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Address"}),e.jsx("div",{className:"form-control-plaintext",children:s.address||e.jsx("span",{className:"text-muted",children:"Not provided"})})]})})}),s.latitude!==void 0&&s.longitude!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(x,{children:e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Coordinates"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsxs("small",{children:["Latitude: ",s.latitude.toFixed(6),", Longitude: ",s.longitude.toFixed(6)]})})]})})}),e.jsx(x,{children:e.jsx(l,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Location Map"}),e.jsx(oe,{latitude:s.latitude,longitude:s.longitude,address:s.address,height:"400px"})]})})})]})]})]}),s.items&&s.items.length>0&&e.jsxs(o,{className:"mb-3",children:[e.jsx(o.Header,{children:e.jsx("h4",{className:"mb-0",children:"Booking Items"})}),e.jsx(o.Body,{children:e.jsxs(re,{hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(z=s.items)==null?void 0:z.map((i,u)=>{var M,R,U,q;const C=i.productName||((M=B(i.productId))==null?void 0:M.name)||i.productId,F=i.unitPrice||((R=B(i.productId))==null?void 0:R.price)||0,$=i.totalPrice||F*i.quantity;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:C}),((U=B(i.productId))==null?void 0:U.description)&&e.jsx("div",{className:"text-muted small",children:(q=B(i.productId))==null?void 0:q.description})]}),e.jsx("td",{children:F>0?e.jsxs(e.Fragment,{children:[F.toLocaleString("vi-VN")," VND"]}):e.jsx("span",{className:"text-muted",children:"N/A"})}),e.jsx("td",{children:e.jsx(le,{bg:"info",children:i.quantity})}),e.jsx("td",{children:e.jsxs("strong",{children:[$.toLocaleString("vi-VN")," VND"]})})]},u)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-end fw-bold",children:"Total Price:"}),e.jsx("td",{className:"fw-bold",children:s.totalPrice?e.jsxs(e.Fragment,{children:[s.totalPrice.toLocaleString("vi-VN")," VND"]}):e.jsxs(e.Fragment,{children:[(V=s.items)==null?void 0:V.reduce((i,u)=>i+(u.totalPrice||0),0).toLocaleString("vi-VN")," ","VND"]})})]})})]})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(o.Header,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Notes"}),!L&&e.jsxs(c,{variant:"outline-primary",size:"sm",onClick:G,children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Edit Notes"]})]})}),e.jsx(o.Body,{children:L?e.jsxs(e.Fragment,{children:[e.jsxs(A.Group,{className:"mb-3",children:[e.jsx(A.Label,{children:"Notes"}),e.jsx(A.Control,{as:"textarea",rows:5,value:T,onChange:i=>I(i.target.value),placeholder:"Enter notes about this booking..."})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(c,{variant:"primary",size:"sm",onClick:H,disabled:y.isPending,children:y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(p,{animation:"border",size:"sm",className:"me-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-content-save me-1"}),"Save"]})}),e.jsx(c,{variant:"secondary",size:"sm",onClick:_,disabled:y.isPending,children:"Cancel"})]})]}):e.jsx("div",{children:s!=null&&s.notes?e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:s.notes}):e.jsx("p",{className:"text-muted mb-0",children:'No notes available. Click "Edit Notes" to add notes.'})})})]}),e.jsxs(o,{children:[e.jsx(o.Header,{children:e.jsx("h4",{className:"mb-0",children:"Additional Information"})}),e.jsxs(o.Body,{children:[e.jsxs(x,{children:[s.technicianId&&e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Technician ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:s.technicianId})})]})}),s.technicianName&&e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Technician Name"}),e.jsx("div",{className:"form-control-plaintext",children:s.technicianName})]})})]}),s.startTime&&e.jsxs(x,{children:[e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Start Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.startTime).toLocaleString("vi-VN")})]})}),s.endTime&&e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"End Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.endTime).toLocaleString("vi-VN")})]})})]}),s.totalPrice&&e.jsx(x,{children:e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Total Price"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsxs("h5",{className:"mb-0 text-primary",children:[s.totalPrice.toLocaleString("vi-VN")," VND"]})})]})})})]})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"Booking Detail",subName:"Apps"}),e.jsxs(P,{variant:"warning",children:[e.jsx("h5",{children:"Unable to load booking"}),e.jsxs("p",{children:["Booking ID: ",n]}),e.jsxs("p",{children:["Loading: ",String(h)]}),e.jsxs("p",{children:["Error: ",String(j)]}),e.jsxs("p",{children:["Status: ",status]}),e.jsx(c,{variant:"secondary",onClick:()=>g("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]})};export{ye as default};
