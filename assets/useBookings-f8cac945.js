import{u as y}from"./useQuery-fea835bf.js";import{a3 as s,an as d,a4 as l,ac as u,a2 as k}from"./index-e82313e5.js";import{u as r}from"./useMutation-2c5d79f4.js";import{u as f}from"./documentClient-b8932307.js";async function w(e){const n={Page:e.page,PageSize:e.pageSize,Status:e.status};e.keyword&&(n.Keyword=e.keyword),e.createdBy&&(n.CreatedBy=e.createdBy),e.technicianId&&(n.TechnicianId=e.technicianId),e.assignedToId&&(n.AssignedToId=e.assignedToId),e.bookingFrom&&(n.BookingFrom=e.bookingFrom),e.bookingTo&&(n.BookingTo=e.bookingTo);const o=await s.get("/bookings",{params:n}),t=d(o);return{items:t.items,totalCount:t.total,page:t.page,pageSize:t.pageSize,totalPages:t.totalPages}}async function h(e){const n=await s.post("/bookings",e);return l(n)}async function b(e){const n=await s.get(`/bookings/${e}`);return l(n)}async function q(e){return(await s.post(`/bookings/${e}/enroute`)).data}async function p(e){return(await s.post(`/bookings/${e}/checkin`)).data}async function B(e){return(await s.post(`/bookings/${e}/start`)).data}async function m(e){return(await s.post(`/bookings/${e}/finish`)).data}async function K(e){return(await s.post(`/bookings/${e}/cancel-by-user`)).data}async function v(e){return(await s.post(`/bookings/${e}/cancel-by-tech`)).data}async function C(e,n){if(!e||e.trim()==="")throw new Error("Booking ID is required");if(!n||n.length===0)throw new Error("At least one image URL is required");const o=await s.post(`/bookings/${e}/upload-image`,n);return typeof o.data=="boolean"?o.data:l(o)}function E(e){const n={page:(e==null?void 0:e.page)??1,pageSize:(e==null?void 0:e.pageSize)??10,status:(e==null?void 0:e.status)??[0,1,2,3,4,5,6,7,8],...e};return y({queryKey:["bookings",n],queryFn:()=>w(n),staleTime:3e4,retry:2,enabled:!!n.status&&n.status.length>0})}function T(e){return y({queryKey:["booking",e],queryFn:()=>b(e),enabled:!!e&&e.length>0,staleTime:3e4,retry:2})}function I(){const e=u();return r({mutationFn:n=>h(n),onSuccess:()=>{e.invalidateQueries({queryKey:["bookings"]})}})}function z(){const e=u();return r({mutationFn:n=>q(n),onSuccess:(n,o)=>{e.invalidateQueries({queryKey:["bookings"]}),e.invalidateQueries({queryKey:["booking",o]})}})}function $(){const e=u();return r({mutationFn:n=>p(n),onSuccess:(n,o)=>{e.invalidateQueries({queryKey:["bookings"]}),e.invalidateQueries({queryKey:["booking",o]})}})}function _(){const e=u();return r({mutationFn:n=>B(n),onSuccess:(n,o)=>{e.invalidateQueries({queryKey:["bookings"]}),e.invalidateQueries({queryKey:["booking",o]})}})}function D(){const e=u();return r({mutationFn:n=>m(n),onSuccess:(n,o)=>{e.invalidateQueries({queryKey:["bookings"]}),e.invalidateQueries({queryKey:["booking",o]})}})}function R(){const e=u();return r({mutationFn:n=>K(n),onSuccess:(n,o)=>{e.invalidateQueries({queryKey:["bookings"]}),e.invalidateQueries({queryKey:["booking",o]})}})}function U(){const e=u();return r({mutationFn:n=>v(n),onSuccess:(n,o)=>{e.invalidateQueries({queryKey:["bookings"]}),e.invalidateQueries({queryKey:["booking",o]})}})}function N(){const e=u(),{showNotification:n}=k();return r({mutationFn:async({bookingId:o,images:t})=>{if(!o||o.trim()==="")throw new Error("Booking ID is required");if(!t||t.length===0)throw new Error("At least one image is required");try{const i=t.map(a=>f(a)),c=(await Promise.all(i)).map(a=>a.url).filter(a=>a!=null);if(c.length===0)throw new Error("Failed to upload images. No URLs were returned from the server.");return await C(o,c),{imageUrls:c}}catch(i){throw i instanceof Error?i.message.includes("Network")||i.message.includes("fetch")?new Error("Network error. Please check your connection and try again."):i.message.includes("401")||i.message.includes("Unauthorized")?new Error("Unauthorized. Please log in again."):i.message.includes("413")||i.message.includes("too large")?new Error("Image file is too large. Please choose smaller files."):i:new Error("Failed to upload images. Please try again.")}},onSuccess:(o,{bookingId:t})=>{e.invalidateQueries({queryKey:["booking",t]}),e.invalidateQueries({queryKey:["bookings"]})},onError:o=>{var i,g,c,a;let t="Failed to upload images";(g=(i=o==null?void 0:o.response)==null?void 0:i.data)!=null&&g.error?t=o.response.data.error:(a=(c=o==null?void 0:o.response)==null?void 0:c.data)!=null&&a.message?t=o.response.data.message:o!=null&&o.message&&(t=o.message),n({message:t,type:"error"})}})}export{I as a,T as b,z as c,$ as d,_ as e,D as f,R as g,U as h,N as i,E as u};
