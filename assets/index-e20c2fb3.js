import{w as S,aZ as A,j as e,aW as N,r as C,P as I,d as j,f as l,h as g,bn as L,v as o}from"./index-d6599812.js";import{u as w,a as F}from"./useMutation-f736d124.js";import{u as E}from"./useCategories-e56e2010.js";import{B as u}from"./Button-0d211eca.js";import{A as q}from"./Alert-424c39a4.js";import{S as D}from"./Spinner-c003c098.js";import{M as i}from"./Modal-a1fa8454.js";const H={}.VITE_API_SERVER||"http://localhost:80",m=S.create({baseURL:`${H}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});m.interceptors.request.use(async r=>{const t=localStorage.getItem("_USTA_OAUTH");if(t)try{const s=JSON.parse(t);r.headers.Authorization=`Bearer ${s.accessToken}`,console.log("[Product API] Request:",{method:r.method,url:r.url,params:r.params,data:r.data,hasAuth:!!r.headers.Authorization})}catch(s){console.error("[Product API] Failed to parse OAuth session:",s)}else console.warn("[Product API] No OAuth session found");return r},r=>(console.error("[Product API] Request error:",r),Promise.reject(r)));m.interceptors.response.use(r=>(console.log("[Product API] Response:",{status:r.status,url:r.config.url,data:r.data}),r),r=>{var t,s,n;return console.error("[Product API] Response error:",{status:(t=r.response)==null?void 0:t.status,url:(s=r.config)==null?void 0:s.url,data:(n=r.response)==null?void 0:n.data,message:r.message}),Promise.reject(r)});async function R(r={}){console.log("[Product API] Fetching products:",r);const t=await m.get("/products/");if(t.data.success)return t.data.data;throw new Error(t.data.error||"Failed to fetch products")}async function T(r){console.log("[Product API] Creating product:",r);const t=await m.post("/products/",r);if(console.log("[Product API] Product created successfully:",t.data),t.data.success)return t.data.data;throw new Error(t.data.error||"Failed to create product")}function B(r={}){return w({queryKey:["products",r],queryFn:()=>R(r),staleTime:3e4,retry:2,select:t=>t||[]})}function M(){const r=A();return F({mutationFn:t=>T(t),onSuccess:t=>{console.log("[useCreateProduct] Product created successfully:",t),r.invalidateQueries({queryKey:["products"]})},onError:t=>{console.error("[useCreateProduct] Failed to create product:",t)}})}const z=[{Header:"ID",accessor:"id",defaultCanSort:!1,Cell:({value:r})=>e.jsxs("small",{className:"text-muted",children:[r.substring(0,8),"..."]})},{Header:"Name",accessor:"name",defaultCanSort:!0,Cell:({value:r})=>e.jsx("strong",{children:r})},{Header:"Price",accessor:"price",defaultCanSort:!0,Cell:({value:r})=>`$${r.toFixed(2)}`},{Header:"Duration",accessor:"duration",defaultCanSort:!0,Cell:({value:r})=>`${r} days`},{Header:"Category ID",accessor:"categoryId",defaultCanSort:!1,Cell:({value:r})=>e.jsxs("small",{className:"text-muted",children:[r.substring(0,8),"..."]})},{Header:"Level Code",accessor:"categoryLevelCode",defaultCanSort:!1,Cell:({value:r})=>e.jsx(N,{bg:"info",children:r})},{Header:"Description",accessor:"description",defaultCanSort:!1,Cell:({value:r})=>e.jsx("span",{className:"text-muted",children:r})},{Header:"Created At",accessor:"createdAt",defaultCanSort:!0,Cell:({value:r})=>new Date(r).toLocaleDateString()}],G=[{text:"10",value:10},{text:"25",value:25},{text:"50",value:50}],_=()=>{const[r,t]=C.useState(!1),[s,n]=C.useState({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""}),{data:p,isLoading:y,error:h}=B(),{data:c,isLoading:P}=E(),x=M(),f=a=>{const d=c==null?void 0:c.find(b=>b.id===a);d&&n({...s,categoryId:d.id,categoryLevelCode:d.levelCode})},v=async a=>{a.preventDefault();try{await x.mutateAsync(s),t(!1),n({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""})}catch(d){console.error("Failed to create product:",d)}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Products",subName:"Apps"}),e.jsx(j,{children:e.jsx(l,{xs:12,children:e.jsx(g,{children:e.jsxs(g.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h4",{className:"header-title",children:"Products List"}),e.jsxs(u,{variant:"primary",onClick:()=>t(!0),children:[e.jsx("i",{className:"mdi mdi-plus-circle me-1"}),"Create Product"]})]}),h&&e.jsxs(q,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",h instanceof Error?h.message:"Failed to load products"]}),y?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(D,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading products..."})]}):p&&p.length>0?e.jsx(L,{columns:z,data:p,pageSize:10,sizePerPageList:G,isSortable:!0,pagination:!0,isSearchable:!0}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No products found"}),e.jsx(u,{variant:"primary",onClick:()=>t(!0),children:"Create First Product"})]})]})})})}),e.jsxs(i,{show:r,onHide:()=>t(!1),size:"lg",children:[e.jsx(i.Header,{closeButton:!0,children:e.jsx(i.Title,{children:"Create New Product"})}),e.jsxs(o,{onSubmit:v,children:[e.jsxs(i.Body,{children:[e.jsxs(j,{children:[e.jsx(l,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Product Name *"}),e.jsx(o.Control,{type:"text",placeholder:"Enter product name",value:s.name,onChange:a=>n({...s,name:a.target.value}),required:!0})]})}),e.jsx(l,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Category *"}),e.jsxs(o.Select,{value:s.categoryId,onChange:a=>f(a.target.value),required:!0,disabled:P,children:[e.jsx("option",{value:"",children:"Select a category"}),c==null?void 0:c.map(a=>e.jsxs("option",{value:a.id,children:[a.levelCode," - ",a.name]},a.id))]}),s.categoryLevelCode&&e.jsxs(o.Text,{className:"text-muted",children:["Level Code: ",e.jsx("strong",{children:s.categoryLevelCode})]})]})})]}),e.jsxs(j,{children:[e.jsx(l,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Price *"}),e.jsx(o.Control,{type:"number",step:"0.01",placeholder:"0.00",value:s.price,onChange:a=>n({...s,price:parseFloat(a.target.value)}),required:!0})]})}),e.jsx(l,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Duration (mins) *"}),e.jsx(o.Control,{type:"number",placeholder:"30",value:s.duration,onChange:a=>n({...s,duration:parseInt(a.target.value)}),required:!0})]})})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Description *"}),e.jsx(o.Control,{as:"textarea",rows:3,placeholder:"Enter product description",value:s.description,onChange:a=>n({...s,description:a.target.value}),required:!0})]})]}),e.jsxs(i.Footer,{children:[e.jsx(u,{variant:"secondary",onClick:()=>t(!1),children:"Cancel"}),e.jsx(u,{variant:"primary",type:"submit",disabled:x.isPending,children:x.isPending?"Creating...":"Create Product"})]})]})]})]})},J=()=>e.jsx(_,{});export{J as default};
