import{w as T,aZ as F,a as L,r as o,j as e,P as M,d as v,f as p,h as C,v as a,aW as f,_ as R,R as q,c as b}from"./index-049ade0a.js";import{u as S}from"./useQuery-4147274f.js";import{u as z}from"./useMutation-56f107bc.js";import{B as j}from"./Button-08ebfda8.js";import{A as B}from"./Alert-7f154918.js";import{S as w}from"./Spinner-bee679bc.js";import{T as E}from"./Table-eae80124.js";import{M as c}from"./Modal-2f10061d.js";const D="https://api.dev.usta.vn",l=T.create({baseURL:`${D}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(async t=>{const r=localStorage.getItem("_USTA_OAUTH");if(r)try{const i=JSON.parse(r);t.headers.Authorization=`Bearer ${i.accessToken}`}catch(i){console.error("[Zone API] Failed to parse OAuth session:",i)}return t},t=>Promise.reject(t));l.interceptors.response.use(t=>t,t=>{var r;return console.error("[Zone API] Response error:",((r=t.response)==null?void 0:r.data)||t.message),Promise.reject(t)});async function I(t={}){const r=await l.get("/zones/",{params:t});if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to fetch zones")}async function O(t){const r=await l.post("/zones/",t);if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to create zone")}async function k(t){return(await l.get(`/zones/${t}`)).data}function Q(t={}){return S({queryKey:["zones",t],queryFn:()=>I(t),staleTime:3e4,retry:2,select:r=>r||[]})}function te(t){return S({queryKey:["zone",t],queryFn:()=>k(t),enabled:!!t,staleTime:3e4})}function $(){const t=F();return z({mutationFn:r=>O(r),onSuccess:()=>{t.invalidateQueries({queryKey:["zones"]})}})}const G=()=>{const t=L(),[r,i]=o.useState(""),[N,d]=o.useState(!1),[n,u]=o.useState({name:"",code:"",description:""}),{data:m=[],isLoading:Z,error:y}=Q(),x=$(),g=m.filter(s=>s.name.toLowerCase().includes(r.toLowerCase())||s.code.toLowerCase().includes(r.toLowerCase())),A=o.useMemo(()=>{const s=new Map;return m.forEach(h=>{s.set(h.id,h.name)}),s},[m]),_=s=>s?A.get(s)||s:"-",P=async s=>{s.preventDefault();try{await x.mutateAsync(n),d(!1),u({name:"",code:"",description:""})}catch(h){console.error("Failed to create zone:",h)}};return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:"Zone Management",subName:"Apps"}),e.jsx(v,{children:e.jsx(p,{xs:12,children:e.jsx(C,{children:e.jsxs(C.Body,{children:[e.jsxs(v,{className:"mb-3",children:[e.jsx(p,{md:6,children:e.jsx(a.Control,{type:"text",placeholder:"Search zones...",value:r,onChange:s=>i(s.target.value)})}),e.jsx(p,{md:6,className:"text-end",children:e.jsxs(j,{variant:"primary",onClick:()=>d(!0),children:[e.jsx("i",{className:"uil uil-plus me-1"})," Create Zone"]})})]}),y&&e.jsxs(B,{variant:"danger",dismissible:!0,children:["Failed to load zones: ",y.message]}),Z?e.jsx("div",{className:"text-center py-5",children:e.jsx(w,{animation:"border",variant:"primary"})}):e.jsxs(E,{hover:!0,responsive:!0,children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Parent Zone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-muted",children:"No zones found"})}):g.map(s=>e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>t(`/apps/zones/${s.id}/children`),children:[e.jsx("td",{children:e.jsx("strong",{children:s.code})}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.description||"-"}),e.jsx("td",{children:_(s.parentId)}),e.jsx("td",{children:s.isActive!==void 0?s.isActive?e.jsx(f,{bg:"success",children:"Active"}):e.jsx(f,{bg:"secondary",children:"Inactive"}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:new Date(s.createdAt).toLocaleDateString("vi-VN")})]},s.id))})]})]})})})}),e.jsxs(c,{show:N,onHide:()=>d(!1),children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx(c.Title,{children:"Create New Zone"})}),e.jsxs(a,{onSubmit:P,children:[e.jsxs(c.Body,{children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Zone Code *"}),e.jsx(a.Control,{type:"text",placeholder:"Q5",value:n.code,onChange:s=>u({...n,code:s.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Zone Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Quan 5",value:n.name,onChange:s=>u({...n,name:s.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Description"}),e.jsx(a.Control,{as:"textarea",rows:3,placeholder:"trung tam tp",value:n.description,onChange:s=>u({...n,description:s.target.value})})]})]}),e.jsxs(c.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(j,{variant:"primary",type:"submit",disabled:x.isPending,children:x.isPending?"Creating...":"Create Zone"})]})]})]})]})},H=o.lazy(()=>R(()=>import("./ChildZonesApp-db141f68.js"),["assets/ChildZonesApp-db141f68.js","assets/index-049ade0a.js","assets/index-fab365ac.css","assets/Button-08ebfda8.js","assets/Alert-7f154918.js","assets/Spinner-bee679bc.js","assets/Table-eae80124.js","assets/Modal-2f10061d.js","assets/useQuery-4147274f.js","assets/useMutation-56f107bc.js"])),K=()=>e.jsxs(q,{children:[e.jsx(b,{index:!0,element:e.jsx(G,{})}),e.jsx(b,{path:":parentId/children",element:e.jsx(o.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(w,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading..."})]}),children:e.jsx(H,{})})})]}),re=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{Q as a,$ as b,re as i,te as u};
