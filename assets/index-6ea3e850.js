import{r as m,z as F,j as e,l as R,a3 as q,a4 as O,d as P,f as k,a5 as G,P as U,h as z,L as K,_ as H,R as Q,c as D}from"./index-3f07c11f.js";import{a as Y,u as J}from"./useBookings-af98a679.js";import{u as Z}from"./useProducts-29de8629.js";import{F as l}from"./Form-db521678.js";import{A}from"./Alert-2d9d9927.js";import{S as E}from"./Spinner-2c23172c.js";import{B as C}from"./Button-783be344.js";import{M as I}from"./Modal-b572be97.js";import{B as f}from"./Badge-abfe1df2.js";import{a as W}from"./hook-5d5166a1.js";import{u as X,B as ee}from"./Nav-d24aed90.js";import{N as se}from"./NavbarContext-26638ae1.js";import{m as te}from"./NavContext-d9337656.js";import{B as re}from"./ButtonGroup-565edf9e.js";const M=m.forwardRef(({className:t,bsPrefix:c,as:g="div",...x},n)=>(c=F(c,"nav-item"),e.jsx(g,{ref:n,className:R(t,c),...x})));M.displayName="NavItem";const ae=M,$=m.forwardRef(({bsPrefix:t,className:c,as:g=q,active:x,eventKey:n,disabled:d=!1,...p},h)=>{t=F(t,"nav-link");const[v,r]=X({key:te(n,p.href),active:x,disabled:d,...p});return e.jsx(g,{...p,...v,ref:h,disabled:d,className:R(c,t,d&&"disabled",r.isActive&&"active")})});$.displayName="NavLink";const ne=$,V=m.forwardRef((t,c)=>{const{as:g="div",bsPrefix:x,variant:n,fill:d=!1,justify:p=!1,navbar:h,navbarScroll:v,className:r,activeKey:s,...o}=W(t,{activeKey:"onSelect"}),u=F(x,"nav");let b,j,N=!1;const S=m.useContext(se),w=m.useContext(O);return S?(b=S.bsPrefix,N=h??!0):w&&({cardHeaderBsPrefix:j}=w),e.jsx(ee,{as:g,ref:c,activeKey:s,className:R(r,{[u]:!N,[`${b}-nav`]:N,[`${b}-nav-scroll`]:N&&v,[`${j}-${n}`]:!!j,[`${u}-${n}`]:!!n,[`${u}-fill`]:d,[`${u}-justified`]:p}),...o})});V.displayName="Nav";const y=Object.assign(V,{Item:ae,Link:ne});let _=!1,B=!1;const L=[],oe=({onPlaceSelected:t,value:c="",placeholder:g="Search for an address",required:x=!1})=>{const n=m.useRef(null),d=m.useRef(null);return m.useEffect(()=>{n.current&&c&&(n.current.value=c)},[c]),m.useEffect(()=>{const p="AIzaSyDJvwpR_epAanY-ayIYf8AZmjUu2IgFpdc",h=()=>{if(!n.current){setTimeout(h,100);return}if(!window.google||!window.google.maps||!window.google.maps.places){setTimeout(h,200);return}try{d.current&&google.maps.event.clearInstanceListeners(d.current);const r={types:["geocode","establishment"],componentRestrictions:{country:"vn"},fields:["formatted_address","geometry","name"]};d.current=new google.maps.places.Autocomplete(n.current,r),setTimeout(()=>{document.querySelector(".pac-container")},1e3),d.current.addListener("place_changed",()=>{var u;const s=(u=d.current)==null?void 0:u.getPlace();if(!s||!s.geometry||!s.geometry.location)return;const o={address:s.formatted_address||"",latitude:s.geometry.location.lat(),longitude:s.geometry.location.lng()};n.current&&(n.current.value=o.address),t(o)})}catch{}};return(()=>{if(_||window.google&&window.google.maps&&window.google.maps.places){_=!0,h();return}if(B){L.push(h);return}const r=document.querySelector('script[src*="maps.googleapis.com"]');if(r){B=!0,r.addEventListener("load",()=>{_=!0,B=!1,h(),L.forEach(u=>u()),L.length=0});return}const s=`https://maps.googleapis.com/maps/api/js?key=${p}&libraries=places`;B=!0;const o=document.createElement("script");o.src=s,o.async=!0,o.defer=!0,o.onload=()=>{_=!0,B=!1,h(),L.forEach(u=>u()),L.length=0},o.onerror=()=>{B=!1},document.head.appendChild(o)})(),()=>{if(d.current&&window.google&&window.google.maps)try{google.maps.event.clearInstanceListeners(d.current)}catch{}}},[t]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
				.pac-container {
					z-index: 9999 !important;
					position: fixed !important;
				}
			`}),e.jsx("div",{style:{position:"relative"},children:e.jsx(l.Control,{ref:n,type:"text",defaultValue:c,placeholder:g,required:x,autoComplete:"off",id:"google-places-autocomplete-input"})})]})},ie=({initialData:t,products:c,productsLoading:g=!1,onSubmit:x,onCancel:n,isSubmitting:d=!1,error:p,submitButtonText:h="Submit",cancelButtonText:v="Cancel",showCancelButton:r=!0})=>{const[s,o]=m.useState({bookingTime:"",customerId:"",customerName:"",customerPhone:"",latitude:0,longitude:0,address:"",items:[],...t}),[u,b]=m.useState(""),[j,N]=m.useState(1);m.useEffect(()=>{t&&(o(a=>({...a,...t})),t.items&&t.items.length>0&&(b(t.items[0].productId),N(t.items[0].quantity)))},[t]);const S=a=>{o(T=>({...T,address:a.address,latitude:a.latitude,longitude:a.longitude}))},w=a=>{if(a.preventDefault(),!u)return;const T={...s,bookingTime:s.bookingTime?new Date(s.bookingTime).toISOString():new Date().toISOString(),items:[{productId:u,quantity:j}]};x(T)},i=c.find(a=>a.id===u);return e.jsxs(l,{onSubmit:w,children:[p&&e.jsx(A,{variant:"danger",dismissible:!0,children:p}),e.jsxs(P,{children:[e.jsx(k,{md:6,children:e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Customer Name *"}),e.jsx(l.Control,{type:"text",placeholder:"Enter customer name",value:s.customerName||"",onChange:a=>o({...s,customerName:a.target.value}),required:!0})]})}),e.jsx(k,{md:6,children:e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Customer Phone *"}),e.jsx(l.Control,{type:"tel",placeholder:"0352978519",value:s.customerPhone||"",onChange:a=>o({...s,customerPhone:a.target.value}),required:!0})]})})]}),e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Customer ID *"}),e.jsx(l.Control,{type:"text",placeholder:"Enter customer ID (UUID)",value:s.customerId||"",onChange:a=>o({...s,customerId:a.target.value}),required:!0})]}),e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Address *"}),e.jsx(oe,{value:s.address||"",onPlaceSelected:S,placeholder:"Search for an address using Google Maps",required:!0})]}),s.latitude!==0&&s.longitude!==0&&e.jsx(A,{variant:"info",className:"mb-3",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Coordinates:"})," ",s.latitude.toFixed(6),", ",s.longitude.toFixed(6)]})}),e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Booking Time *"}),e.jsx(l.Control,{type:"datetime-local",value:s.bookingTime?new Date(s.bookingTime).toISOString().slice(0,16):"",onChange:a=>o({...s,bookingTime:a.target.value}),required:!0})]}),e.jsxs(P,{children:[e.jsx(k,{md:8,children:e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Select Product *"}),g?e.jsxs("div",{className:"text-center py-2",children:[e.jsx(E,{animation:"border",size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading products..."})]}):e.jsxs(l.Select,{value:u,onChange:a=>b(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Select a product --"}),c.map(a=>e.jsxs("option",{value:a.id,children:[a.name," - ",a.price.toLocaleString("vi-VN")," VND"]},a.id))]})]})}),e.jsx(k,{md:4,children:e.jsxs(l.Group,{className:"mb-3",children:[e.jsx(l.Label,{children:"Quantity *"}),e.jsx(l.Control,{type:"number",min:"1",value:j,onChange:a=>N(parseInt(a.target.value)||1),required:!0})]})})]}),i&&e.jsxs(A,{variant:"info",className:"mb-3",children:[e.jsx("strong",{children:"Selected:"})," ",i.name," x ",j,e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:i.description}),e.jsx("hr",{className:"my-2"}),e.jsxs("strong",{children:["Total: ",(i.price*j).toLocaleString("vi-VN")," VND"]})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-end mt-3",children:[r&&n&&e.jsx(C,{type:"button",variant:"secondary",onClick:n,disabled:d,children:v}),e.jsx(C,{type:"submit",variant:"primary",disabled:d||!u||!s.address,children:d?e.jsxs(e.Fragment,{children:[e.jsx(E,{animation:"border",size:"sm",className:"me-2"}),"Submitting..."]}):h})]})]})},ce=({show:t,onHide:c,onSuccess:g})=>{var v;const x=Y(),{showNotification:n}=G(),{data:d=[],isLoading:p}=Z(),h=async r=>{try{await x.mutateAsync(r),n("Booking created successfully","success"),c(),g==null||g()}catch(s){n(s instanceof Error?s.message:"Failed to create booking","error")}};return e.jsxs(I,{show:t,onHide:c,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Create New Booking"})}),e.jsx(I.Body,{children:e.jsx(ie,{products:d,productsLoading:p,onSubmit:h,onCancel:c,isSubmitting:x.isPending,error:x.isError?`Failed to create booking: ${((v=x.error)==null?void 0:v.message)||"Unknown error"}`:null,submitButtonText:"Create Booking",showCancelButton:!0})})]})},le=t=>{if(typeof t=="number")switch(t){case 0:return e.jsx(f,{bg:"secondary",children:"Pending"});case 1:return e.jsx(f,{bg:"info",children:"Created"});case 2:return e.jsx(f,{bg:"primary",children:"Assigned"});case 3:return e.jsx(f,{bg:"warning",children:"In Progress"});case 4:return e.jsx(f,{bg:"success",children:"Done"});case 5:return e.jsx(f,{bg:"danger",children:"Failed"});case 6:return e.jsx(f,{bg:"secondary",children:"Cancelled"});case 7:return e.jsx(f,{bg:"warning",children:"En Route"});case 8:return e.jsx(f,{bg:"info",children:"Checked In"});default:return e.jsxs(f,{bg:"secondary",children:["Status ",t]})}return e.jsx(f,{bg:"info",children:t||"Unknown"})};const de=()=>{var w;const[t,c]=m.useState(1),[g]=m.useState(10),[x,n]=m.useState("new"),[d,p]=m.useState(""),[h,v]=m.useState(!1),{data:r,isLoading:s,error:o,refetch:u}=J({page:t,pageSize:g,status:[0,1,2,3,4,5,6,7,8]}),{showNotification:b}=G();m.useEffect(()=>{o&&b(o instanceof Error?o.message:"Failed to load bookings","error")},[o,b]);const j={new:(r==null?void 0:r.totalCount)||0,verification:0,approval:0,processed:0},N=()=>{u(),b("Bookings list refreshed","success")},S=(r==null?void 0:r.items)||[];return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Booking Management",subName:"Apps"}),e.jsx(P,{children:e.jsx(k,{xs:12,children:e.jsx(z,{children:e.jsxs(z.Body,{children:[e.jsxs(y,{variant:"tabs",className:"nav-bordered mb-4",children:[e.jsx(y.Item,{children:e.jsxs(y.Link,{active:x==="new",onClick:()=>n("new"),className:"d-flex align-items-center gap-2",children:["New",j.new>0&&e.jsx(f,{bg:"danger",className:"ms-1",children:j.new})]})}),e.jsx(y.Item,{children:e.jsxs(y.Link,{active:x==="verification",onClick:()=>n("verification"),className:"d-flex align-items-center gap-2",children:["Verification Due",j.verification>0]})}),e.jsx(y.Item,{children:e.jsxs(y.Link,{active:x==="approval",onClick:()=>n("approval"),className:"d-flex align-items-center gap-2",children:["Approval Due",j.approval>0]})}),e.jsx(y.Item,{children:e.jsxs(y.Link,{active:x==="processed",onClick:()=>n("processed"),className:"d-flex align-items-center gap-2",children:["Processed",j.processed>0]})})]}),e.jsx(P,{className:"mb-4",children:e.jsx(k,{md:12,children:e.jsxs("div",{className:"position-relative",children:[e.jsx("i",{className:"mdi mdi-magnify position-absolute top-50 start-0 translate-middle-y ms-3 text-muted",style:{fontSize:"18px"}}),e.jsx(l.Control,{type:"text",placeholder:"Search bookings by customer name...",value:d,onChange:i=>p(i.target.value),className:"ps-5"})]})})}),e.jsx(P,{className:"mb-4",children:e.jsx(k,{xs:12,children:e.jsxs(re,{className:"mb-2 gap-1",children:[e.jsxs(C,{variant:"primary",size:"sm",onClick:()=>v(!0),children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Create Booking"]}),e.jsxs(C,{variant:"secondary",size:"sm",onClick:async()=>{try{await u(),b("Bookings list refreshed","success")}catch(i){b(i instanceof Error?i.message:"Failed to refresh bookings","error")}},children:[e.jsx("i",{className:"mdi mdi-refresh me-1"}),"Reload"]})]})})}),o&&e.jsxs(A,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",o instanceof Error?o.message:"Failed to load bookings"]}),s?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(E,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading bookings..."})]}):r!=null&&r.items&&r.items.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-centered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer Name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Booking Time"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{className:"booking-actions-column",children:"Actions"})]})}),e.jsx("tbody",{children:S.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:i.customerName||"N/A"})}),e.jsx("td",{children:i.customerPhone||"-"}),e.jsx("td",{className:"text-muted",children:e.jsx("small",{children:i.address||"-"})}),e.jsx("td",{children:new Date(i.bookingTime).toLocaleString("vi-VN")}),e.jsx("td",{children:i.items&&i.items.length>0?e.jsxs(f,{bg:"info",children:[i.items.length," items"]}):i.totalPrice?e.jsxs(f,{bg:"secondary",children:[i.totalPrice.toLocaleString("vi-VN")," VND"]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:le(i.status)}),e.jsx("td",{children:i.bookingTime?new Date(i.bookingTime).toLocaleDateString("vi-VN"):"-"}),e.jsx("td",{className:"booking-actions-column",children:e.jsx(K,{to:`${i.id}`,relative:"route",children:e.jsxs(C,{variant:"outline-primary",size:"sm",onClick:a=>a.stopPropagation(),children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"View"]})})})]},i.id))})]})}),e.jsx(P,{className:"mt-4",children:e.jsx(k,{xs:12,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",((w=r.items)==null?void 0:w.length)||0," of ",r.totalCount," bookings"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(C,{variant:"secondary",size:"sm",disabled:t===1,onClick:()=>c(t-1),children:"Previous"}),e.jsxs(C,{variant:"secondary",size:"sm",disabled:!0,children:["Page ",t," of ",r.totalPages]}),e.jsx(C,{variant:"secondary",size:"sm",disabled:t>=r.totalPages,onClick:()=>c(t+1),children:"Next"})]})]})})})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No bookings found"}),e.jsx(C,{variant:"primary",onClick:()=>v(!0),children:"Create First Booking"})]})]})})})}),e.jsx(ce,{show:h,onHide:()=>v(!1),onSuccess:N})]})},me=m.lazy(()=>H(()=>import("./BookingDetail-1d733cd4.js"),["assets/BookingDetail-1d733cd4.js","assets/index-3f07c11f.js","assets/index-6054c063.css","assets/useBookings-af98a679.js","assets/useQuery-dc21cdee.js","assets/useMutation-0895c265.js","assets/useProducts-29de8629.js","assets/Alert-2d9d9927.js","assets/hook-5d5166a1.js","assets/Spinner-2c23172c.js","assets/Button-783be344.js","assets/ButtonGroup-565edf9e.js","assets/Table-f902b5eb.js","assets/Badge-abfe1df2.js","assets/Form-db521678.js","assets/ElementChildren-96ca08f1.js","assets/Modal-b572be97.js","assets/AbstractModalHeader-b559c3ca.js","assets/useWindow-da4d5222.js","assets/hasClass-c453d1e7.js","assets/useMergedRefs-0799c755.js","assets/DataKey-e12315fd.js","assets/Nav-d24aed90.js","assets/NavContext-d9337656.js","assets/NavbarContext-26638ae1.js"])),ue=()=>e.jsxs(Q,{children:[e.jsx(D,{index:!0,element:e.jsx(de,{})}),e.jsx(D,{path:":id",element:e.jsx(m.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(E,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading booking details..."})]}),children:e.jsx(me,{})})})]}),Be=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{le as g,Be as i};
