import{a6 as De,a as ke,r as b,a5 as Be,aa as Fe,j as e,P as $,d as o,f as n,h}from"./index-f24fabb9.js";import{S as le}from"./react-select.esm-2d998b52.js";import{F as ce,M as J,C as X}from"./react-select-creatable.esm-c3bb10c6.js";import{d as oe,u as Ue,c as Ee,e as Me,f as Oe,a as $e,b as Re,g as ze}from"./useProducts-3becb29e.js";import{u as Ge}from"./useCategories-1f930590.js";import{A as _}from"./Alert-f3b59418.js";import{S as H}from"./Spinner-c6839ba2.js";import{B as j}from"./Button-1bd665f7.js";import{B as u}from"./Badge-41b97b48.js";import{M as y}from"./Modal-4d26d06f.js";import{F as c}from"./Form-93705b7c.js";import"./hook-c08bc9e4.js";import"./index.esm-f39bb473.js";import"./InputGroupContext-7aefe718.js";import"./useQuery-ef7bc5d7.js";import"./useMutation-bf1cb67e.js";import"./AbstractModalHeader-5af54cd0.js";import"./useWindow-e030e9b1.js";import"./hasClass-2aefdf69.js";import"./useMergedRefs-cc67f583.js";import"./DataKey-e12315fd.js";import"./ElementChildren-33f86963.js";const S=[{value:15,label:"15 minutes"},{value:30,label:"30 minutes"},{value:45,label:"45 minutes"},{value:60,label:"1 hour"},{value:90,label:"1.5 hours"},{value:120,label:"2 hours"},{value:180,label:"3 hours"},{value:240,label:"4 hours"},{value:300,label:"5 hours"}],ms=()=>{const{id:x}=De(),P=ke(),[Y,R]=b.useState(!1),[me,Q]=b.useState(!1),[D,Z]=b.useState([]),[m,w]=b.useState({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""}),[f,z]=b.useState([]),[I,k]=b.useState([]),[ee,se]=b.useState([]),[ue,he]=b.useState(new Set),[xe,je]=b.useState(new Set),[pe,ge]=b.useState(new Map),{data:i,isLoading:ae,error:te,refetch:fe}=oe(x||""),{data:K}=Ue(),{data:V}=Ge(),{showNotification:L}=Be(),B=Ee(),G=Me(),F=Oe(),re=$e(),U=Re(),E=ze(),be=Fe();if(!x)return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Product Detail",subName:"Apps"}),e.jsx(_,{variant:"danger",children:"Product ID is required"})]});const Ne=s=>{switch(s){case 1:return e.jsx(u,{bg:"primary",children:"Service"});case 2:return e.jsx(u,{bg:"info",children:"Variant"});case 3:return e.jsx(u,{bg:"success",children:"Addon"});default:return e.jsx(u,{bg:"secondary",children:"Unknown"})}},q=s=>s.toLocaleString("vi-VN",{minimumFractionDigits:0,maximumFractionDigits:0});b.useEffect(()=>{if(i&&Y){w({categoryId:i.categoryId,categoryLevelCode:i.categoryLevelCode,name:i.name,price:i.price,duration:i.duration,description:i.description||""});const s=(i.variants||[]).map(r=>({id:r.id,name:r.name,price:r.price,duration:r.duration,description:r.description||""}));z(s),he(new Set(s.map(r=>r.id).filter(Boolean)));const t=(i.addOns||[]).map(r=>({id:r.id,name:r.name,price:r.price,duration:r.duration,description:r.description||"",variantIndices:[],existingVariantIds:r.variantIds||[]}));k(t),je(new Set(t.map(r=>r.id).filter(Boolean)));const a=new Map;t.forEach(r=>{r.id&&a.set(r.id,new Set(r.existingVariantIds||[]))}),ge(a),se([])}},[i,Y]);const ie=b.useMemo(()=>K?K.filter(s=>{var t;return s.type===2&&s.id!==x&&!((t=i==null?void 0:i.variants)!=null&&t.some(a=>a.id===s.id))}):[],[K,x,i]),W=b.useMemo(()=>V?V.map(s=>({value:s.id,label:`${s.levelCode} - ${s.name}`})):[],[V]),ve=b.useMemo(()=>m.categoryId&&W.find(s=>s.value===m.categoryId)||null,[m.categoryId,W]),T=b.useMemo(()=>{const s=f.filter(l=>!l.id).map((l,C)=>({value:`new_${C}`,label:l.name||`New Variant ${C+1}`,isNew:!0,index:f.findIndex(v=>!v.id&&v===l)})),t=f.filter(l=>l.id).map(l=>({value:`existing_${l.id}`,label:l.name,isNew:!1,id:l.id})),a=ie.map(l=>({value:`existing_${l.id}`,label:l.name,isNew:!1,id:l.id})),r=[];return s.length>0&&r.push({label:"New Variants (from this form)",options:s}),t.length>0&&r.push({label:"Current Product Variants",options:t}),a.length>0&&r.push({label:"Other Product Variants (from database)",options:a}),r.length>0?r:[]},[f,ie]),ye=s=>{if(s){const t=V==null?void 0:V.find(a=>a.id===s.value);t&&w({...m,categoryId:t.id,categoryLevelCode:t.levelCode})}else w({...m,categoryId:"",categoryLevelCode:""})},Ie=()=>{z([...f,{name:"",price:0,duration:0,description:""}])},we=s=>{z(f.filter((t,a)=>a!==s))},M=(s,t,a)=>{const r=[...f];r[s]={...r[s],[t]:a},z(r)},Ce=()=>{k([...I,{name:"",price:0,duration:0,description:"",variantIndices:[],existingVariantIds:[]}])},Ae=s=>{k(I.filter((t,a)=>a!==s))},O=(s,t,a)=>{k(r=>{const l=[...r];return l[s]={...l[s],[t]:a},l})},Pe=(s,t,a)=>{k(r=>{const l=[...r];return l[s]={...l[s],variantIndices:t,existingVariantIds:a},l})},Ve=async s=>{if(s.preventDefault(),!(!x||!i))try{const t=new Set(f.filter(d=>d.id).map(d=>d.id)),a=new Set(I.filter(d=>d.id).map(d=>d.id)),r=Array.from(ue).filter(d=>!t.has(d)),l=Array.from(xe).filter(d=>!a.has(d));for(const d of r){i.type===1&&await E.mutateAsync({productId:x,productReferenceId:d});for(const p of I.filter(N=>N.id))await E.mutateAsync({productId:d,productReferenceId:p.id}).catch(()=>{})}for(const d of l){i.type===1&&await E.mutateAsync({productId:x,productReferenceId:d});for(const p of f.filter(N=>N.id))await E.mutateAsync({productId:p.id,productReferenceId:d}).catch(()=>{})}await F.mutateAsync({id:x,...m,type:i.type});const C=new Map;for(const d of f.filter(p=>p.id))await F.mutateAsync({id:d.id,categoryId:m.categoryId,categoryLevelCode:m.categoryLevelCode,name:d.name,price:d.price,duration:d.duration,description:d.description,type:2});const v=f.filter(d=>!d.id);for(let d=0;d<v.length;d++){const p=v[d],N={...m,...p,type:2},g=await re.mutateAsync(N),A=f.findIndex(de=>!de.id&&de===p);C.set(A,g.id),i.type===1&&await U.mutateAsync({productId:x,productReferenceId:g.id})}for(const d of I.filter(p=>p.id)){await F.mutateAsync({id:d.id,categoryId:m.categoryId,categoryLevelCode:m.categoryLevelCode,name:d.name,price:d.price,duration:d.duration,description:d.description,type:3});const p=pe.get(d.id)||new Set,N=new Set;for(const g of d.variantIndices||[]){const A=C.get(g);A&&N.add(A)}for(const g of d.existingVariantIds||[])N.add(g);for(const g of p)N.has(g)||await E.mutateAsync({productId:g,productReferenceId:d.id}).catch(()=>{});for(const g of N)p.has(g)||await U.mutateAsync({productId:g,productReferenceId:d.id})}for(const d of I.filter(p=>!p.id)){const p={...m,name:d.name,price:d.price,duration:d.duration,description:d.description,type:3},N=await re.mutateAsync(p);i.type===1&&await U.mutateAsync({productId:x,productReferenceId:N.id});for(const g of d.variantIndices||[]){const A=C.get(g);A&&await U.mutateAsync({productId:A,productReferenceId:N.id})}for(const g of d.existingVariantIds||[])await U.mutateAsync({productId:g,productReferenceId:N.id})}ee.length>0&&await B.mutateAsync({productId:x,images:ee}),await be.invalidateQueries({queryKey:["product",x]}),await fe(),L({message:"Product updated successfully!",type:"success"}),R(!1)}catch(t){L({message:"Failed to update product: "+t.message,type:"error"})}},Le=({variant:s})=>{const{data:t,isLoading:a}=oe(s.id);return e.jsx(h,{className:"border-info h-100",children:e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:s.name}),e.jsx(u,{bg:"info",className:"me-1",children:"Variant"})]}),e.jsxs(j,{variant:"outline-primary",size:"sm",onClick:()=>P(`/apps/products/${s.id}`),children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"View"]})]}),e.jsxs(o,{className:"mt-2",children:[e.jsxs(n,{xs:6,children:[e.jsx("small",{className:"text-muted",children:"Price:"}),e.jsxs("div",{className:"fw-bold text-primary",children:["₫",q(s.price)]})]}),e.jsxs(n,{xs:6,children:[e.jsx("small",{className:"text-muted",children:"Duration:"}),e.jsxs("div",{className:"fw-bold",children:[s.duration," min"]})]})]}),s.description&&e.jsx("div",{className:"mt-2",children:e.jsx("small",{className:"text-muted",children:s.description})}),a?e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx(H,{animation:"border",size:"sm"}),e.jsx("small",{className:"d-block text-muted mt-1",children:"Loading addons..."})]}):t!=null&&t.addOns&&t.addOns.length>0?e.jsxs("div",{className:"mt-3",children:[e.jsx("hr",{}),e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(u,{bg:"success",className:"me-2",children:t.addOns.length}),e.jsx("strong",{className:"text-muted",children:"Addons:"})]}),e.jsx(o,{className:"g-2",children:t.addOns.map(r=>e.jsx(n,{xs:12,children:e.jsx(h,{className:"border-success border-start border-3",children:e.jsx(h.Body,{className:"py-2",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-bold",children:r.name}),e.jsxs("small",{className:"text-muted",children:["₫",q(r.price)," • ",r.duration," min"]})]}),e.jsx(j,{variant:"outline-success",size:"sm",onClick:()=>P(`/apps/products/${r.id}`),children:e.jsx("i",{className:"mdi mdi-eye"})})]})})})},r.id))})]}):t?e.jsxs("div",{className:"mt-3",children:[e.jsx("hr",{}),e.jsx("small",{className:"text-muted",children:"No addons available"})]}):null]})})},Se=async()=>{if(!(!x||D.length===0))try{await B.mutateAsync({productId:x,images:D}),Z([]),L({message:"Images uploaded successfully!",type:"success"})}catch(s){L({message:"Failed to upload images: "+s.message,type:"error"})}},ne=async s=>{if(x&&confirm("Are you sure you want to delete this image?"))try{await G.mutateAsync({productId:x,imageUrl:s}),L({message:"Image deleted successfully!",type:"success"})}catch(t){L({message:"Failed to delete image: "+t.message,type:"error"})}};return ae?e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Product Detail",subName:"Apps"}),e.jsxs("div",{className:"text-center py-5",children:[e.jsx(H,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading product details..."})]})]}):te?e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Product Detail",subName:"Apps"}),e.jsxs(_,{variant:"danger",children:[e.jsx("h5",{children:"Failed to load product"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",te.message]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Product ID:"})," ",x]}),e.jsx(j,{variant:"secondary",onClick:()=>P("/apps/products"),className:"mt-2",children:"Back to Products"})]})]}):!ae&&!i?e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Product Detail",subName:"Apps"}),e.jsxs(_,{variant:"warning",children:[e.jsx("h5",{children:"Product not found"}),e.jsxs("p",{children:["No product found with ID: ",x]}),e.jsx(j,{variant:"secondary",onClick:()=>P("/apps/products"),className:"mt-2",children:"Back to Products"})]})]}):i?e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Product Detail",subName:"Apps"}),e.jsx(o,{children:e.jsx(n,{xs:12,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"header-title",children:"Product Information"}),e.jsxs("div",{children:[e.jsxs(j,{variant:"primary",className:"me-2",onClick:()=>R(!0),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Edit Product"]}),e.jsxs(j,{variant:"secondary",onClick:()=>P("/apps/products"),children:[e.jsx("i",{className:"mdi mdi-arrow-left me-1"}),"Back to Products"]})]})]})})}),e.jsxs(o,{children:[e.jsxs(n,{md:8,children:[e.jsx(h,{children:e.jsxs(h.Body,{children:[e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Product ID:"})}),e.jsx(n,{md:8,children:e.jsx("small",{className:"text-muted",children:i.id})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Name:"})}),e.jsx(n,{md:8,children:e.jsx("h5",{className:"mb-0",children:i.name})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Type:"})}),e.jsx(n,{md:8,children:Ne(i.type)})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Price:"})}),e.jsx(n,{md:8,children:e.jsxs("h5",{className:"mb-0 text-primary",children:["₫",q(i.price)]})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Duration:"})}),e.jsx(n,{md:8,children:e.jsxs("span",{children:[i.duration," minutes"]})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Category ID:"})}),e.jsx(n,{md:8,children:e.jsx(u,{bg:"info",children:i.categoryId})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Category Level Code:"})}),e.jsx(n,{md:8,children:e.jsx(u,{bg:"secondary",children:i.categoryLevelCode})})]}),i.description&&e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Description:"})}),e.jsx(n,{md:8,children:e.jsx("p",{className:"mb-0",children:i.description})})]}),i.detailUrl&&e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Detail URL:"})}),e.jsx(n,{md:8,children:e.jsx("a",{href:i.detailUrl,target:"_blank",rel:"noopener noreferrer",children:i.detailUrl})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Status:"})}),e.jsx(n,{md:8,children:i.isActive?e.jsx(u,{bg:"success",children:"Active"}):e.jsx(u,{bg:"danger",children:"Inactive"})})]}),i.parentId&&e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsx("strong",{children:"Parent Product ID:"})}),e.jsx(n,{md:8,children:e.jsx("small",{className:"text-muted",children:i.parentId})})]})]})}),i.variants&&i.variants.length>0&&e.jsx(h,{className:"mt-3",children:e.jsxs(h.Body,{children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(u,{bg:"info",className:"me-2",children:i.variants.length}),"Variants"]}),e.jsx(o,{className:"g-3",children:i.variants.map(s=>e.jsx(n,{xs:12,md:6,children:e.jsx(Le,{variant:s})},s.id))})]})}),i.addOns&&i.addOns.length>0&&e.jsx(h,{className:"mt-3",children:e.jsxs(h.Body,{children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(u,{bg:"success",className:"me-2",children:i.addOns.length}),"Addons"]}),e.jsx(o,{className:"g-3",children:i.addOns.map(s=>e.jsx(n,{xs:12,md:6,children:e.jsx(h,{className:"border-success h-100",children:e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:s.name}),e.jsx(u,{bg:"success",className:"me-1",children:"Addon"})]}),e.jsxs(j,{variant:"outline-primary",size:"sm",onClick:()=>P(`/apps/products/${s.id}`),children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"View"]})]}),e.jsxs(o,{className:"mt-2",children:[e.jsxs(n,{xs:6,children:[e.jsx("small",{className:"text-muted",children:"Price:"}),e.jsxs("div",{className:"fw-bold text-primary",children:["₫",q(s.price)]})]}),e.jsxs(n,{xs:6,children:[e.jsx("small",{className:"text-muted",children:"Duration:"}),e.jsxs("div",{className:"fw-bold",children:[s.duration," min"]})]})]}),s.description&&e.jsx("div",{className:"mt-2",children:e.jsx("small",{className:"text-muted",children:s.description})})]})})},s.id))})]})})]}),e.jsxs(n,{md:4,children:[e.jsx(h,{className:"mb-3",children:e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{className:"mb-0",children:"Product Images"}),e.jsxs(j,{variant:"primary",size:"sm",onClick:()=>Q(!0),disabled:B.isPending||G.isPending,children:[e.jsx("i",{className:"mdi mdi-upload me-1"}),"Upload Images"]})]}),i.imageUrls&&i.imageUrls.length>0?e.jsx(o,{children:i.imageUrls.map((s,t)=>e.jsx(n,{xs:6,className:"mb-3",children:e.jsxs("div",{className:"position-relative",children:[e.jsx("img",{src:s,alt:`Product image ${t+1}`,className:"img-fluid rounded",style:{width:"100%",height:"150px",objectFit:"cover"}}),e.jsx(j,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0 m-1",onClick:()=>ne(s),disabled:G.isPending,children:e.jsx("i",{className:"mdi mdi-close"})})]})},t))}):e.jsx(_,{variant:"info",className:"mb-0",children:'No images uploaded yet. Click "Upload Images" to add product images.'})]})}),e.jsx(h,{children:e.jsxs(h.Body,{children:[e.jsx("h5",{className:"mb-3",children:"Metadata"}),e.jsx(o,{className:"mb-3",children:e.jsxs(n,{xs:12,children:[e.jsx("strong",{children:"Created By:"}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:i.createdBy})]})}),e.jsx(o,{className:"mb-3",children:e.jsxs(n,{xs:12,children:[e.jsx("strong",{children:"Created At:"}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:new Date(i.createdAt).toLocaleString()})]})}),i.updatedBy&&e.jsx(o,{className:"mb-3",children:e.jsxs(n,{xs:12,children:[e.jsx("strong",{children:"Updated By:"}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:i.updatedBy})]})}),i.updatedAt&&e.jsx(o,{className:"mb-3",children:e.jsxs(n,{xs:12,children:[e.jsx("strong",{children:"Updated At:"}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:new Date(i.updatedAt).toLocaleString()})]})})]})})]})]}),e.jsxs(y,{show:me,onHide:()=>Q(!1),size:"lg",centered:!0,children:[e.jsx(y.Header,{closeButton:!0,children:e.jsx(y.Title,{children:"Upload Product Images"})}),e.jsxs(y.Body,{style:{maxHeight:"70vh",overflowY:"auto"},children:[e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Select Images"}),e.jsx(ce,{showPreview:!0,onFileUpload:s=>Z(s)}),e.jsx(c.Text,{className:"text-muted",children:"You can upload multiple images. Images will be associated with this product."})]}),i.imageUrls&&i.imageUrls.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{}),e.jsx("h6",{children:"Current Images"}),e.jsx(o,{children:i.imageUrls.map((s,t)=>e.jsx(n,{xs:6,md:4,className:"mb-3",children:e.jsxs("div",{className:"position-relative",children:[e.jsx("img",{src:s,alt:`Product image ${t+1}`,className:"img-fluid rounded",style:{width:"100%",height:"150px",objectFit:"cover"}}),e.jsx(j,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0 m-1",onClick:()=>ne(s),disabled:G.isPending,children:e.jsx("i",{className:"mdi mdi-close"})})]})},t))})]})]}),e.jsxs(y.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:()=>Q(!1),children:"Cancel"}),e.jsx(j,{variant:"primary",onClick:Se,disabled:D.length===0||B.isPending,children:B.isPending?e.jsxs(e.Fragment,{children:[e.jsx(H,{animation:"border",size:"sm",className:"me-2"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-upload me-1"}),"Upload ",D.length>0&&`(${D.length})`]})})]})]}),i&&e.jsxs(y,{show:Y,onHide:()=>R(!1),size:"xl",scrollable:!0,centered:!0,children:[e.jsx(y.Header,{closeButton:!0,children:e.jsx(y.Title,{children:"Edit Product"})}),e.jsxs(c,{onSubmit:Ve,children:[e.jsxs(y.Body,{style:{maxHeight:"70vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs(o,{children:[e.jsx(n,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Product Name *"}),e.jsx(c.Control,{type:"text",placeholder:"Enter product name",value:m.name,onChange:s=>w({...m,name:s.target.value}),required:!0})]})}),e.jsx(n,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Category *"}),e.jsx(le,{className:"react-select",classNamePrefix:"react-select",options:W,value:ve,onChange:ye,placeholder:"Select a category",isClearable:!0,isSearchable:!0}),m.categoryLevelCode&&e.jsxs(c.Text,{className:"text-muted d-block mt-1",children:["Level Code: ",e.jsx("strong",{children:m.categoryLevelCode})]})]})})]}),e.jsxs(o,{children:[e.jsx(n,{md:6,children:e.jsx(J,{label:"Price *",placeholder:"0",currency:"VND",value:m.price,onChange:s=>w({...m,price:s}),required:!0,containerClass:"mb-3"})}),e.jsx(n,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Duration (minutes) *"}),e.jsx(X,{className:"react-select",classNamePrefix:"react-select",options:S,value:m.duration?S.find(s=>s.value===m.duration)||{value:m.duration,label:`${m.duration} minutes`}:null,onChange:s=>{const t=s?typeof s.value=="number"?s.value:parseInt(s.value):0;w({...m,duration:t})},onCreateOption:s=>{const t=parseInt(s)||0;w({...m,duration:t})},placeholder:"Select or enter duration...",isClearable:!1,formatCreateLabel:s=>`Use ${s} minutes`,required:!0})]})})]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Description *"}),e.jsx(c.Control,{as:"textarea",rows:3,placeholder:"Enter product description",value:m.description,onChange:s=>w({...m,description:s.target.value}),required:!0})]})]}),i.type===1&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"mb-0 d-inline me-3",children:[e.jsx(u,{bg:"info",className:"me-2",children:f.length}),"Variants"]}),e.jsxs("h5",{className:"mb-0 d-inline",children:[e.jsx(u,{bg:"success",className:"me-2",children:I.length}),"Addons"]})]}),e.jsxs("div",{children:[e.jsxs(j,{variant:"outline-primary",size:"sm",onClick:Ie,className:"me-2",children:[e.jsx("i",{className:"mdi mdi-plus me-1"})," Add Variant"]}),e.jsxs(j,{variant:"outline-success",size:"sm",onClick:Ce,children:[e.jsx("i",{className:"mdi mdi-plus me-1"})," Add Addon"]})]})]}),f.length===0&&I.length===0?e.jsx("p",{className:"text-muted",children:'No variants or addons. Click "Add Variant" or "Add Addon" to add one.'}):e.jsxs(o,{className:"g-3",children:[f.map((s,t)=>e.jsx(n,{xs:12,md:6,children:e.jsx(h,{className:"h-100 border-info",children:e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(u,{bg:"info",className:"me-2",children:"Variant"}),s.id?"Existing":"New"," ",t+1]}),e.jsx(j,{variant:"outline-danger",size:"sm",onClick:()=>we(t),children:e.jsx("i",{className:"mdi mdi-close"})})]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Variant Name *"}),e.jsx(c.Control,{type:"text",placeholder:"Enter variant name",value:s.name,onChange:a=>M(t,"name",a.target.value),required:!0})]}),e.jsxs(o,{children:[e.jsx(n,{md:6,children:e.jsx(J,{label:"Price *",placeholder:"0",currency:"VND",value:s.price,onChange:a=>M(t,"price",a),required:!0,containerClass:"mb-3"})}),e.jsx(n,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Duration (min) *"}),e.jsx(X,{className:"react-select",classNamePrefix:"react-select",options:S,value:s.duration?S.find(a=>a.value===s.duration)||{value:s.duration,label:`${s.duration} minutes`}:null,onChange:a=>{const r=a?typeof a.value=="number"?a.value:parseInt(a.value):0;M(t,"duration",r)},onCreateOption:a=>{const r=parseInt(a)||0;M(t,"duration",r)},placeholder:"Select or enter duration...",isClearable:!1,formatCreateLabel:a=>`Use ${a} minutes`})]})})]}),e.jsxs(c.Group,{className:"mb-0",children:[e.jsx(c.Label,{children:"Description *"}),e.jsx(c.Control,{as:"textarea",rows:2,placeholder:"Enter variant description",value:s.description,onChange:a=>M(t,"description",a.target.value),required:!0})]})]})})},`variant-${s.id||t}`)),I.map((s,t)=>e.jsx(n,{xs:12,md:6,children:e.jsx(h,{className:"h-100 border-success",children:e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(u,{bg:"success",className:"me-2",children:"Addon"}),s.id?"Existing":"New"," ",t+1]}),e.jsx(j,{variant:"outline-danger",size:"sm",onClick:()=>Ae(t),children:e.jsx("i",{className:"mdi mdi-close"})})]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Addon Name *"}),e.jsx(c.Control,{type:"text",placeholder:"Enter addon name",value:s.name,onChange:a=>O(t,"name",a.target.value),required:!0})]}),e.jsxs(o,{children:[e.jsx(n,{md:6,children:e.jsx(J,{label:"Price *",placeholder:"0",currency:"VND",value:s.price,onChange:a=>O(t,"price",a),required:!0,containerClass:"mb-3"})}),e.jsx(n,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Duration (min) *"}),e.jsx(X,{className:"react-select",classNamePrefix:"react-select",options:S,value:s.duration?S.find(a=>a.value===s.duration)||{value:s.duration,label:`${s.duration} minutes`}:null,onChange:a=>{const r=a?typeof a.value=="number"?a.value:parseInt(a.value):0;O(t,"duration",r)},onCreateOption:a=>{const r=parseInt(a)||0;O(t,"duration",r)},placeholder:"Select or enter duration...",isClearable:!1,formatCreateLabel:a=>`Use ${a} minutes`})]})})]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Link to Variants (Optional)"}),e.jsx(le,{isMulti:!0,className:"react-select",classNamePrefix:"react-select",options:T,value:(()=>{const a=[];return T.forEach(r=>{r.options&&r.options.forEach(l=>{(l.isNew&&s.variantIndices.includes(l.index)||!l.isNew&&s.existingVariantIds.includes(l.id))&&a.push(l)})}),a})(),getOptionValue:a=>a.isNew?`new_${a.index}`:`existing_${a.id}`,formatGroupLabel:a=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-bold",children:a.label}),e.jsx(u,{bg:a.label.includes("New")?"info":"secondary",className:"ms-2",children:a.options.length})]}),formatOptionLabel:(a,{context:r})=>r==="value"?a.label:e.jsxs("div",{className:"d-flex align-items-center",children:[a.isNew&&e.jsx(u,{bg:"info",className:"me-2",style:{fontSize:"0.7rem"},children:"New"}),!a.isNew&&e.jsx(u,{bg:"secondary",className:"me-2",style:{fontSize:"0.7rem"},children:"Existing"}),e.jsx("span",{children:a.label})]}),onChange:a=>{const r=[],l=[];a&&(Array.isArray(a)?a:[a]).forEach(v=>{v.isNew?r.push(v.index):l.push(v.id)}),Pe(t,r,l)},placeholder:"Search and select variants...",isSearchable:!0,isClearable:!0,isDisabled:T.length===0,noOptionsMessage:({inputValue:a})=>a?`No variants found matching "${a}"`:"No variants available. Add new variants above or create variants first.",filterOption:(a,r)=>{var v;if(!r)return!0;const l=r.toLowerCase();return(((v=a.label)==null?void 0:v.toLowerCase())||"").includes(l)}}),e.jsx(c.Text,{className:"text-muted",children:T.length===0?"No variants available. Add new variants above or create variants first.":"Search and select variants from new ones being created or existing ones from the database. You can select multiple variants."})]}),e.jsxs(c.Group,{className:"mb-0",children:[e.jsx(c.Label,{children:"Description *"}),e.jsx(c.Control,{as:"textarea",rows:2,placeholder:"Enter addon description",value:s.description,onChange:a=>O(t,"description",a.target.value),required:!0})]})]})})},`addon-${s.id||t}`))]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(u,{bg:"secondary",className:"me-2",children:"Images"}),"Product Images (Optional)"]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(ce,{showPreview:!0,onFileUpload:s=>se(s)}),e.jsx(c.Text,{className:"text-muted",children:"Upload additional images for this product."})]})]})]})]}),e.jsxs(y.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx(j,{variant:"primary",type:"submit",disabled:F.isPending,children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx(H,{animation:"border",size:"sm",className:"me-2"}),"Updating..."]}):"Update Product"})]})]})]})]}):null};export{ms as default};
