import{a3 as X,a4 as ie,a5 as te,r as B,j as e,h as c,a6 as ae,a as re,a2 as le,P as D,d as j,f as d}from"./index-765b91f2.js";import{g as ce}from"./statusUtils-7d283168.js";import{S as N}from"./Spinner-39bef8b1.js";import{T as M}from"./Table-7c3464d6.js";import{B as C}from"./Badge-e7bba61a.js";import{B as u}from"./Button-adecbc05.js";import{C as de}from"./Collapse-1947a2fd.js";import{A as k}from"./Alert-d43623a3.js";import{F as oe}from"./FileUploader-d314f5fd.js";import{b as me,c as xe,d as he,e as je,f as ue,g as ge,h as pe,i as fe}from"./useBookings-a001e683.js";import{u as ee}from"./useQuery-57e6701b.js";import{u as Ne}from"./useProducts-b478fe08.js";import{B as be}from"./ButtonGroup-be732f4a.js";import{M as V}from"./Modal-fe7367ee.js";import"./hook-d5bb7d25.js";import"./useMutation-428f7e03.js";import"./documentClient-3aa58490.js";import"./AbstractModalHeader-7e81bf58.js";import"./useWindow-8031c7f0.js";import"./hasClass-d2e02dba.js";import"./useMergedRefs-384643d8.js";import"./DataKey-e12315fd.js";async function ye(a){const x=await X.get(`/transaction/${a}`);return ie(x)}function we(a){return ee({queryKey:["transaction",a],queryFn:()=>ye(a),enabled:!!a&&a.length>0,staleTime:3e4,retry:2})}async function ve(a){const x=await X.get(`/audits/target/${a}`);return te(x)}function ke(a){return ee({queryKey:["audit-logs",a],queryFn:()=>ve(a),enabled:!!a&&a.length>0,staleTime:3e4,retry:2,select:x=>x||[]})}const Be=({latitude:a,longitude:x,address:o,height:S="400px"})=>{const s=B.useRef(null),g=B.useRef(null),m=B.useRef(null);return B.useEffect(()=>{const p="AIzaSyDJvwpR_epAanY-ayIYf8AZmjUu2IgFpdc";if(!s.current)return;const n=()=>{if(!window.google||!window.google.maps){setTimeout(n,100);return}try{const l={lat:a,lng:x};if(g.current)g.current.setCenter(l),m.current&&m.current.setPosition(l);else{const t=new window.google.maps.Map(s.current,{center:l,zoom:15,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0});g.current=t;const i=new window.google.maps.Marker({position:l,map:t,title:o||"Booking Location"});if(m.current=i,o){const b=new window.google.maps.InfoWindow({content:`<div><strong>Booking Location</strong><br/>${o}</div>`});i.addListener("click",()=>{b.open(t,i)}),b.open(t,i)}}}catch(l){console.error("Error initializing map:",l)}};if(window.google&&window.google.maps)n();else{const l=document.querySelector('script[src*="maps.googleapis.com"]');if(l)l.addEventListener("load",()=>{n()});else{const t=`https://maps.googleapis.com/maps/api/js?key=${p}&libraries=places`,i=document.createElement("script");i.src=t,i.async=!0,i.defer=!0,i.onload=()=>{n()},document.head.appendChild(i)}}return()=>{var l;m.current&&((l=window.google)!=null&&l.maps)&&m.current.setMap(null)}},[a,x,o]),e.jsx("div",{ref:s,style:{width:"100%",height:S,borderRadius:"8px",overflow:"hidden",border:"1px solid #dee2e6"}})},Se=({auditLogs:a,isLoading:x})=>{const[o,S]=B.useState(new Set),s=n=>{S(l=>{const t=new Set(l);return t.has(n)?t.delete(n):t.add(n),t})},g=n=>{if(!n||n==="")return null;try{return JSON.parse(n)}catch{return n}},m=(n,l)=>{const t=g(n),i=g(l);if((t===null||t==="")&&(i===null||i===""))return null;if((t===null||t==="")&&i!==null&&i!=="")return[{field:"value",oldValue:null,newValue:i}];if((i===null||i==="")&&t!==null&&t!=="")return[{field:"value",oldValue:t,newValue:null}];if(typeof t=="object"&&typeof i=="object"&&t!==null&&i!==null&&!Array.isArray(t)&&!Array.isArray(i)){const A=new Set;Object.keys(t).forEach(f=>A.add(f)),Object.keys(i).forEach(f=>A.add(f));const T=[];return A.forEach(f=>{const y=t[f],w=i[f],L=y==null?null:String(y),I=w==null?null:String(w);L!==I&&T.push({field:f,oldValue:y,newValue:w})}),T.length>0?T:null}const b=t===null?null:String(t),U=i===null?null:String(i);return b!==U?[{field:"value",oldValue:t,newValue:i}]:null},p=(n,l)=>n==null||n===""?e.jsx("span",{className:"text-muted fst-italic",children:"(empty)"}):Array.isArray(n)?e.jsxs("div",{children:[e.jsxs(C,{bg:l?"danger":"success",className:"mb-1",children:[n.length," item",n.length!==1?"s":""]}),e.jsx("ul",{className:"mb-0 small",style:{fontSize:"11px",maxHeight:"150px",overflow:"auto"},children:n.map((t,i)=>e.jsx("li",{children:e.jsx("code",{children:typeof t=="string"?t:JSON.stringify(t)})},i))})]}):typeof n=="object"?e.jsx("pre",{className:"mb-0 small",style:{fontSize:"11px",maxHeight:"150px",overflow:"auto"},children:JSON.stringify(n,null,2)}):e.jsx("span",{children:String(n)});return e.jsxs(c,{className:"mb-3",children:[e.jsx(c.Header,{children:e.jsx("h4",{className:"mb-0",children:"Audit Logs"})}),e.jsx(c.Body,{children:x?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(N,{animation:"border",size:"sm",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted small",children:"Loading audit logs..."})]}):a.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(M,{striped:!0,bordered:!0,hover:!0,size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Action Type"}),e.jsx("th",{children:"Target Type"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{children:"Target Time"}),e.jsx("th",{children:"Created By"}),e.jsx("th",{children:"Changes"})]})}),e.jsx("tbody",{children:a.map(n=>{const l=n.oldData&&n.oldData!==""||n.newData&&n.newData!=="",t=l?m(n.oldData,n.newData):null;return e.jsxs("tr",{children:[e.jsx("td",{children:n.actionType?e.jsx(C,{bg:"primary",children:n.actionType}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:n.targetType?e.jsx("code",{children:n.targetType}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:new Date(n.createdAt).toLocaleString("vi-VN")}),e.jsx("td",{children:new Date(n.targetTime).toLocaleString("vi-VN")}),e.jsx("td",{children:e.jsxs("code",{className:"small",children:[n.createdBy.substring(0,8),"..."]})}),e.jsx("td",{children:l?e.jsxs("div",{children:[e.jsxs(u,{variant:"link",size:"sm",className:"p-0 text-primary",onClick:()=>s(n.id),children:[e.jsx("i",{className:`mdi mdi-chevron-${o.has(n.id)?"down":"right"} me-1`}),"View Changes"]}),e.jsx(de,{in:o.has(n.id),children:e.jsx("div",{className:"mt-2",children:t?e.jsxs(M,{size:"sm",bordered:!0,className:"mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"30%"},children:"Field"}),e.jsx("th",{style:{width:"35%"},children:"Old Value"}),e.jsx("th",{style:{width:"35%"},children:"New Value"})]})}),e.jsx("tbody",{children:t.map((i,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{className:"small",children:i.field})}),e.jsx("td",{children:e.jsx("span",{className:"text-danger",children:p(i.oldValue,!0)})}),e.jsx("td",{children:e.jsx("span",{className:"text-success",children:p(i.newValue,!1)})})]},b))})]}):e.jsxs("div",{className:"border rounded p-2 bg-light",children:[n.oldData&&n.oldData!==""&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{className:"text-danger small",children:"Old Data:"}),e.jsx("pre",{className:"mb-0 small text-danger",style:{fontSize:"11px",maxHeight:"200px",overflow:"auto"},children:n.oldData})]}),n.newData&&n.newData!==""&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-success small",children:"New Data:"}),e.jsx("pre",{className:"mb-0 small text-success",style:{fontSize:"11px",maxHeight:"200px",overflow:"auto"},children:n.newData})]})]})})})]}):e.jsx("span",{className:"text-muted",children:"-"})})]},n.id)})})]})}):e.jsx(k,{variant:"info",children:e.jsx("p",{className:"mb-0",children:"No audit logs found for this booking."})})})]})},_e=()=>{var Q,J,K,Y;const{id:a}=ae(),x=re(),{showNotification:o}=le(),S=me(a||""),{data:s,isLoading:g,error:m,isError:p}=S,{data:n=[]}=Ne(),l=(Q=s==null?void 0:s.extraData)==null?void 0:Q.transactionId,t=we(l),{data:i,isLoading:b}=t,U=ke(a),{data:A=[],isLoading:T}=U;B.useEffect(()=>{p&&m&&o(m instanceof Error?m.message:"Failed to load booking details","error")},[p,m,o]);const f=xe(),y=he(),w=je(),L=ue(),I=ge(),q=pe(),R=fe(),[se,F]=B.useState(!1),[v,H]=B.useState([]),O=(J=s==null?void 0:s.extraData)==null?void 0:J.imageUrls;if(!a)return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Booking Detail",subName:"Apps"}),e.jsx(k,{variant:"danger",children:"Booking ID is required"})]});const E=r=>n.find(h=>h.id===r),P=async(r,h)=>{if(a)try{await r(),o(`${h} successful`,"success")}catch(z){o(z instanceof Error?z.message:`Failed to ${h.toLowerCase()}`,"error")}};return g?e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Booking Detail",subName:"Apps"}),e.jsxs("div",{className:"text-center py-5",children:[e.jsx(N,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading booking details..."}),e.jsxs("p",{className:"text-muted small",children:["Reference: ",a]})]})]}):p||m?e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Booking Detail",subName:"Apps"}),e.jsxs(k,{variant:"danger",children:[e.jsx("h5",{children:"Failed to load booking"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",m instanceof Error?m.message:String(m)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Booking ID:"})," ",a]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Query Status:"})," ",S.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Is Enabled:"})," ",String(S.isEnabled)]}),e.jsx(u,{variant:"secondary",onClick:()=>x("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]}):!g&&!p&&!s?e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Booking Detail",subName:"Apps"}),e.jsxs(k,{variant:"warning",children:[e.jsx("h5",{children:"Booking not found"}),e.jsxs("p",{children:["No booking found with ID: ",a]}),e.jsx(u,{variant:"secondary",onClick:()=>x("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]}):!s&&!g&&!p?null:s?e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Booking Detail",subName:"Apps"}),e.jsx(j,{children:e.jsxs(d,{xs:12,children:[e.jsxs("div",{className:"mb-3 d-flex justify-content-between align-items-center",children:[e.jsxs(u,{variant:"secondary",onClick:()=>x("/apps/booking"),children:[e.jsx("i",{className:"mdi mdi-arrow-left me-1"})," Back to Bookings"]}),e.jsxs(be,{children:[e.jsxs(u,{variant:"outline-primary",size:"sm",onClick:()=>P(()=>f.mutateAsync(a),"En route"),disabled:f.isPending,children:[f.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-car me-1"}),"En Route"]}),e.jsxs(u,{variant:"outline-info",size:"sm",onClick:()=>P(()=>y.mutateAsync(a),"Check in"),disabled:y.isPending,children:[y.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-check-circle me-1"}),"Check In"]}),e.jsxs(u,{variant:"outline-warning",size:"sm",onClick:()=>P(()=>w.mutateAsync(a),"Start"),disabled:w.isPending,children:[w.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-play me-1"}),"Start"]}),e.jsxs(u,{variant:"outline-success",size:"sm",onClick:()=>P(()=>L.mutateAsync(a),"Finish"),disabled:L.isPending,children:[L.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-check me-1"}),"Finish"]}),e.jsxs(u,{variant:"outline-danger",size:"sm",onClick:()=>{window.confirm("Are you sure you want to cancel this booking?")&&P(()=>I.mutateAsync(a),"Cancel")},disabled:I.isPending||q.isPending,children:[I.isPending||q.isPending?e.jsx(N,{animation:"border",size:"sm",className:"me-1"}):e.jsx("i",{className:"mdi mdi-cancel me-1"}),"Cancel"]})]})]}),e.jsxs(c,{className:"mb-3",children:[e.jsx(c.Header,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Booking Information"}),ce(s.status)]})}),e.jsxs(c.Body,{children:[e.jsxs(j,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Booking Code"}),e.jsxs("div",{className:"form-control-plaintext d-flex align-items-center gap-2",children:[e.jsx("code",{children:s.code||s.id}),e.jsx(u,{variant:"link",size:"sm",className:"p-0 text-muted",onClick:async()=>{const r=s.code||s.id;try{await navigator.clipboard.writeText(r),o("Booking code copied to clipboard","success")}catch{o("Failed to copy booking code","error")}},title:"Copy booking code",children:e.jsx("i",{className:"mdi mdi-clipboard-text"})})]})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Booking Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.bookingTime).toLocaleString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})})]}),e.jsx("hr",{}),e.jsxs(j,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer Name"}),e.jsx("div",{className:"form-control-plaintext",children:s.customerName||e.jsx("span",{className:"text-muted",children:"Not provided"})})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer Phone"}),e.jsx("div",{className:"form-control-plaintext",children:s.customerPhone||e.jsx("span",{className:"text-muted",children:"-"})})]})})]}),s.customerId&&e.jsx(j,{children:e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Customer ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:s.customerId})})]})})}),e.jsx("hr",{}),e.jsx(j,{children:e.jsx(d,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Address"}),e.jsx("div",{className:"form-control-plaintext",children:s.address||e.jsx("span",{className:"text-muted",children:"Not provided"})})]})})}),s.latitude!==void 0&&s.longitude!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(j,{children:e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Coordinates"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsxs("small",{children:["Latitude: ",s.latitude.toFixed(6),", Longitude: ",s.longitude.toFixed(6)]})})]})})}),e.jsx(j,{children:e.jsx(d,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Location Map"}),e.jsx(Be,{latitude:s.latitude,longitude:s.longitude,address:s.address,height:"400px"})]})})})]})]})]}),s.items&&s.items.length>0&&e.jsxs(c,{className:"mb-3",children:[e.jsx(c.Header,{children:e.jsx("h4",{className:"mb-0",children:"Booking Items"})}),e.jsx(c.Body,{children:e.jsxs(M,{hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(K=s.items)==null?void 0:K.map((r,h)=>{var _,G,W,Z;const z=r.productName||((_=E(r.productId))==null?void 0:_.name)||r.productId,$=r.unitPrice||((G=E(r.productId))==null?void 0:G.price)||0,ne=r.totalPrice||$*r.quantity;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:z}),((W=E(r.productId))==null?void 0:W.description)&&e.jsx("div",{className:"text-muted small",children:(Z=E(r.productId))==null?void 0:Z.description})]}),e.jsx("td",{children:$>0?e.jsxs(e.Fragment,{children:[$.toLocaleString("vi-VN")," VND"]}):e.jsx("span",{className:"text-muted",children:"N/A"})}),e.jsx("td",{children:e.jsx(C,{bg:"info",children:r.quantity})}),e.jsx("td",{children:e.jsxs("strong",{children:[ne.toLocaleString("vi-VN")," VND"]})})]},h)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-end fw-bold",children:"Total Price:"}),e.jsx("td",{className:"fw-bold",children:s.totalPrice?e.jsxs(e.Fragment,{children:[s.totalPrice.toLocaleString("vi-VN")," VND"]}):e.jsxs(e.Fragment,{children:[(Y=s.items)==null?void 0:Y.reduce((r,h)=>r+(h.totalPrice||0),0).toLocaleString("vi-VN")," ","VND"]})})]})})]})})]}),(s==null?void 0:s.notes)&&e.jsxs(c,{className:"mb-3",children:[e.jsx(c.Header,{children:e.jsx("h4",{className:"mb-0",children:"Notes"})}),e.jsx(c.Body,{children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:s.notes})})]}),l&&e.jsxs(c,{className:"mb-3",children:[e.jsx(c.Header,{children:e.jsx("h4",{className:"mb-0",children:"Transaction Details"})}),e.jsx(c.Body,{children:b?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(N,{animation:"border",size:"sm",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted small",children:"Loading transaction details..."})]}):i?e.jsxs(e.Fragment,{children:[e.jsxs(j,{className:"mb-3",children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Transaction ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:i.id})})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Amount"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsxs("h5",{className:"mb-0 text-success",children:[i.amount.toLocaleString("vi-VN")," VND"]})})]})})]}),i.referenceCode&&e.jsxs(j,{className:"mb-3",children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Reference Code"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:i.referenceCode})})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Settlement"}),e.jsx("div",{className:"form-control-plaintext",children:i.isSettlement?e.jsx(C,{bg:"success",children:"Yes"}):e.jsx(C,{bg:"secondary",children:"No"})})]})})]}),i.createdAt&&e.jsx(j,{className:"mb-3",children:e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Created At"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(i.createdAt).toLocaleString("vi-VN")})]})})}),i.transactionDetails&&i.transactionDetails.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Transaction Details"}),e.jsxs(M,{striped:!0,bordered:!0,hover:!0,size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Wallet ID"}),e.jsx("th",{children:"Note"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:i.transactionDetails.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(C,{bg:"info",children:["Type ",r.type]})}),e.jsx("td",{children:e.jsxs("strong",{children:[r.amount.toLocaleString("vi-VN")," VND"]})}),e.jsx("td",{children:e.jsxs("code",{className:"small",children:[r.walletId.substring(0,8),"..."]})}),e.jsx("td",{children:r.note||"-"}),e.jsx("td",{children:new Date(r.createdAt).toLocaleString("vi-VN")})]},r.id))})]})]})]}):t.isError?e.jsx(k,{variant:"warning",children:e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Note:"})," Transaction details not found. Transaction ID: ",e.jsx("code",{children:l})]})}):null})]}),e.jsx(Se,{auditLogs:A,isLoading:T}),e.jsxs(c,{className:"mb-3",children:[e.jsxs(c.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Booking Images"}),e.jsxs(u,{variant:"primary",size:"sm",onClick:()=>F(!0),children:[e.jsx("i",{className:"mdi mdi-upload me-1"}),"Upload Images"]})]}),e.jsx(c.Body,{children:O&&O.length>0?e.jsx(j,{children:O.map((r,h)=>e.jsx(d,{xs:6,md:4,lg:3,className:"mb-3",children:e.jsx("div",{className:"position-relative",children:e.jsx("img",{src:r,alt:`Booking image ${h+1}`,className:"img-fluid rounded",style:{width:"100%",height:"200px",objectFit:"cover"}})})},h))}):e.jsx(k,{variant:"info",children:e.jsx("p",{className:"mb-0",children:"No images uploaded for this booking yet."})})})]}),e.jsxs(c,{children:[e.jsx(c.Header,{children:e.jsx("h4",{className:"mb-0",children:"Additional Information"})}),e.jsxs(c.Body,{children:[e.jsxs(j,{children:[s.technicianId&&e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Technician ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:s.technicianId})})]})}),s.technicianName&&e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Technician Name"}),e.jsx("div",{className:"form-control-plaintext",children:s.technicianName})]})})]}),s.startTime&&e.jsxs(j,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Start Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.startTime).toLocaleString("vi-VN")})]})}),s.endTime&&e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"End Time"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(s.endTime).toLocaleString("vi-VN")})]})})]}),s.totalPrice&&e.jsx(j,{children:e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Total Price"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsxs("h5",{className:"mb-0 text-primary",children:[s.totalPrice.toLocaleString("vi-VN")," VND"]})})]})})})]})]})]})}),e.jsxs(V,{show:se,onHide:()=>F(!1),size:"lg",children:[e.jsx(V.Header,{closeButton:!0,children:e.jsx(V.Title,{children:"Upload Booking Images"})}),e.jsxs(V.Body,{children:[e.jsx(oe,{showPreview:!0,onFileUpload:r=>H(r)}),v.length>0&&e.jsx(k,{variant:"info",className:"mt-3",children:e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:v.length})," image",v.length!==1?"s":"",' selected. Click "Upload" to add them to this booking.']})})]}),e.jsxs(V.Footer,{children:[e.jsx(u,{variant:"secondary",onClick:()=>{F(!1),H([])},children:"Cancel"}),e.jsx(u,{variant:"primary",onClick:async()=>{if(!(!a||v.length===0))try{await R.mutateAsync({bookingId:a,images:v}),H([]),F(!1),o("Images uploaded successfully!","success")}catch(r){const h=r instanceof Error?r.message:"Failed to upload images. Please try again.";o(h,"error")}},disabled:v.length===0||R.isPending,children:R.isPending?e.jsxs(e.Fragment,{children:[e.jsx(N,{animation:"border",size:"sm",className:"me-2"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-upload me-1"}),"Upload ",v.length>0&&`(${v.length})`]})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Booking Detail",subName:"Apps"}),e.jsxs(k,{variant:"warning",children:[e.jsx("h5",{children:"Unable to load booking"}),e.jsxs("p",{children:["Booking ID: ",a]}),e.jsxs("p",{children:["Loading: ",String(g)]}),e.jsxs("p",{children:["Error: ",String(p)]}),e.jsxs("p",{children:["Status: ",status]}),e.jsx(u,{variant:"secondary",onClick:()=>x("/apps/booking"),className:"mt-2",children:"Back to Bookings"})]})]})};export{_e as default};
