import{w as P,aZ as F,r as x,j as e,P as E,d as A,f as p,h as y,v as a,aW as b}from"./index-ce8cbde8.js";import{u as k}from"./useQuery-c8258469.js";import{u as B}from"./useMutation-352100f5.js";import{B as S}from"./Button-c6d90f45.js";import{A as T}from"./Alert-f54c2503.js";import{S as L}from"./Spinner-b86989e2.js";import{T as M}from"./Table-129428d5.js";import{M as d}from"./Modal-bc2f312b.js";const D="https://api.dev.usta.vn",u=P.create({baseURL:`${D}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});u.interceptors.request.use(async s=>{const r=localStorage.getItem("_USTA_OAUTH");if(r)try{const i=JSON.parse(r);s.headers.Authorization=`Bearer ${i.accessToken}`}catch(i){console.error("[Shift Schedule API] Failed to parse OAuth session:",i)}return s},s=>Promise.reject(s));u.interceptors.response.use(s=>s,s=>{var r;return console.error("[Shift Schedule API] Response error:",((r=s.response)==null?void 0:r.data)||s.message),Promise.reject(s)});async function q(s={}){const r=await u.get("/shift-schedules/",{params:s});if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to fetch shift schedules")}async function U(s){var r;console.log("[Shift Schedule API] Creating shift schedule with data:",JSON.stringify(s,null,2));try{const i=await u.post("/shift-schedules/",s);if(console.log("[Shift Schedule API] Create response:",i.data),i.data.success)return i.data.data;throw new Error(i.data.error||"Failed to create shift schedule")}catch(i){throw console.error("[Shift Schedule API] Create error:",i),console.error("[Shift Schedule API] Error response:",(r=i.response)==null?void 0:r.data),i}}function Z(s={}){return k({queryKey:["shift-schedules",s],queryFn:()=>q(s),staleTime:3e4,retry:2,select:r=>r||[]})}function R(){const s=F();return B({mutationFn:r=>U(r),onSuccess:()=>{s.invalidateQueries({queryKey:["shift-schedules"]})}})}const H=()=>{var f;const[s,r]=x.useState(""),[i,h]=x.useState(!1),[n,c]=x.useState({providerId:"",name:"",timeZone:"SE Asia Standard Time",isActive:!0}),{data:N=[],isLoading:w,error:j}=Z(),l=R(),m=N.filter(t=>t.name.toLowerCase().includes(s.toLowerCase())||t.providerId.toLowerCase().includes(s.toLowerCase())),I=async t=>{var g,v,C;t.preventDefault(),console.log("[ShiftScheduleApp] Submitting form data:",n);try{const o=await l.mutateAsync(n);console.log("[ShiftScheduleApp] Creation successful:",o),h(!1),c({providerId:"",name:"",timeZone:"SE Asia Standard Time",isActive:!0})}catch(o){console.error("[ShiftScheduleApp] Failed to create shift schedule:",o),console.error("[ShiftScheduleApp] Error details:",(g=o.response)==null?void 0:g.data),alert(`Failed to create shift schedule: ${((C=(v=o.response)==null?void 0:v.data)==null?void 0:C.error)||o.message}`)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"Shift Schedule Management",subName:"Apps"}),e.jsx(A,{children:e.jsx(p,{xs:12,children:e.jsx(y,{children:e.jsxs(y.Body,{children:[e.jsxs(A,{className:"mb-3",children:[e.jsx(p,{md:6,children:e.jsx(a.Control,{type:"text",placeholder:"Search by name or provider ID...",value:s,onChange:t=>r(t.target.value)})}),e.jsx(p,{md:6,className:"text-end",children:e.jsxs(S,{variant:"primary",onClick:()=>h(!0),children:[e.jsx("i",{className:"uil uil-plus me-1"})," Create Shift Schedule"]})})]}),j&&e.jsxs(T,{variant:"danger",dismissible:!0,children:["Failed to load shift schedules: ",j.message]}),w?e.jsx("div",{className:"text-center py-5",children:e.jsx(L,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("h5",{children:["Total Schedules: ",m.length]})}),e.jsxs(M,{hover:!0,responsive:!0,children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Provider ID"}),e.jsx("th",{children:"Time Zone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-4 text-muted",children:"No shift schedules found"})}):m.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:t.name})}),e.jsx("td",{children:e.jsx("code",{children:t.providerId})}),e.jsx("td",{children:t.timeZone}),e.jsx("td",{children:t.isActive?e.jsx(b,{bg:"success",children:"Active"}):e.jsx(b,{bg:"secondary",children:"Inactive"})}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString("vi-VN")})]},t.id))})]})]})]})})})}),e.jsxs(d,{show:i,onHide:()=>h(!1),children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:"Create Shift Schedule"})}),e.jsxs(a,{onSubmit:I,children:[e.jsxs(d.Body,{children:[l.isError&&e.jsxs(T,{variant:"danger",dismissible:!0,children:["Failed to create shift schedule: ",(f=l.error)==null?void 0:f.message]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Schedule Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Morning Shift",value:n.name,onChange:t=>c({...n,name:t.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Provider ID *"}),e.jsx(a.Control,{type:"text",placeholder:"d290f1ee-6c54-4b01-90e6-d701748f0851",value:n.providerId,onChange:t=>c({...n,providerId:t.target.value}),required:!0}),e.jsx(a.Text,{className:"text-muted",children:"UUID of the provider/organization"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Time Zone *"}),e.jsxs(a.Select,{value:n.timeZone,onChange:t=>c({...n,timeZone:t.target.value}),required:!0,children:[e.jsx("option",{value:"SE Asia Standard Time",children:"SE Asia Standard Time (UTC+7)"}),e.jsx("option",{value:"UTC",children:"UTC"}),e.jsx("option",{value:"Asia/Ho_Chi_Minh",children:"Asia/Ho Chi Minh"}),e.jsx("option",{value:"Asia/Bangkok",children:"Asia/Bangkok"}),e.jsx("option",{value:"Asia/Singapore",children:"Asia/Singapore"})]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Check,{type:"checkbox",label:"Active",checked:n.isActive,onChange:t=>c({...n,isActive:t.target.checked})}),e.jsx(a.Text,{className:"text-muted",children:"Whether this shift schedule is currently active"})]})]}),e.jsxs(d.Footer,{children:[e.jsx(S,{variant:"secondary",onClick:()=>h(!1),children:"Cancel"}),e.jsx(S,{variant:"primary",type:"submit",disabled:l.isPending,children:l.isPending?"Creating...":"Create Schedule"})]})]})]})]})},V=()=>e.jsx(H,{});export{V as default};
