import{w,aZ as S,r as h,j as e,P as N,d as C,f as m,h as y,v as a}from"./index-9951c232.js";import{u as Z}from"./useQuery-b845a33c.js";import{u as A}from"./useMutation-4a9c65c4.js";import{B as x}from"./Button-a6431399.js";import{A as F}from"./Alert-0f63f259.js";import{S as T}from"./Spinner-b7c06ea5.js";import{T as L}from"./Table-db529312.js";import{M as i}from"./Modal-12d774bd.js";const P={}.VITE_API_SERVER||"http://localhost:80",d=w.create({baseURL:`${P}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});d.interceptors.request.use(async s=>{const t=localStorage.getItem("_USTA_OAUTH");if(t)try{const o=JSON.parse(t);s.headers.Authorization=`Bearer ${o.accessToken}`}catch(o){console.error("[Zone API] Failed to parse OAuth session:",o)}return s},s=>Promise.reject(s));d.interceptors.response.use(s=>s,s=>{var t;return console.error("[Zone API] Response error:",((t=s.response)==null?void 0:t.data)||s.message),Promise.reject(s)});async function E(s={}){const t=await d.get("/zones/",{params:s});if(t.data.success)return t.data.data;throw new Error(t.data.error||"Failed to fetch zones")}async function z(s){const t=await d.post("/zones/",s);if(t.data.success)return t.data.data;throw new Error(t.data.error||"Failed to create zone")}function R(s={}){return Z({queryKey:["zones",s],queryFn:()=>E(s),staleTime:3e4,retry:2,select:t=>t||[]})}function q(){const s=S();return A({mutationFn:t=>z(t),onSuccess:()=>{s.invalidateQueries({queryKey:["zones"]})}})}const B=()=>{const[s,t]=h.useState(""),[o,c]=h.useState(!1),[n,l]=h.useState({name:"",code:"",description:""}),{data:f=[],isLoading:g,error:p}=R(),u=q(),j=f.filter(r=>r.name.toLowerCase().includes(s.toLowerCase())||r.code.toLowerCase().includes(s.toLowerCase())),v=async r=>{r.preventDefault();try{await u.mutateAsync(n),c(!1),l({name:"",code:"",description:""})}catch(b){console.error("Failed to create zone:",b)}};return e.jsxs(e.Fragment,{children:[e.jsx(N,{title:"Zone Management",subName:"Apps"}),e.jsx(C,{children:e.jsx(m,{xs:12,children:e.jsx(y,{children:e.jsxs(y.Body,{children:[e.jsxs(C,{className:"mb-3",children:[e.jsx(m,{md:6,children:e.jsx(a.Control,{type:"text",placeholder:"Search zones...",value:s,onChange:r=>t(r.target.value)})}),e.jsx(m,{md:6,className:"text-end",children:e.jsxs(x,{variant:"primary",onClick:()=>c(!0),children:[e.jsx("i",{className:"uil uil-plus me-1"})," Create Zone"]})})]}),p&&e.jsxs(F,{variant:"danger",dismissible:!0,children:["Failed to load zones: ",p.message]}),g?e.jsx("div",{className:"text-center py-5",children:e.jsx(T,{animation:"border",variant:"primary"})}):e.jsxs(L,{hover:!0,responsive:!0,children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-4 text-muted",children:"No zones found"})}):j.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:r.code})}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.description||"-"}),e.jsx("td",{children:new Date(r.createdAt).toLocaleDateString("vi-VN")})]},r.id))})]})]})})})}),e.jsxs(i,{show:o,onHide:()=>c(!1),children:[e.jsx(i.Header,{closeButton:!0,children:e.jsx(i.Title,{children:"Create New Zone"})}),e.jsxs(a,{onSubmit:v,children:[e.jsxs(i.Body,{children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Zone Code *"}),e.jsx(a.Control,{type:"text",placeholder:"Q5",value:n.code,onChange:r=>l({...n,code:r.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Zone Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Quan 5",value:n.name,onChange:r=>l({...n,name:r.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Description"}),e.jsx(a.Control,{as:"textarea",rows:3,placeholder:"trung tam tp",value:n.description,onChange:r=>l({...n,description:r.target.value})})]})]}),e.jsxs(i.Footer,{children:[e.jsx(x,{variant:"secondary",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{variant:"primary",type:"submit",disabled:u.isPending,children:u.isPending?"Creating...":"Create Zone"})]})]})]})]})},H=()=>e.jsx(B,{});export{H as default};
