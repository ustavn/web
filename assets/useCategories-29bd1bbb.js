import{u as s}from"./useQuery-b845a33c.js";import{w as n,aZ as c}from"./index-9951c232.js";import{u}from"./useMutation-4a9c65c4.js";const i={}.VITE_API_SERVER||"http://localhost:80",a=n.create({baseURL:`${i}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(async e=>{const t=localStorage.getItem("_USTA_OAUTH");if(t)try{const r=JSON.parse(t);e.headers.Authorization=`Bearer ${r.accessToken}`,console.log("[Category API] Request:",{method:e.method,url:e.url,params:e.params,data:e.data,hasAuth:!!e.headers.Authorization})}catch(r){console.error("[Category API] Failed to parse OAuth session:",r)}else console.warn("[Category API] No OAuth session found");return e},e=>(console.error("[Category API] Request error:",e),Promise.reject(e)));a.interceptors.response.use(e=>(console.log("[Category API] Response:",{status:e.status,url:e.config.url,data:e.data}),e),e=>{var t,r,o;return console.error("[Category API] Response error:",{status:(t=e.response)==null?void 0:t.status,url:(r=e.config)==null?void 0:r.url,data:(o=e.response)==null?void 0:o.data,message:e.message}),Promise.reject(e)});async function l(e={}){console.log("[Category API] Fetching categories:",e);const t=await a.get("/categories/");if(t.data.success)return t.data.data;throw new Error(t.data.error||"Failed to fetch categories")}async function g(e){console.log("[Category API] Creating category:",e);const t=await a.post("/categories/",e);if(console.log("[Category API] Category created successfully:",t.data),t.data.success)return t.data.data;throw new Error(t.data.error||"Failed to create category")}function h(e={}){return s({queryKey:["categories",e],queryFn:()=>l(e),staleTime:3e4,retry:2,select:t=>t||[]})}function p(){const e=c();return u({mutationFn:t=>g(t),onSuccess:t=>{console.log("[useCreateCategory] Category created successfully:",t),e.invalidateQueries({queryKey:["categories"]})},onError:t=>{console.error("[useCreateCategory] Failed to create category:",t)}})}export{p as a,h as u};
