import{j as e,r as i,a as R,a2 as $,P as V,d as S,f as y,h as k,ab as G}from"./index-d44dc752.js";import{a as K,b as W,c as q}from"./useUsers-45eb4acf.js";import{B as b}from"./Badge-81770580.js";import{U as J,E as Q}from"./UserDetail-4d22ea54.js";import{a as Pe}from"./UserDetail-4d22ea54.js";import{M as j}from"./Modal-2f262fa5.js";import{F as D}from"./Form-67e6f44c.js";import{B as t}from"./Button-8fe46466.js";import{I as E}from"./InputGroup-0726e51b.js";import{B as X}from"./ButtonGroup-0b64c6d4.js";import{A}from"./Alert-e383ae4d.js";import{S as F}from"./Spinner-cb54056f.js";import"./useQuery-bcafff71.js";import"./useMutation-e99f167c.js";import"./AbstractModalHeader-1da81841.js";import"./useWindow-95447657.js";import"./hasClass-39751ad7.js";import"./useMergedRefs-9b223310.js";import"./DataKey-e12315fd.js";import"./InputGroupContext-965a1119.js";import"./hook-d4a5a220.js";const Y={0:"Admin",1:"User",2:"Technician",3:"Customer"},Z={0:"danger",1:"primary",2:"info",3:"success"},_={0:"Active",1:"Inactive",2:"Suspended"},ee={0:"success",1:"secondary",2:"warning"},se=[{Header:"Full Name",accessor:"fullName",defaultCanSort:!0,Cell:({row:r})=>r.original.fullName||e.jsx("span",{className:"text-muted",children:"-"})},{Header:"Email",accessor:"email",defaultCanSort:!0,Cell:({row:r})=>r.original.email||e.jsx("span",{className:"text-muted",children:"-"})},{Header:"Phone",accessor:"phone",defaultCanSort:!0,Cell:({row:r})=>{const a=r.original;return e.jsxs("div",{children:[a.phone||e.jsx("span",{className:"text-muted",children:"-"}),a.isPhoneVerify&&e.jsx(b,{bg:"success",className:"ms-2",title:"Phone verified",children:e.jsx("i",{className:"mdi mdi-check-circle"})})]})}},{Header:"Role",accessor:"role",defaultCanSort:!0,Cell:({row:r})=>{const a=r.original.role;return e.jsx(b,{bg:Z[a]||"secondary",children:Y[a]||`Role ${a}`})}},{Header:"Status",accessor:"status",defaultCanSort:!0,Cell:({row:r})=>{const a=r.original.status;return e.jsx(b,{bg:ee[a]||"secondary",children:_[a]||`Status ${a}`})}},{Header:"Created At",accessor:"createdAt",defaultCanSort:!0,Cell:({row:r})=>new Date(r.original.createdAt).toLocaleString("vi-VN")}],ae=({show:r,onHide:a,onSuccess:o})=>{const c=K(),[d,n]=i.useState({fullName:null,phone:null,email:null,identity:{fullName:null,identityNumber:null,dateOfBirth:new Date().toISOString(),address:null,issuedDate:new Date().toISOString(),issuedPlace:null}}),[f,l]=i.useState({}),h=async x=>{x.preventDefault(),l({});try{await c.mutateAsync(d),a(),o==null||o(),n({fullName:null,phone:null,email:null,identity:{fullName:null,identityNumber:null,dateOfBirth:new Date().toISOString(),address:null,issuedDate:new Date().toISOString(),issuedPlace:null}})}catch{}},p=()=>{n({fullName:null,phone:null,email:null,identity:{fullName:null,identityNumber:null,dateOfBirth:new Date().toISOString(),address:null,issuedDate:new Date().toISOString(),issuedPlace:null}}),l({}),a()};return e.jsxs(j,{show:r,onHide:p,size:"lg",children:[e.jsx(j.Header,{closeButton:!0,children:e.jsx(j.Title,{children:"Create New User"})}),e.jsxs(D,{onSubmit:h,children:[e.jsx(j.Body,{children:e.jsx(J,{formData:d,onChange:n,errors:f})}),e.jsxs(j.Footer,{children:[e.jsx(t,{variant:"secondary",onClick:p,children:"Cancel"}),e.jsx(t,{variant:"primary",type:"submit",disabled:c.isPending,children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-check me-1"}),"Create User"]})})]})]})]})},re=[{text:"10",value:10},{text:"25",value:25},{text:"50",value:50}],te=()=>{const r=R(),{showNotification:a}=$(),[o,c]=i.useState(1),[d]=i.useState(10),[n,f]=i.useState(""),[l,h]=i.useState("*"),[p,x]=i.useState(!1),[g,v]=i.useState(null),C=W();i.useEffect(()=>{const s=setTimeout(()=>{h(n||"*"),c(1)},500);return()=>clearTimeout(s)},[n]);const{data:m=[],isLoading:z,error:u,refetch:w}=q({keyword:l,page:o,pageSize:d});i.useEffect(()=>{u&&a(u instanceof Error?u.message:"Failed to load users","error")},[u,a]);const P=s=>{s.preventDefault(),h(n),c(1)},U=()=>{f(""),h("*"),c(1)},B=s=>{r(`/apps/users/${s.id}`)},H=s=>{v(s)},M=async s=>{if(window.confirm(`Are you sure you want to delete user "${s.fullName||s.email||s.id}"?`))try{await C.mutateAsync(s.id)}catch{}},T=i.useMemo(()=>{const s={Header:"Actions",id:"actions",defaultCanSort:!1,Cell:({row:N})=>e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"info",size:"sm",className:"me-1",onClick:()=>B(N.original),title:"View details",children:e.jsx("i",{className:"mdi mdi-eye"})}),e.jsx(t,{variant:"primary",size:"sm",className:"me-1",onClick:()=>H(N.original),title:"Edit user",children:e.jsx("i",{className:"mdi mdi-pencil"})}),e.jsx(t,{variant:"danger",size:"sm",onClick:()=>M(N.original),disabled:C.isPending,title:"Delete user",children:C.isPending?e.jsx(F,{animation:"border",size:"sm"}):e.jsx("i",{className:"mdi mdi-delete"})})]})};return[...se,s]},[C.isPending]),I=()=>{w(),x(!1)},O=()=>{w(),v(null)},L=n.trim().length>0;return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"User Management",subName:"Apps"}),e.jsx(S,{children:e.jsx(y,{xs:12,children:e.jsx(k,{children:e.jsxs(k.Body,{children:[e.jsx(S,{className:"mb-4",children:e.jsx(y,{md:8,children:e.jsxs(D,{onSubmit:P,children:[e.jsxs(E,{children:[e.jsx(E.Text,{children:e.jsx("i",{className:"mdi mdi-magnify"})}),e.jsx(D.Control,{type:"text",placeholder:"Search users by name, email, or phone...",value:n,onChange:s=>f(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),P(s))}}),n&&e.jsx(t,{variant:"outline-secondary",onClick:U,title:"Clear search",children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx(t,{variant:"primary",type:"submit",children:"Search"})]}),l&&l!=="*"&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-muted",children:["Searching for: ",e.jsxs("strong",{children:['"',l,'"']})," ",e.jsx(t,{variant:"link",size:"sm",className:"p-0 ms-2",onClick:U,children:"Clear"})]})})]})})}),e.jsx(S,{className:"mb-4",children:e.jsxs(y,{xs:12,children:[e.jsxs(X,{className:"mb-2 gap-1",children:[e.jsxs(t,{variant:"primary",size:"sm",onClick:()=>x(!0),children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Create User"]}),e.jsxs(t,{variant:"secondary",size:"sm",onClick:async()=>{try{await w(),a("Users list refreshed","success")}catch(s){a(s instanceof Error?s.message:"Failed to refresh users","error")}},children:[e.jsx("i",{className:"mdi mdi-refresh me-1"}),"Reload"]}),L&&e.jsxs(t,{variant:"outline-danger",size:"sm",onClick:U,title:"Clear search",children:[e.jsx("i",{className:"mdi mdi-filter-remove me-1"}),"Clear Search"]})]}),m.length>0&&e.jsx("div",{className:"mt-2",children:e.jsxs(b,{bg:"info",children:[m.length," user",m.length!==1?"s":""," found"]})})]})}),u&&e.jsxs(A,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",u instanceof Error?u.message:"Failed to load users"]}),z?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(F,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading users..."})]}):m.length===0?e.jsx(A,{variant:"info",children:e.jsx("p",{className:"mb-0",children:l&&l!=="*"?`No users found matching "${l}".`:"No users found."})}):e.jsxs(e.Fragment,{children:[e.jsx(G,{columns:T,data:m,pageSize:d,sizePerPageList:re,isSortable:!0,pagination:!0,isSearchable:!1,tableClass:"table-striped table-bordered",theadClass:"table-dark"}),m.length>=d&&e.jsx(S,{className:"mt-3",children:e.jsx(y,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(t,{variant:"outline-primary",size:"sm",disabled:o===1,onClick:()=>c(o-1),children:[e.jsx("i",{className:"mdi mdi-chevron-left me-1"}),"Previous"]}),e.jsxs("span",{className:"text-muted",children:["Page ",o]}),e.jsxs(t,{variant:"outline-primary",size:"sm",disabled:m.length<d,onClick:()=>c(o+1),children:["Next",e.jsx("i",{className:"mdi mdi-chevron-right ms-1"})]})]})})})]})]})})})}),e.jsx(ae,{show:p,onHide:()=>x(!1),onSuccess:I}),g&&e.jsx(Q,{show:!!g,user:g,onHide:()=>v(null),onSuccess:O})]})},we=()=>e.jsx(te,{});export{Pe as UserDetail,we as default};
