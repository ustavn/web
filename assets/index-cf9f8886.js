import{w as N,aZ as w,r as m,j as e,P as I,d as f,f as x,h as v,v as a,aW as g}from"./index-19058953.js";import{u as F}from"./useQuery-91264e7b.js";import{u as k}from"./useMutation-8b5569a6.js";import{B as j}from"./Button-1b1b97a4.js";import{A as C}from"./Alert-012adcc8.js";import{S as E}from"./Spinner-33b1e258.js";import{T as P}from"./Table-4c1e163b.js";import{M as d}from"./Modal-962eaba5.js";const B="https://api.dev.usta.vn",h=N.create({baseURL:`${B}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});h.interceptors.request.use(async s=>{const r=localStorage.getItem("_USTA_OAUTH");if(r)try{const n=JSON.parse(r);s.headers.Authorization=`Bearer ${n.accessToken}`}catch(n){console.error("[Shift Schedule API] Failed to parse OAuth session:",n)}return s},s=>Promise.reject(s));h.interceptors.response.use(s=>s,s=>{var r;return console.error("[Shift Schedule API] Response error:",((r=s.response)==null?void 0:r.data)||s.message),Promise.reject(s)});async function L(s={}){const r=await h.get("/shift-schedules/",{params:s});if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to fetch shift schedules")}async function M(s){const r=await h.post("/shift-schedules/",s);if(r.data.success)return r.data.data;throw new Error(r.data.error||"Failed to create shift schedule")}function D(s={}){return F({queryKey:["shift-schedules",s],queryFn:()=>L(s),staleTime:3e4,retry:2,select:r=>r||[]})}function q(){const s=w();return k({mutationFn:r=>M(r),onSuccess:()=>{s.invalidateQueries({queryKey:["shift-schedules"]})}})}const U=()=>{var S;const[s,r]=m.useState(""),[n,l]=m.useState(!1),[i,o]=m.useState({providerId:"",name:"",timeZone:"SE Asia Standard Time",isActive:!0}),{data:y=[],isLoading:A,error:p}=D(),c=q(),u=y.filter(t=>t.name.toLowerCase().includes(s.toLowerCase())||t.providerId.toLowerCase().includes(s.toLowerCase())),b=async t=>{t.preventDefault();try{await c.mutateAsync(i),l(!1),o({providerId:"",name:"",timeZone:"SE Asia Standard Time",isActive:!0})}catch(T){console.error("Failed to create shift schedule:",T)}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Shift Schedule Management",subName:"Apps"}),e.jsx(f,{children:e.jsx(x,{xs:12,children:e.jsx(v,{children:e.jsxs(v.Body,{children:[e.jsxs(f,{className:"mb-3",children:[e.jsx(x,{md:6,children:e.jsx(a.Control,{type:"text",placeholder:"Search by name or provider ID...",value:s,onChange:t=>r(t.target.value)})}),e.jsx(x,{md:6,className:"text-end",children:e.jsxs(j,{variant:"primary",onClick:()=>l(!0),children:[e.jsx("i",{className:"uil uil-plus me-1"})," Create Shift Schedule"]})})]}),p&&e.jsxs(C,{variant:"danger",dismissible:!0,children:["Failed to load shift schedules: ",p.message]}),A?e.jsx("div",{className:"text-center py-5",children:e.jsx(E,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("h5",{children:["Total Schedules: ",u.length]})}),e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Provider ID"}),e.jsx("th",{children:"Time Zone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-4 text-muted",children:"No shift schedules found"})}):u.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:t.name})}),e.jsx("td",{children:e.jsx("code",{children:t.providerId})}),e.jsx("td",{children:t.timeZone}),e.jsx("td",{children:t.isActive?e.jsx(g,{bg:"success",children:"Active"}):e.jsx(g,{bg:"secondary",children:"Inactive"})}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString("vi-VN")})]},t.id))})]})]})]})})})}),e.jsxs(d,{show:n,onHide:()=>l(!1),children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:"Create Shift Schedule"})}),e.jsxs(a,{onSubmit:b,children:[e.jsxs(d.Body,{children:[c.isError&&e.jsxs(C,{variant:"danger",dismissible:!0,children:["Failed to create shift schedule: ",(S=c.error)==null?void 0:S.message]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Schedule Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Morning Shift",value:i.name,onChange:t=>o({...i,name:t.target.value}),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Provider ID *"}),e.jsx(a.Control,{type:"text",placeholder:"d290f1ee-6c54-4b01-90e6-d701748f0851",value:i.providerId,onChange:t=>o({...i,providerId:t.target.value}),required:!0}),e.jsx(a.Text,{className:"text-muted",children:"UUID of the provider/organization"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Time Zone *"}),e.jsxs(a.Select,{value:i.timeZone,onChange:t=>o({...i,timeZone:t.target.value}),required:!0,children:[e.jsx("option",{value:"SE Asia Standard Time",children:"SE Asia Standard Time (UTC+7)"}),e.jsx("option",{value:"UTC",children:"UTC"}),e.jsx("option",{value:"Asia/Ho_Chi_Minh",children:"Asia/Ho Chi Minh"}),e.jsx("option",{value:"Asia/Bangkok",children:"Asia/Bangkok"}),e.jsx("option",{value:"Asia/Singapore",children:"Asia/Singapore"})]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Check,{type:"checkbox",label:"Active",checked:i.isActive,onChange:t=>o({...i,isActive:t.target.checked})}),e.jsx(a.Text,{className:"text-muted",children:"Whether this shift schedule is currently active"})]})]}),e.jsxs(d.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:()=>l(!1),children:"Cancel"}),e.jsx(j,{variant:"primary",type:"submit",disabled:c.isPending,children:c.isPending?"Creating...":"Create Schedule"})]})]})]})]})},K=()=>e.jsx(U,{});export{K as default};
