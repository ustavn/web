import{r as p,z as pe,j as e,l as he,L as fe,P as je,d as R,f as w,h as W,aa as be}from"./index-64b55cb4.js";import{_ as Ce,a as le,b as ae,v as Ne,d as ce,g as ye,e as Ie,u as Se,f as Ve,S as de}from"./react-select.esm-b46f0e70.js";import{_ as we}from"./hook-faf4790a.js";import{u as De,C as Le}from"./index.esm-cc7be65c.js";import{a as ge,F as o}from"./Form-af4b6af5.js";import{I as Ae}from"./InputGroupContext-bd77741c.js";import{F as Ee}from"./FileUploader-8b59ff4d.js";import{u as Ge,a as Oe,b as $e,c as Pe}from"./useProducts-a551400b.js";import{u as Ue}from"./useCategories-8195f053.js";import{B as D}from"./Badge-114e085a.js";import{B}from"./Button-fd762df4.js";import{A as Be}from"./Alert-f161e921.js";import{S as ue}from"./Spinner-a1d2bbfc.js";import{M as K}from"./Modal-0ade13d1.js";import"./ElementChildren-3d5bbd53.js";import"./useQuery-419e495e.js";import"./useMutation-b6c6e57b.js";import"./AbstractModalHeader-f1d869ae.js";import"./useWindow-7982fea9.js";import"./hasClass-d3812cb5.js";import"./useMergedRefs-9644369a.js";import"./DataKey-e12315fd.js";const xe=p.forwardRef(({className:s,bsPrefix:i,as:r="span",...d},u)=>(i=pe(i,"input-group-text"),e.jsx(r,{ref:u,className:he(s,i),...d})));xe.displayName="InputGroupText";const ie=xe,Fe=s=>e.jsx(ie,{children:e.jsx(ge,{type:"checkbox",...s})}),ke=s=>e.jsx(ie,{children:e.jsx(ge,{type:"radio",...s})}),ve=p.forwardRef(({bsPrefix:s,size:i,hasValidation:r,className:d,as:u="div",...h},m)=>{s=pe(s,"input-group");const I=p.useMemo(()=>({}),[]);return e.jsx(Ae.Provider,{value:I,children:e.jsx(u,{ref:m,...h,className:he(d,s,i&&`${s}-${i}`,r&&"has-validation")})})});ve.displayName="InputGroup";const Z=Object.assign(ve,{Text:ie,Radio:ke,Checkbox:Fe}),ee=(s,i="USD")=>{if(s==null||s==="")return"";const r=typeof s=="string"?parseFloat(s.replace(/[^\d.-]/g,"")):s;return isNaN(r)?"":i==="VND"?r.toLocaleString("vi-VN",{minimumFractionDigits:0,maximumFractionDigits:0}):r.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},ne=(s,i="USD")=>{const r=s.replace(/[^\d.-]/g,"");if(i==="VND"){const u=parseInt(r,10);return isNaN(u)?0:u}const d=parseFloat(r);return isNaN(d)?0:d},Te=(s="USD",i)=>i||(s==="VND"?"₫":s==="USD"?"$":s),Me=({id:s,className:i,containerClass:r,label:d,placeholder:u,helpText:h,required:m,symbol:I,currency:L,defaultPlaceholder:G,field:g,fieldState:f,...S})=>{var O;const[x,A]=p.useState(!1),[j,C]=p.useState("");return p.useEffect(()=>{x||C(ee(g.value,L))},[g.value,L,x]),e.jsxs(o.Group,{className:r??"",children:[d&&e.jsx(o.Label,{children:d}),e.jsxs(Z,{children:[e.jsx(Z.Text,{children:I}),e.jsx(o.Control,{id:s,type:"text",...S,value:x?j:ee(g.value,L),onFocus:V=>{A(!0);const b=g.value??"";C(b.toString())},onChange:V=>{const b=V.target.value;C(b);const N=ne(b,L);g.onChange(N)},onBlur:V=>{A(!1);const b=ne(V.target.value,L);g.onChange(b)},placeholder:u||G,className:i,isInvalid:!!((O=f.error)!=null&&O.message),required:m})]}),h&&e.jsx(o.Text,{id:`${g.name}-help`,muted:!0,children:h}),f.error&&e.jsx(o.Control.Feedback,{type:"invalid",children:f.error.message})]})};function te({name:s,id:i,className:r,containerClass:d,label:u,placeholder:h,helpText:m,errors:I,register:L,required:G,currencySymbol:g,currency:f="USD",value:S,onChange:x,...A}){const[j,C]=p.useState(""),[O,V]=p.useState(!1),b=Te(f,g),N=f==="VND"?"0":"0.00",H=De(),F=!!H&&!!s;if(p.useEffect(()=>{!F&&!O&&C(ee(S,f))},[S,f,F,O]),F&&s){const{control:U}=H;return e.jsx(Le,{name:s,control:U,render:({field:y,fieldState:E})=>e.jsx(Me,{id:i,className:r,containerClass:d,label:u,placeholder:h,helpText:m,required:G,symbol:b,currency:f,defaultPlaceholder:N,field:y,fieldState:E,...A})})}const k=U=>{V(!0);const y=S??"";C(y.toString()),U.target.value=y.toString()},$=U=>{const y=U.target.value;C(y);const E=ne(y,f);x==null||x(E)},P=()=>{V(!1),C(ee(S,f))};return e.jsxs(o.Group,{className:d??"",children:[u&&e.jsx(o.Label,{children:u}),e.jsxs(Z,{children:[e.jsx(Z.Text,{children:b}),e.jsx(o.Control,{id:i,type:"text",...A,value:j,onFocus:k,onChange:$,onBlur:P,placeholder:h||N,className:r,required:G})]}),m&&e.jsx(o.Text,{id:i?`${i}-help`:"money-help",muted:!0,children:m})]})}var _e=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],me=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0,u=String(i).toLowerCase(),h=String(d.getOptionValue(r)).toLowerCase(),m=String(d.getOptionLabel(r)).toLowerCase();return h===u||m===u},se={formatCreateLabel:function(i){return'Create "'.concat(i,'"')},isValidNewOption:function(i,r,d,u){return!(!i||r.some(function(h){return me(i,h,u)})||d.some(function(h){return me(i,h,u)}))},getNewOptionData:function(i,r){return{label:r,value:i,__isNew__:!0}}};function Re(s){var i=s.allowCreateWhileLoading,r=i===void 0?!1:i,d=s.createOptionPosition,u=d===void 0?"last":d,h=s.formatCreateLabel,m=h===void 0?se.formatCreateLabel:h,I=s.isValidNewOption,L=I===void 0?se.isValidNewOption:I,G=s.getNewOptionData,g=G===void 0?se.getNewOptionData:G,f=s.onCreateOption,S=s.options,x=S===void 0?[]:S,A=s.onChange,j=Ce(s,_e),C=j.getOptionValue,O=C===void 0?ye:C,V=j.getOptionLabel,b=V===void 0?Ie:V,N=j.inputValue,H=j.isLoading,F=j.isMulti,k=j.value,$=j.name,P=p.useMemo(function(){return L(N,le(k),x,{getOptionValue:O,getOptionLabel:b})?g(N,m(N)):void 0},[m,g,b,O,N,L,x,k]),U=p.useMemo(function(){return(r||!H)&&P?u==="first"?[P].concat(ae(x)):[].concat(ae(x),[P]):x},[r,u,H,P,x]),y=p.useCallback(function(E,T){if(T.action!=="select-option")return A(E,T);var X=Array.isArray(E)?E:[E];if(X[X.length-1]===P){if(f)f(N);else{var Y=g(N,N),Q={action:"create-option",name:$,option:Y};A(Ne(F,[].concat(ae(le(k)),[Y]),Y),Q)}return}A(E,T)},[g,N,F,$,P,f,A,k]);return ce(ce({},j),{},{options:U,onChange:y})}var He=p.forwardRef(function(s,i){var r=Se(s),d=Re(r);return p.createElement(Ve,we({ref:i},d))}),re=He;const ze=[{Header:"ID",accessor:"id",defaultCanSort:!1,Cell:({value:s})=>e.jsxs("small",{className:"text-muted",children:[s.substring(0,8),"..."]})},{Header:"Name",accessor:"name",defaultCanSort:!0,Cell:({value:s})=>e.jsx("strong",{children:s})},{Header:"Type",accessor:"type",defaultCanSort:!0,Cell:({value:s})=>{switch(s){case 1:return e.jsx(D,{bg:"primary",children:"Service"});case 2:return e.jsx(D,{bg:"info",children:"Variant"});case 3:return e.jsx(D,{bg:"success",children:"Addon"});default:return e.jsx(D,{bg:"secondary",children:"Unknown"})}}},{Header:"Price",accessor:"price",defaultCanSort:!0,Cell:({value:s})=>{const i=s.toLocaleString("vi-VN",{minimumFractionDigits:0,maximumFractionDigits:0});return e.jsxs("span",{children:["₫",i]})}},{Header:"Duration",accessor:"duration",defaultCanSort:!0,Cell:({value:s})=>`${s} min`},{Header:"Category ID",accessor:"categoryId",defaultCanSort:!1,Cell:({value:s})=>e.jsxs("small",{className:"text-muted",children:[s.substring(0,8),"..."]})},{Header:"Level Code",accessor:"categoryLevelCode",defaultCanSort:!1,Cell:({value:s})=>e.jsx(D,{bg:"info",children:s})},{Header:"Description",accessor:"description",defaultCanSort:!1,Cell:({value:s})=>e.jsx("span",{className:"text-muted",children:s})},{Header:"Created At",accessor:"createdAt",defaultCanSort:!0,Cell:({value:s})=>new Date(s).toLocaleDateString()},{Header:"Actions",id:"actions",accessor:"id",defaultCanSort:!1,Cell:({value:s})=>e.jsx(fe,{to:`/apps/products/${s}`,children:e.jsxs(B,{variant:"outline-primary",size:"sm",children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"View"]})})}],q=[{value:15,label:"15 minutes"},{value:30,label:"30 minutes"},{value:45,label:"45 minutes"},{value:60,label:"1 hour"},{value:90,label:"1.5 hours"},{value:120,label:"2 hours"},{value:180,label:"3 hours"},{value:240,label:"4 hours"},{value:300,label:"5 hours"}],We=[{text:"10",value:10},{text:"25",value:25},{text:"50",value:50}],qe=()=>{const[s,i]=p.useState(!1),[r,d]=p.useState({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""}),[u,h]=p.useState([]),[m,I]=p.useState([]),[L,G]=p.useState([]),{data:g,isLoading:f,error:S}=Ge(),{data:x,isLoading:A}=Ue(),j=Oe(),C=$e(),O=Pe(),V=p.useMemo(()=>g?g.filter(t=>t.type===2):[],[g]),b=p.useMemo(()=>x?x.map(t=>({value:t.id,label:`${t.levelCode} - ${t.name}`})):[],[x]),N=p.useMemo(()=>r.categoryId&&b.find(t=>t.value===r.categoryId)||null,[r.categoryId,b]),H=t=>{if(t){const n=x==null?void 0:x.find(a=>a.id===t.value);n&&d({...r,categoryId:n.id,categoryLevelCode:n.levelCode})}else d({...r,categoryId:"",categoryLevelCode:""})},F=()=>{h([...u,{name:"",price:0,duration:0,description:""}])},k=t=>{h(u.filter((n,a)=>a!==t))},$=(t,n,a)=>{const c=[...u];c[t]={...c[t],[n]:a},h(c)},P=()=>{I([...m,{name:"",price:0,duration:0,description:"",variantIndices:[],existingVariantIds:[]}])},U=t=>{I(m.filter((n,a)=>a!==t))},y=(t,n,a)=>{I(c=>{const l=[...c];return l[t]={...l[t],[n]:a},l})},E=(t,n,a)=>{console.log("[DEBUG] updateAddonVariants called:",{index:t,variantIndices:n,existingVariantIds:a,currentAddonsState:m}),I(c=>{const l=[...c];return l[t]={...l[t],variantIndices:n,existingVariantIds:a},console.log("[DEBUG] updateAddonVariants - new state:",{index:t,updatedAddon:l[t],allAddons:l}),l})};p.useEffect(()=>{console.log("[DEBUG] Addons state changed:",{addons:m,addonsWithVariants:m.map((t,n)=>({index:n,name:t.name,variantIndices:t.variantIndices,existingVariantIds:t.existingVariantIds}))})},[m]);const T=p.useMemo(()=>{const t=u.map((c,l)=>({value:`new_${l}`,label:c.name||`New Variant ${l+1}`,isNew:!0,index:l})),n=V.map(c=>({value:`existing_${c.id}`,label:c.name,isNew:!1,id:c.id})),a=[];return t.length>0&&a.push({label:`New Variants (${t.length})`,options:t}),n.length>0&&a.push({label:`Existing Variants (${n.length})`,options:n}),a.length>0?a:[]},[u,V]),X=()=>{d({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""}),h([]),I([]),G([])},Y=async t=>{t.preventDefault(),console.log("[DEBUG] Form submission started. Current addons state:",{addons:m,addonsCount:m.length,addonsWithVariants:m.map((n,a)=>({index:a,name:n.name,variantIndices:n.variantIndices,existingVariantIds:n.existingVariantIds}))});try{const n={...r,type:1},a=await j.mutateAsync(n);L.length>0&&await O.mutateAsync({productId:a.id,images:L});const c=[];for(const l of u){const M={...r,...l,type:2},v=await j.mutateAsync(M);c.push(v.id),console.log("[DEBUG] Created Variant:",{variantId:v.id,variantName:v.name,serviceId:a.id});const _={productId:a.id,productReferenceId:v.id};console.log("[DEBUG] Linking Variant to Service:",_),await C.mutateAsync(_),console.log("[DEBUG] Successfully linked Variant to Service")}for(const l of m){const M={...r,name:l.name,price:l.price,duration:l.duration,description:l.description,type:3},v=await j.mutateAsync(M);console.log("[DEBUG] Created Addon:",{addonId:v.id,addonName:v.name,serviceId:a.id,variantIndices:l.variantIndices,existingVariantIds:l.existingVariantIds,allVariantIds:c}),console.log("[DEBUG] Skipping addon-service link. Addons only link to variants."),console.log("[DEBUG] Linking Variant to Addon (NEW). Count:",l.variantIndices.length);for(const _ of l.variantIndices){const z=c[_];if(console.log("[DEBUG] Processing variant index:",{variantIndex:_,variantId:z,variantIdsArray:c}),z){const J={productId:z,productReferenceId:v.id};console.log("[DEBUG] Linking Variant to Addon (NEW):",J);try{await C.mutateAsync(J),console.log("[DEBUG] Successfully linked Variant to Addon (NEW)")}catch(oe){throw console.error("[DEBUG] Failed to link Variant to Addon (NEW):",oe),oe}}else console.warn("[DEBUG] Variant ID not found for index:",_)}console.log("[DEBUG] Linking Variant to Addon (EXISTING). Count:",l.existingVariantIds.length);for(const _ of l.existingVariantIds){const z={productId:_,productReferenceId:v.id};console.log("[DEBUG] Linking Variant to Addon (EXISTING):",z);try{await C.mutateAsync(z),console.log("[DEBUG] Successfully linked Variant to Addon (EXISTING)")}catch(J){throw console.error("[DEBUG] Failed to link Variant to Addon (EXISTING):",J),J}}}X(),i(!1)}catch{}},Q=()=>{X(),i(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(je,{title:"Products",subName:"Apps"}),e.jsx(R,{children:e.jsx(w,{xs:12,children:e.jsx(W,{children:e.jsxs(W.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h4",{className:"header-title",children:"Products List"}),e.jsxs(B,{variant:"primary",onClick:()=>i(!0),children:[e.jsx("i",{className:"mdi mdi-plus-circle me-1"}),"Create Product"]})]}),S&&e.jsxs(Be,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",S instanceof Error?S.message:"Failed to load products"]}),f?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(ue,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading products..."})]}):g&&g.length>0?e.jsx(be,{columns:ze,data:g,pageSize:10,sizePerPageList:We,isSortable:!0,pagination:!0,isSearchable:!0}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No products found"}),e.jsx(B,{variant:"primary",onClick:()=>i(!0),children:"Create First Product"})]})]})})})}),e.jsxs(K,{show:s,onHide:Q,size:"xl",scrollable:!0,centered:!0,children:[e.jsx(K.Header,{closeButton:!0,children:e.jsx(K.Title,{children:"Create New Product (Service + Variants + Addons)"})}),e.jsxs(o,{onSubmit:Y,children:[e.jsxs(K.Body,{style:{maxHeight:"70vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs(R,{children:[e.jsx(w,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Service Name *"}),e.jsx(o.Control,{type:"text",placeholder:"Enter service name",value:r.name,onChange:t=>d({...r,name:t.target.value}),required:!0})]})}),e.jsx(w,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Category *"}),e.jsx(de,{className:"react-select",classNamePrefix:"react-select",options:b,value:N,onChange:H,placeholder:"Select a category",isDisabled:A,isClearable:!0,isSearchable:!0}),r.categoryLevelCode&&e.jsxs(o.Text,{className:"text-muted d-block mt-1",children:["Level Code: ",e.jsx("strong",{children:r.categoryLevelCode})]})]})})]}),e.jsxs(R,{children:[e.jsx(w,{md:6,children:e.jsx(te,{label:"Price *",placeholder:"0",currency:"VND",value:r.price,onChange:t=>d({...r,price:t}),required:!0,containerClass:"mb-3"})}),e.jsx(w,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Duration (minutes) *"}),e.jsx(re,{className:"react-select",classNamePrefix:"react-select",options:q,value:r.duration?q.find(t=>t.value===r.duration)||{value:r.duration,label:`${r.duration} minutes`}:null,onChange:t=>{const n=t?typeof t.value=="number"?t.value:parseInt(t.value):0;d({...r,duration:n})},onCreateOption:t=>{const n=parseInt(t)||0;d({...r,duration:n})},placeholder:"Select or enter duration...",isClearable:!1,formatCreateLabel:t=>`Use ${t} minutes`,required:!0})]})})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Description *"}),e.jsx(o.Control,{as:"textarea",rows:3,placeholder:"Enter service description",value:r.description,onChange:t=>d({...r,description:t.target.value}),required:!0})]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"mb-0 d-inline me-3",children:[e.jsx(D,{bg:"info",className:"me-2",children:"2"}),"Variants (Type 2)"]}),e.jsxs("h5",{className:"mb-0 d-inline",children:[e.jsx(D,{bg:"success",className:"me-2",children:"3"}),"Addons (Type 3)"]})]}),e.jsxs("div",{children:[e.jsxs(B,{variant:"outline-primary",size:"sm",onClick:F,className:"me-2",children:[e.jsx("i",{className:"mdi mdi-plus me-1"})," Add Variant"]}),e.jsxs(B,{variant:"outline-success",size:"sm",onClick:P,children:[e.jsx("i",{className:"mdi mdi-plus me-1"})," Add Addon"]})]})]}),u.length===0&&m.length===0?e.jsx("p",{className:"text-muted",children:'No variants or addons added. Click "Add Variant" or "Add Addon" to add one.'}):e.jsxs(R,{className:"g-3",children:[u.map((t,n)=>e.jsx(w,{xs:12,md:6,children:e.jsx(W,{className:"h-100 border-info",children:e.jsxs(W.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(D,{bg:"info",className:"me-2",children:"Variant"}),"Variant ",n+1]}),e.jsx(B,{variant:"outline-danger",size:"sm",onClick:()=>k(n),children:e.jsx("i",{className:"mdi mdi-close"})})]}),e.jsx(R,{children:e.jsx(w,{md:12,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Variant Name *"}),e.jsx(o.Control,{type:"text",placeholder:"Enter variant name",value:t.name,onChange:a=>$(n,"name",a.target.value),required:!0})]})})}),e.jsxs(R,{children:[e.jsx(w,{md:6,children:e.jsx(te,{label:"Price *",placeholder:"0",currency:"VND",value:t.price,onChange:a=>$(n,"price",a),required:!0,containerClass:"mb-3"})}),e.jsx(w,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Duration (min) *"}),e.jsx(re,{className:"react-select",classNamePrefix:"react-select",options:q,value:t.duration?q.find(a=>a.value===t.duration)||{value:t.duration,label:`${t.duration} minutes`}:null,onChange:a=>{const c=a?typeof a.value=="number"?a.value:parseInt(a.value):0;$(n,"duration",c)},onCreateOption:a=>{const c=parseInt(a)||0;$(n,"duration",c)},placeholder:"Select or enter duration...",isClearable:!1,formatCreateLabel:a=>`Use ${a} minutes`})]})})]}),e.jsxs(o.Group,{className:"mb-0",children:[e.jsx(o.Label,{children:"Description *"}),e.jsx(o.Control,{as:"textarea",rows:2,placeholder:"Enter variant description",value:t.description,onChange:a=>$(n,"description",a.target.value),required:!0})]})]})})},`variant-${n}`)),m.map((t,n)=>e.jsx(w,{xs:12,md:6,children:e.jsx(W,{className:"h-100 border-success",children:e.jsxs(W.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(D,{bg:"success",className:"me-2",children:"Addon"}),"Addon ",n+1]}),e.jsx(B,{variant:"outline-danger",size:"sm",onClick:()=>U(n),children:e.jsx("i",{className:"mdi mdi-close"})})]}),e.jsx(R,{children:e.jsx(w,{md:12,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Addon Name *"}),e.jsx(o.Control,{type:"text",placeholder:"Enter addon name",value:t.name,onChange:a=>y(n,"name",a.target.value),required:!0})]})})}),e.jsxs(R,{children:[e.jsx(w,{md:6,children:e.jsx(te,{label:"Price *",placeholder:"0",currency:"VND",value:t.price,onChange:a=>y(n,"price",a),required:!0,containerClass:"mb-3"})}),e.jsx(w,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Duration (min) *"}),e.jsx(re,{className:"react-select",classNamePrefix:"react-select",options:q,value:t.duration?q.find(a=>a.value===t.duration)||{value:t.duration,label:`${t.duration} minutes`}:null,onChange:a=>{const c=a?typeof a.value=="number"?a.value:parseInt(a.value):0;y(n,"duration",c)},onCreateOption:a=>{const c=parseInt(a)||0;y(n,"duration",c)},placeholder:"Select or enter duration...",isClearable:!1,formatCreateLabel:a=>`Use ${a} minutes`})]})})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Link to Variants (Optional)"}),e.jsx(de,{isMulti:!0,className:"react-select",classNamePrefix:"react-select",options:T,value:(()=>{const a=[];return T.forEach(c=>{c.options&&c.options.forEach(l=>{(l.isNew&&t.variantIndices.includes(l.index)||!l.isNew&&t.existingVariantIds.includes(l.id))&&a.push(l)})}),a})(),getOptionValue:a=>a.isNew?`new_${a.index}`:`existing_${a.id}`,formatGroupLabel:a=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-bold",children:a.label}),e.jsx(D,{bg:a.label.includes("New")?"info":"secondary",className:"ms-2",children:a.options.length})]}),formatOptionLabel:(a,{context:c})=>c==="value"?a.label:e.jsxs("div",{className:"d-flex align-items-center",children:[a.isNew&&e.jsx(D,{bg:"info",className:"me-2",style:{fontSize:"0.7rem"},children:"New"}),!a.isNew&&e.jsx(D,{bg:"secondary",className:"me-2",style:{fontSize:"0.7rem"},children:"Existing"}),e.jsx("span",{children:a.label})]}),onChange:a=>{console.log("[DEBUG] Variant Selection onChange triggered:",{addonIndex:n,selected:a,selectedType:Array.isArray(a)?"array":typeof a,selectedLength:Array.isArray(a)?a.length:"not array"});const c=[],l=[];if(a){const M=Array.isArray(a)?a:[a];console.log("[DEBUG] Processing selected variants:",{selectedArray:M,count:M.length}),M.forEach(v=>{console.log("[DEBUG] Processing option:",{option:v,isNew:v.isNew,index:v.index,id:v.id}),v.isNew?c.push(v.index):l.push(v.id)})}console.log("[DEBUG] Updating addon with:",{addonIndex:n,variantIndices:c,existingVariantIds:l}),E(n,c,l),console.log("[DEBUG] State update called for addon variants")},placeholder:"Search and select variants...",isSearchable:!0,isClearable:!0,isDisabled:T.length===0,isLoading:f,noOptionsMessage:({inputValue:a})=>a?`No variants found matching "${a}"`:"No variants available. Add new variants above or create variants first.",filterOption:(a,c)=>{var v;if(!c)return!0;const l=c.toLowerCase();return(((v=a.label)==null?void 0:v.toLowerCase())||"").includes(l)}}),e.jsx(o.Text,{className:"text-muted",children:T.length===0?"No variants available. Add new variants above or create variants first.":"Search and select variants from new ones being created or existing ones from the database. You can select multiple variants."})]}),e.jsxs(o.Group,{className:"mb-0",children:[e.jsx(o.Label,{children:"Description *"}),e.jsx(o.Control,{as:"textarea",rows:2,placeholder:"Enter addon description",value:t.description,onChange:a=>y(n,"description",a.target.value),required:!0})]})]})})},`addon-${n}`))]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(D,{bg:"secondary",className:"me-2",children:"Images"}),"Product Images (Optional)"]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(Ee,{showPreview:!0,onFileUpload:t=>G(t)}),e.jsx(o.Text,{className:"text-muted",children:"Upload multiple images for this product. Images will be associated with the service."})]})]})]}),e.jsxs(K.Footer,{children:[e.jsx(B,{variant:"secondary",onClick:Q,children:"Cancel"}),e.jsx(B,{variant:"primary",type:"submit",disabled:j.isPending,children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ue,{animation:"border",size:"sm",className:"me-2"}),"Creating..."]}):"Create Product"})]})]})]})]})},xa=()=>e.jsx(qe,{});export{xa as default};
