import{j as e,r as p,P as U,d as b,f as c,h as v,X}from"./index-7abc2e1c.js";import{S as G}from"./react-select.esm-b8c596d8.js";import{u as J,a as K}from"./useProducts-4c9cc6dd.js";import{u as Q}from"./useCategories-5c3ef674.js";import{B as u}from"./Badge-f7a378fe.js";import{B as m}from"./Button-98115848.js";import{A as W}from"./Alert-970a7765.js";import{S as q}from"./Spinner-f490c646.js";import{M as y}from"./Modal-d1b37a71.js";import{F as a}from"./Form-3dd09149.js";import"./hook-87ee9a06.js";import"./useQuery-fef0428f.js";import"./useMutation-04d1b243.js";import"./AbstractModalHeader-b51e44f5.js";import"./useWindow-25e16477.js";import"./hasClass-d6dc9e47.js";import"./useMergedRefs-c0c7f279.js";import"./DataKey-e12315fd.js";import"./FormControl-92329ab5.js";import"./ElementChildren-dbbb72ab.js";const Y=[{Header:"ID",accessor:"id",defaultCanSort:!1,Cell:({value:n})=>e.jsxs("small",{className:"text-muted",children:[n.substring(0,8),"..."]})},{Header:"Name",accessor:"name",defaultCanSort:!0,Cell:({value:n})=>e.jsx("strong",{children:n})},{Header:"Type",accessor:"type",defaultCanSort:!0,Cell:({value:n})=>{switch(n){case 1:return e.jsx(u,{bg:"primary",children:"Service"});case 2:return e.jsx(u,{bg:"info",children:"Variant"});case 3:return e.jsx(u,{bg:"success",children:"Addon"});default:return e.jsx(u,{bg:"secondary",children:"Unknown"})}}},{Header:"Price",accessor:"price",defaultCanSort:!0,Cell:({value:n})=>`$${n.toFixed(2)}`},{Header:"Duration",accessor:"duration",defaultCanSort:!0,Cell:({value:n})=>`${n} days`},{Header:"Category ID",accessor:"categoryId",defaultCanSort:!1,Cell:({value:n})=>e.jsxs("small",{className:"text-muted",children:[n.substring(0,8),"..."]})},{Header:"Level Code",accessor:"categoryLevelCode",defaultCanSort:!1,Cell:({value:n})=>e.jsx(u,{bg:"info",children:n})},{Header:"Description",accessor:"description",defaultCanSort:!1,Cell:({value:n})=>e.jsx("span",{className:"text-muted",children:n})},{Header:"Created At",accessor:"createdAt",defaultCanSort:!0,Cell:({value:n})=>new Date(n).toLocaleDateString()}],Z=[{text:"10",value:10},{text:"25",value:25},{text:"50",value:50}],ee=()=>{const[n,N]=p.useState(!1),[i,h]=p.useState({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""}),[d,f]=p.useState([]),[x,S]=p.useState([]),{data:I,isLoading:H,error:P}=J(),{data:j,isLoading:B}=Q(),g=K(),w=p.useMemo(()=>j?j.map(s=>({value:s.id,label:`${s.levelCode} - ${s.name}`})):[],[j]),M=p.useMemo(()=>i.categoryId&&w.find(s=>s.value===i.categoryId)||null,[i.categoryId,w]),E=s=>{if(s){const r=j==null?void 0:j.find(t=>t.id===s.value);r&&h({...i,categoryId:r.id,categoryLevelCode:r.levelCode})}else h({...i,categoryId:"",categoryLevelCode:""})},z=()=>{f([...d,{name:"",price:0,duration:0,description:""}])},T=s=>{f(d.filter((r,t)=>t!==s))},L=(s,r,t)=>{const l=[...d];l[s]={...l[s],[r]:t},f(l)},$=()=>{S([...x,{name:"",price:0,duration:0,description:"",variantIndices:[]}])},O=s=>{S(x.filter((r,t)=>t!==s))},C=(s,r,t)=>{const l=[...x];l[s]={...l[s],[r]:t},S(l)},k=p.useMemo(()=>d.map((s,r)=>({value:r,label:s.name||`Variant ${r+1}`})),[d]),F=()=>{h({categoryId:"",categoryLevelCode:"",name:"",price:0,duration:0,description:""}),f([]),S([])},R=async s=>{s.preventDefault();try{const r={...i,type:1},t=await g.mutateAsync(r),l=[];for(const o of d){const A={...i,...o,type:2,parentId:t.id},D=await g.mutateAsync(A);l.push(D.id)}for(const o of x){const A=o.variantIndices.map(_=>l[_]).filter(Boolean),D={...i,name:o.name,price:o.price,duration:o.duration,description:o.description,type:3,parentId:t.id,variantIds:A.length>0?A:void 0};await g.mutateAsync(D)}F(),N(!1)}catch(r){console.error("Failed to create product:",r)}},V=()=>{F(),N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Products",subName:"Apps"}),e.jsx(b,{children:e.jsx(c,{xs:12,children:e.jsx(v,{children:e.jsxs(v.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h4",{className:"header-title",children:"Products List"}),e.jsxs(m,{variant:"primary",onClick:()=>N(!0),children:[e.jsx("i",{className:"mdi mdi-plus-circle me-1"}),"Create Product"]})]}),P&&e.jsxs(W,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",P instanceof Error?P.message:"Failed to load products"]}),H?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(q,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading products..."})]}):I&&I.length>0?e.jsx(X,{columns:Y,data:I,pageSize:10,sizePerPageList:Z,isSortable:!0,pagination:!0,isSearchable:!0}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No products found"}),e.jsx(m,{variant:"primary",onClick:()=>N(!0),children:"Create First Product"})]})]})})})}),e.jsxs(y,{show:n,onHide:V,size:"xl",scrollable:!0,children:[e.jsx(y.Header,{closeButton:!0,children:e.jsx(y.Title,{children:"Create New Product (Service + Variants + Addons)"})}),e.jsxs(a,{onSubmit:R,children:[e.jsxs(y.Body,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx(u,{bg:"primary",className:"me-2",children:"1"}),"Service (Type 1 - Highest Level)"]}),e.jsxs(b,{children:[e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Service Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Enter service name",value:i.name,onChange:s=>h({...i,name:s.target.value}),required:!0})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Category *"}),e.jsx(G,{className:"react-select",classNamePrefix:"react-select",options:w,value:M,onChange:E,placeholder:"Select a category",isDisabled:B,isClearable:!0,isSearchable:!0}),i.categoryLevelCode&&e.jsxs(a.Text,{className:"text-muted d-block mt-1",children:["Level Code: ",e.jsx("strong",{children:i.categoryLevelCode})]})]})})]}),e.jsxs(b,{children:[e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Price *"}),e.jsx(a.Control,{type:"number",step:"0.01",placeholder:"0.00",value:i.price,onChange:s=>h({...i,price:parseFloat(s.target.value)||0}),required:!0})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Duration (minutes) *"}),e.jsx(a.Control,{type:"number",placeholder:"30",value:i.duration,onChange:s=>h({...i,duration:parseInt(s.target.value)||0}),required:!0})]})})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Description *"}),e.jsx(a.Control,{as:"textarea",rows:3,placeholder:"Enter service description",value:i.description,onChange:s=>h({...i,description:s.target.value}),required:!0})]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(u,{bg:"info",className:"me-2",children:"2"}),"Variants (Type 2)"]}),e.jsxs(m,{variant:"outline-primary",size:"sm",onClick:z,children:[e.jsx("i",{className:"mdi mdi-plus me-1"})," Add Variant"]})]}),d.length===0?e.jsx("p",{className:"text-muted",children:'No variants added. Click "Add Variant" to add one.'}):d.map((s,r)=>e.jsx(v,{className:"mb-3",children:e.jsxs(v.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:["Variant ",r+1]}),e.jsx(m,{variant:"outline-danger",size:"sm",onClick:()=>T(r),children:e.jsx("i",{className:"mdi mdi-close"})})]}),e.jsxs(b,{children:[e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Variant Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Enter variant name",value:s.name,onChange:t=>L(r,"name",t.target.value),required:!0})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Price *"}),e.jsx(a.Control,{type:"number",step:"0.01",placeholder:"0.00",value:s.price,onChange:t=>L(r,"price",parseFloat(t.target.value)||0),required:!0})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Duration (min) *"}),e.jsx(a.Control,{type:"number",placeholder:"30",value:s.duration,onChange:t=>L(r,"duration",parseInt(t.target.value)||0),required:!0})]})})]}),e.jsxs(a.Group,{className:"mb-0",children:[e.jsx(a.Label,{children:"Description *"}),e.jsx(a.Control,{as:"textarea",rows:2,placeholder:"Enter variant description",value:s.description,onChange:t=>L(r,"description",t.target.value),required:!0})]})]})},r))]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(u,{bg:"success",className:"me-2",children:"3"}),"Addons (Type 3)"]}),e.jsxs(m,{variant:"outline-success",size:"sm",onClick:$,children:[e.jsx("i",{className:"mdi mdi-plus me-1"})," Add Addon"]})]}),x.length===0?e.jsx("p",{className:"text-muted",children:'No addons added. Click "Add Addon" to add one.'}):x.map((s,r)=>e.jsx(v,{className:"mb-3",children:e.jsxs(v.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:["Addon ",r+1]}),e.jsx(m,{variant:"outline-danger",size:"sm",onClick:()=>O(r),children:e.jsx("i",{className:"mdi mdi-close"})})]}),e.jsxs(b,{children:[e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Addon Name *"}),e.jsx(a.Control,{type:"text",placeholder:"Enter addon name",value:s.name,onChange:t=>C(r,"name",t.target.value),required:!0})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Price *"}),e.jsx(a.Control,{type:"number",step:"0.01",placeholder:"0.00",value:s.price,onChange:t=>C(r,"price",parseFloat(t.target.value)||0),required:!0})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Duration (min) *"}),e.jsx(a.Control,{type:"number",placeholder:"30",value:s.duration,onChange:t=>C(r,"duration",parseInt(t.target.value)||0),required:!0})]})})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Link to Variants (Optional)"}),e.jsx(G,{isMulti:!0,className:"react-select",classNamePrefix:"react-select",options:k,value:k.filter(t=>s.variantIndices.includes(t.value)),onChange:t=>{const l=t?t.map(o=>o.value):[];C(r,"variantIndices",l)},placeholder:"Select variants to link this addon to...",isDisabled:d.length===0}),e.jsx(a.Text,{className:"text-muted",children:d.length===0?"Add variants first to link addons":"Select which variants this addon applies to"})]}),e.jsxs(a.Group,{className:"mb-0",children:[e.jsx(a.Label,{children:"Description *"}),e.jsx(a.Control,{as:"textarea",rows:2,placeholder:"Enter addon description",value:s.description,onChange:t=>C(r,"description",t.target.value),required:!0})]})]})},r))]})]}),e.jsxs(y.Footer,{children:[e.jsx(m,{variant:"secondary",onClick:V,children:"Cancel"}),e.jsx(m,{variant:"primary",type:"submit",disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{animation:"border",size:"sm",className:"me-2"}),"Creating..."]}):"Create Product"})]})]})]})]})},ye=()=>e.jsx(ee,{});export{ye as default};
