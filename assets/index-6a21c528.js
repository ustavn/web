import{w as j,aZ as f,j as e,aW as h,r as p,P as b,d as S,f as v,h as C,bn as A,v as s}from"./index-580402c3.js";import{u as I,a as N}from"./useMutation-7296d4b7.js";import{B as c}from"./Button-3ba513eb.js";import{A as P}from"./Alert-dc370370.js";import{S as w}from"./Spinner-1d091e6b.js";import{M as l}from"./Modal-b0bfa981.js";const E={}.VITE_API_SERVER||"http://localhost:80",i=j.create({baseURL:`${E}/api`,timeout:3e4,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(async t=>{const a=localStorage.getItem("_USTA_OAUTH");if(a)try{const r=JSON.parse(a);t.headers.Authorization=`Bearer ${r.accessToken}`,console.log("[Category API] Request:",{method:t.method,url:t.url,params:t.params,data:t.data,hasAuth:!!t.headers.Authorization})}catch(r){console.error("[Category API] Failed to parse OAuth session:",r)}else console.warn("[Category API] No OAuth session found");return t},t=>(console.error("[Category API] Request error:",t),Promise.reject(t)));i.interceptors.response.use(t=>(console.log("[Category API] Response:",{status:t.status,url:t.config.url,data:t.data}),t),t=>{var a,r,n;return console.error("[Category API] Response error:",{status:(a=t.response)==null?void 0:a.status,url:(r=t.config)==null?void 0:r.url,data:(n=t.response)==null?void 0:n.data,message:t.message}),Promise.reject(t)});async function F(t={}){console.log("[Category API] Fetching categories:",t);const a=await i.get("/categories/");if(a.data.success)return a.data.data;throw new Error(a.data.error||"Failed to fetch categories")}async function L(t){console.log("[Category API] Creating category:",t);const a=await i.post("/categories/",t);if(console.log("[Category API] Category created successfully:",a.data),a.data.success)return a.data.data;throw new Error(a.data.error||"Failed to create category")}function D(t={}){return I({queryKey:["categories",t],queryFn:()=>F(t),staleTime:3e4,retry:2,select:a=>a||[]})}function R(){const t=f();return N({mutationFn:a=>L(a),onSuccess:a=>{console.log("[useCreateCategory] Category created successfully:",a),t.invalidateQueries({queryKey:["categories"]})},onError:a=>{console.error("[useCreateCategory] Failed to create category:",a)}})}const T=[{Header:"ID",accessor:"id",defaultCanSort:!1,Cell:({value:t})=>e.jsxs("small",{className:"text-muted",children:[t.substring(0,8),"..."]})},{Header:"Code",accessor:"code",defaultCanSort:!0,Cell:({value:t})=>e.jsx(h,{bg:"primary",children:t})},{Header:"Name",accessor:"name",defaultCanSort:!0,Cell:({value:t})=>e.jsx("strong",{children:t})},{Header:"Level Code",accessor:"levelCode",defaultCanSort:!0,Cell:({value:t})=>e.jsx(h,{bg:"secondary",children:t})},{Header:"Parent ID",accessor:"parentId",defaultCanSort:!1,Cell:({value:t})=>t?e.jsxs("small",{className:"text-muted",children:[t.substring(0,8),"..."]}):e.jsx("span",{className:"text-muted",children:"—"})},{Header:"Description",accessor:"description",defaultCanSort:!1,Cell:({value:t})=>e.jsx("span",{className:"text-muted",children:t||"—"})},{Header:"Created At",accessor:"createdAt",defaultCanSort:!0,Cell:({value:t})=>new Date(t).toLocaleDateString()}],H=[{text:"10",value:10},{text:"25",value:25},{text:"50",value:50}],q=()=>{const[t,a]=p.useState(!1),[r,n]=p.useState({parentId:null,name:"",code:"",description:null}),{data:d,isLoading:x,error:u}=D(),m=R(),y=async o=>{o.preventDefault();try{const g={...r,parentId:r.parentId||null,description:r.description||null};await m.mutateAsync(g),a(!1),n({parentId:null,name:"",code:"",description:null})}catch(g){console.error("Failed to create category:",g)}};return e.jsxs(e.Fragment,{children:[e.jsx(b,{title:"Categories",subName:"Apps"}),e.jsx(S,{children:e.jsx(v,{xs:12,children:e.jsx(C,{children:e.jsxs(C.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h4",{className:"header-title",children:"Categories List"}),e.jsxs(c,{variant:"primary",onClick:()=>a(!0),children:[e.jsx("i",{className:"mdi mdi-plus-circle me-1"}),"Create Category"]})]}),u&&e.jsxs(P,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",u instanceof Error?u.message:"Failed to load categories"]}),x?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(w,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading categories..."})]}):d&&d.length>0?e.jsx(A,{columns:T,data:d,pageSize:10,sizePerPageList:H,isSortable:!0,pagination:!0,isSearchable:!0}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("p",{className:"text-muted",children:"No categories found"}),e.jsx(c,{variant:"primary",onClick:()=>a(!0),children:"Create First Category"})]})]})})})}),e.jsxs(l,{show:t,onHide:()=>a(!1),children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Create New Category"})}),e.jsxs(s,{onSubmit:y,children:[e.jsxs(l.Body,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Category Name *"}),e.jsx(s.Control,{type:"text",placeholder:"Enter category name",value:r.name,onChange:o=>n({...r,name:o.target.value}),required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Category Code *"}),e.jsx(s.Control,{type:"text",placeholder:"e.g., LM",value:r.code,onChange:o=>n({...r,code:o.target.value}),required:!0}),e.jsx(s.Text,{className:"text-muted",children:"Short code to identify this category"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Parent Category ID (Optional)"}),e.jsx(s.Control,{type:"text",placeholder:"Enter parent category ID",value:r.parentId||"",onChange:o=>n({...r,parentId:o.target.value||null})}),e.jsx(s.Text,{className:"text-muted",children:"Leave empty for root level category"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Description (Optional)"}),e.jsx(s.Control,{as:"textarea",rows:2,placeholder:"Enter description",value:r.description||"",onChange:o=>n({...r,description:o.target.value||null})})]})]}),e.jsxs(l.Footer,{children:[e.jsx(c,{variant:"secondary",onClick:()=>a(!1),children:"Cancel"}),e.jsx(c,{variant:"primary",type:"submit",disabled:m.isPending,children:m.isPending?"Creating...":"Create Category"})]})]})]})]})},G=()=>e.jsx(q,{});export{G as default};
