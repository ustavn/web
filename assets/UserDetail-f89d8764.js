import{j as e,r,a6 as z,a as G,a2 as V,P as v,d as f,f as d,h as y}from"./index-e82313e5.js";import{d as T,e as H,f as R,g as _,h as $,i as q}from"./useUsers-f87e9cbd.js";import{F as s}from"./Form-025e0a7f.js";import{M as g}from"./Modal-d898a024.js";import{B as x}from"./Button-e8ec431b.js";import{A as k}from"./Alert-f4c67321.js";import{S as C}from"./Spinner-4926c0ae.js";import{B as A}from"./Badge-f24d8f9c.js";const J=({formData:l,onChange:n,errors:a})=>{var c,h,N,u,b,j;const t=(i,o)=>{n({...l,[i]:o})},m=(i,o)=>{n({...l,identity:{...l.identity,[i]:o}})};return e.jsxs(e.Fragment,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Full Name"}),e.jsx(s.Control,{type:"text",value:l.fullName||"",onChange:i=>t("fullName",i.target.value),isInvalid:!!(a!=null&&a.fullName)}),(a==null?void 0:a.fullName)&&e.jsx(s.Control.Feedback,{type:"invalid",children:a.fullName})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Email"}),e.jsx(s.Control,{type:"email",value:l.email||"",onChange:i=>t("email",i.target.value),isInvalid:!!(a!=null&&a.email)}),(a==null?void 0:a.email)&&e.jsx(s.Control.Feedback,{type:"invalid",children:a.email})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Phone"}),e.jsx(s.Control,{type:"tel",value:l.phone||"",onChange:i=>t("phone",i.target.value),maxLength:10,isInvalid:!!(a!=null&&a.phone)}),e.jsx(s.Text,{className:"text-muted",children:"Maximum 10 digits"}),(a==null?void 0:a.phone)&&e.jsx(s.Control.Feedback,{type:"invalid",children:a.phone})]}),e.jsx("hr",{}),e.jsx("h5",{className:"mb-3",children:"Identity Information"}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Identity Full Name"}),e.jsx(s.Control,{type:"text",value:((c=l.identity)==null?void 0:c.fullName)||"",onChange:i=>m("fullName",i.target.value),isInvalid:!!(a!=null&&a["identity.fullName"])}),(a==null?void 0:a["identity.fullName"])&&e.jsx(s.Control.Feedback,{type:"invalid",children:a["identity.fullName"]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Identity Number"}),e.jsx(s.Control,{type:"text",value:((h=l.identity)==null?void 0:h.identityNumber)||"",onChange:i=>m("identityNumber",i.target.value),isInvalid:!!(a!=null&&a["identity.identityNumber"])}),(a==null?void 0:a["identity.identityNumber"])&&e.jsx(s.Control.Feedback,{type:"invalid",children:a["identity.identityNumber"]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Date of Birth"}),e.jsx(s.Control,{type:"datetime-local",value:(N=l.identity)!=null&&N.dateOfBirth?new Date(l.identity.dateOfBirth).toISOString().slice(0,16):"",onChange:i=>{const o=i.target.value?new Date(i.target.value).toISOString():"";m("dateOfBirth",o)},isInvalid:!!(a!=null&&a["identity.dateOfBirth"])}),(a==null?void 0:a["identity.dateOfBirth"])&&e.jsx(s.Control.Feedback,{type:"invalid",children:a["identity.dateOfBirth"]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Address"}),e.jsx(s.Control,{type:"text",value:((u=l.identity)==null?void 0:u.address)||"",onChange:i=>m("address",i.target.value),isInvalid:!!(a!=null&&a["identity.address"])}),(a==null?void 0:a["identity.address"])&&e.jsx(s.Control.Feedback,{type:"invalid",children:a["identity.address"]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Issued Date"}),e.jsx(s.Control,{type:"datetime-local",value:(b=l.identity)!=null&&b.issuedDate?new Date(l.identity.issuedDate).toISOString().slice(0,16):"",onChange:i=>{const o=i.target.value?new Date(i.target.value).toISOString():"";m("issuedDate",o)},isInvalid:!!(a!=null&&a["identity.issuedDate"])}),(a==null?void 0:a["identity.issuedDate"])&&e.jsx(s.Control.Feedback,{type:"invalid",children:a["identity.issuedDate"]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Issued Place"}),e.jsx(s.Control,{type:"text",value:((j=l.identity)==null?void 0:j.issuedPlace)||"",onChange:i=>m("issuedPlace",i.target.value),isInvalid:!!(a!=null&&a["identity.issuedPlace"])}),(a==null?void 0:a["identity.issuedPlace"])&&e.jsx(s.Control.Feedback,{type:"invalid",children:a["identity.issuedPlace"]})]})]})},K=({show:l,user:n,onHide:a,onSuccess:t})=>{const m=T(),[c,h]=r.useState({fullName:n.fullName||null,phone:n.phone||null,email:n.email||null,identity:void 0}),[N,u]=r.useState({});r.useEffect(()=>{h({fullName:n.fullName||null,phone:n.phone||null,email:n.email||null,identity:void 0})},[n]);const b=async i=>{i.preventDefault(),u({});try{await m.mutateAsync({id:n.id,data:c}),a(),t==null||t()}catch{}},j=()=>{h({fullName:n.fullName||null,phone:n.phone||null,email:n.email||null,identity:void 0}),u({}),a()};return e.jsxs(g,{show:l,onHide:j,size:"lg",children:[e.jsx(g.Header,{closeButton:!0,children:e.jsx(g.Title,{children:"Edit User"})}),e.jsxs(s,{onSubmit:b,children:[e.jsx(g.Body,{children:e.jsx(J,{formData:c,onChange:h,errors:N})}),e.jsxs(g.Footer,{children:[e.jsx(x,{variant:"secondary",onClick:j,children:"Cancel"}),e.jsx(x,{variant:"primary",type:"submit",disabled:m.isPending,children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-check me-1"}),"Update User"]})})]})]})]})},Q={0:"Admin",1:"User",2:"Technician",3:"Customer"},W={0:"danger",1:"primary",2:"info",3:"success"},X={0:"Active",1:"Inactive",2:"Suspended"},Y={0:"success",1:"secondary",2:"warning"},Z=()=>{const{id:l}=z(),n=G(),{showNotification:a}=V(),{data:t,isLoading:m,error:c,isError:h}=H(l||""),N=R(),u=_(),b=$(),j=q(),[i,o]=r.useState(!1),[D,F]=r.useState(!1),[w,U]=r.useState(""),[P,I]=r.useState(""),[B,S]=r.useState("");if(r.useEffect(()=>{h&&c&&a(c instanceof Error?c.message:"Failed to load user details","error")},[h,c,a]),r.useEffect(()=>{t&&(I(t.fullName||""),S(t.phone||""))},[t]),!l)return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"User Detail",subName:"Apps"}),e.jsx(k,{variant:"danger",children:"User ID is required"})]});if(m)return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"User Detail",subName:"Apps"}),e.jsxs("div",{className:"text-center py-5",children:[e.jsx(C,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading user details..."})]})]});if(h||c)return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"User Detail",subName:"Apps"}),e.jsxs(k,{variant:"danger",children:[e.jsx("h5",{children:"Failed to load user"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",c instanceof Error?c.message:String(c)]}),e.jsx(x,{variant:"secondary",onClick:()=>n("/apps/users"),className:"mt-2",children:"Back to Users"})]})]});if(!m&&!h&&!t)return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"User Detail",subName:"Apps"}),e.jsxs(k,{variant:"warning",children:[e.jsx("h5",{children:"User not found"}),e.jsxs("p",{children:["No user found with ID: ",l]}),e.jsx(x,{variant:"secondary",onClick:()=>n("/apps/users"),className:"mt-2",children:"Back to Users"})]})]});if(!t)return null;const L=async()=>{if(!P.trim()){a("Full name is required","error");return}try{await N.mutateAsync({id:t.id,data:{fullName:P.trim()}}),I("")}catch{}},O=async()=>{try{await u.mutateAsync({id:t.id,data:{phone:B||null}}),S("")}catch{}},E=async()=>{try{await b.mutateAsync(t.id),F(!0)}catch{}},M=async()=>{if(!w.trim()){a("OTP code is required","error");return}try{await j.mutateAsync({id:t.id,data:{pinCode:w.trim()}}),U(""),F(!1)}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:"User Detail",subName:"Apps"}),e.jsx(f,{children:e.jsxs(d,{xs:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"header-title",children:"User Information"}),e.jsxs("div",{children:[e.jsxs(x,{variant:"primary",className:"me-2",onClick:()=>o(!0),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Edit User"]}),e.jsxs(x,{variant:"secondary",onClick:()=>n("/apps/users"),children:[e.jsx("i",{className:"mdi mdi-arrow-left me-1"}),"Back to Users"]})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsx(y.Header,{children:e.jsx("h4",{className:"mb-0",children:"Basic Information"})}),e.jsxs(y.Body,{children:[e.jsxs(f,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Full Name"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("div",{className:"form-control-plaintext flex-grow-1",children:t.fullName||e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("input",{type:"text",className:"form-control form-control-sm",style:{width:"200px"},value:P,onChange:p=>I(p.target.value),placeholder:"New full name"}),e.jsx(x,{variant:"outline-primary",size:"sm",onClick:L,disabled:N.isPending||!P.trim(),children:N.isPending?e.jsx(C,{animation:"border",size:"sm"}):e.jsx("i",{className:"mdi mdi-check"})})]})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Email"}),e.jsx("div",{className:"form-control-plaintext",children:t.email||e.jsx("span",{className:"text-muted",children:"-"})})]})})]}),e.jsxs(f,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Phone"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("div",{className:"form-control-plaintext flex-grow-1",children:[t.phone||e.jsx("span",{className:"text-muted",children:"-"}),t.isPhoneVerify&&e.jsxs(A,{bg:"success",className:"ms-2",children:[e.jsx("i",{className:"mdi mdi-check-circle me-1"}),"Verified"]})]}),e.jsx("input",{type:"tel",className:"form-control form-control-sm",style:{width:"150px"},value:B,onChange:p=>S(p.target.value),placeholder:"New phone",maxLength:10}),e.jsx(x,{variant:"outline-primary",size:"sm",onClick:O,disabled:u.isPending,children:u.isPending?e.jsx(C,{animation:"border",size:"sm"}):e.jsx("i",{className:"mdi mdi-check"})}),!t.isPhoneVerify&&t.phone&&e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"outline-info",size:"sm",onClick:E,disabled:b.isPending,children:b.isPending?e.jsx(C,{animation:"border",size:"sm"}):e.jsx("i",{className:"mdi mdi-send"})}),D&&e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-2 w-100",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",style:{width:"100px"},value:w,onChange:p=>U(p.target.value),placeholder:"OTP",maxLength:6}),e.jsx(x,{variant:"success",size:"sm",onClick:M,disabled:j.isPending||!w.trim(),children:j.isPending?e.jsx(C,{animation:"border",size:"sm"}):e.jsx("i",{className:"mdi mdi-check"})}),e.jsx(x,{variant:"outline-secondary",size:"sm",onClick:()=>{F(!1),U("")},children:e.jsx("i",{className:"mdi mdi-close"})})]})]})]})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Profile ID"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx("code",{children:t.profileId})})]})})]}),e.jsxs(f,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Role"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx(A,{bg:W[t.role]||"secondary",children:Q[t.role]||`Role ${t.role}`})})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Status"}),e.jsx("div",{className:"form-control-plaintext",children:e.jsx(A,{bg:Y[t.status]||"secondary",children:X[t.status]||`Status ${t.status}`})})]})})]}),e.jsxs(f,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Created At"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(t.createdAt).toLocaleString("vi-VN")})]})}),t.updatedAt&&e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Updated At"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(t.updatedAt).toLocaleString("vi-VN")})]})})]})]})]}),t.identity&&e.jsxs(y,{className:"mb-3",children:[e.jsx(y.Header,{children:e.jsx("h4",{className:"mb-0",children:"Identity Information"})}),e.jsxs(y.Body,{children:[e.jsxs(f,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Identity Full Name"}),e.jsx("div",{className:"form-control-plaintext",children:t.identity.fullName||e.jsx("span",{className:"text-muted",children:"-"})})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Identity Number"}),e.jsx("div",{className:"form-control-plaintext",children:t.identity.identityNumber||e.jsx("span",{className:"text-muted",children:"-"})})]})})]}),e.jsxs(f,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Date of Birth"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(t.identity.dateOfBirth).toLocaleDateString("vi-VN")})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Address"}),e.jsx("div",{className:"form-control-plaintext",children:t.identity.address||e.jsx("span",{className:"text-muted",children:"-"})})]})})]}),e.jsxs(f,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Issued Date"}),e.jsx("div",{className:"form-control-plaintext",children:new Date(t.identity.issuedDate).toLocaleDateString("vi-VN")})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold text-muted",children:"Issued Place"}),e.jsx("div",{className:"form-control-plaintext",children:t.identity.issuedPlace||e.jsx("span",{className:"text-muted",children:"-"})})]})})]})]})]})]})}),e.jsx(K,{show:i,user:t,onHide:()=>o(!1),onSuccess:()=>{o(!1)}})]})},ee=Z,me=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{K as E,J as U,ee as a,me as b};
