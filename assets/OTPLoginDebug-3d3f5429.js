import{r as d,j as e,h as n,v as r,w as f}from"./index-580402c3.js";import{B as y}from"./Button-3ba513eb.js";import{A as h}from"./Alert-dc370370.js";function C(){const[p,T]=d.useState("https://identity.dev.usta.vn/api/auth/request-otp"),[j,v]=d.useState("abc1@gmail.com"),[g,o]=d.useState(null),[b,x]=d.useState(""),[m,u]=d.useState(!1),O=async()=>{var t,i,a,l,c;u(!0),x(""),o(null);try{console.log("Testing OTP request to:",p),console.log("With email:",j);const s=await f.post(p,{email:j},{headers:{"Content-Type":"application/json"},timeout:1e4});console.log("Response:",s),o(s.data)}catch(s){console.error("Error:",s),x(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.error)||s.message||"Unknown error"),o(((c=s.response)==null?void 0:c.data)||null)}finally{u(!1)}},w=async()=>{var i,a,l,c;const t="https://identity.dev.usta.vn/connect/authorize";u(!0),x(""),o(null);try{console.log("Testing authorization endpoint:",t);const s=await f.get(t,{params:{client_id:"test_client",response_type:"code",scope:"offline_access"},timeout:1e4});console.log("Auth endpoint response:",s),o({message:"Authorization endpoint is reachable",data:s.data})}catch(s){console.error("Auth endpoint error:",s),x(((a=(i=s.response)==null?void 0:i.data)==null?void 0:a.message)||((c=(l=s.response)==null?void 0:l.data)==null?void 0:c.error)||s.message||"Cannot reach authorization endpoint")}finally{u(!1)}};return e.jsx("div",{className:"container mt-5",children:e.jsxs(n,{children:[e.jsx(n.Header,{children:e.jsx("h4",{children:"OTP Login Debug Tool"})}),e.jsxs(n.Body,{children:[e.jsxs(r,{children:[e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"OTP Endpoint URL"}),e.jsx(r.Control,{type:"text",value:p,onChange:t=>T(t.target.value),placeholder:"Enter OTP endpoint URL"}),e.jsx(r.Text,{children:"The API endpoint for OTP request"})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Email"}),e.jsx(r.Control,{type:"email",value:j,onChange:t=>v(t.target.value),placeholder:"Enter email"})]}),e.jsxs("div",{className:"d-flex gap-2 mb-3",children:[e.jsx(y,{onClick:O,disabled:m,variant:"primary",children:m?"Testing...":"Test OTP Request"}),e.jsx(y,{onClick:w,disabled:m,variant:"secondary",children:"Test Auth Endpoint"})]})]}),b&&e.jsxs(h,{variant:"danger",className:"mt-3",children:[e.jsx(h.Heading,{children:"Error"}),e.jsx("p",{children:b})]}),g&&e.jsxs(h,{variant:"success",className:"mt-3",children:[e.jsx(h.Heading,{children:"Response"}),e.jsx("pre",{style:{maxHeight:"300px",overflow:"auto"},children:JSON.stringify(g,null,2)})]}),e.jsxs(n,{className:"mt-4",children:[e.jsx(n.Header,{children:"Troubleshooting Steps"}),e.jsx(n.Body,{children:e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Check if identity server is running:"}),e.jsx("br",{}),"Open"," ",e.jsx("a",{href:"https://identity.dev.usta.vn",target:"_blank",rel:"noopener noreferrer",children:"https://identity.dev.usta.vn"})," ","in your browser"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Check CORS configuration:"}),e.jsx("br",{}),"The identity server must allow requests from"," ",e.jsx("code",{children:window.location.origin})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Verify OTP endpoint exists:"}),e.jsx("br",{}),"The endpoint ",e.jsx("code",{children:"/api/auth/request-otp"})," must be implemented on the identity server"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Check browser console:"}),e.jsx("br",{}),"Open DevTools (F12) → Console tab for detailed error messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Check Network tab:"}),e.jsx("br",{}),"Open DevTools (F12) → Network tab to see if requests are being made"]})]})})]}),e.jsxs(n,{className:"mt-3",children:[e.jsx(n.Header,{children:"Expected OTP Flow (from Postman collection)"}),e.jsxs(n.Body,{children:[e.jsx("p",{children:"Based on your Postman collection, the standard OAuth flow is:"}),e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"GET"})," ",e.jsx("code",{children:"/connect/authorize?client_id=test_client&..."}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"User authenticates and gets authorization code"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"POST"})," ",e.jsx("code",{children:"/connect/token"}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Exchange code for access + refresh tokens"})]})]}),e.jsxs(h,{variant:"warning",className:"mt-3",children:[e.jsx("strong",{children:"Note:"})," The Postman collection doesn't show OTP endpoints (",e.jsx("code",{children:"/api/auth/request-otp"}),"). You may need to:",e.jsxs("ul",{className:"mb-0 mt-2",children:[e.jsx("li",{children:"Ask your backend team to implement OTP endpoints, or"}),e.jsx("li",{children:"Use the traditional OAuth redirect flow instead"})]})]})]})]})]})]})})}export{C as default};
